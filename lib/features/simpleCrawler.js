"use strict";

require("source-map-support/register");

const Feature = require('../enum/Feature');

const {
  ensureFeatureName
} = require("../utils/Helpers");

const basicAuth = (req, authInfo) => {
  req.auth(authInfo.username, authInfo.password);
};

const bearerAuth = (req, authInfo) => {
  req.set('Authorization', `Bearer ${authInfo}`);
};

class SimpleCrawler {
  constructor(app, settings) {
    this.agent = app.tryRequire('superagent');

    if (settings.saveCookies) {
      this.agent = this.agent.agent();
    }

    let timeout = {
      response: 5000,
      deadline: 60000
    };

    if (settings.responseTimeout) {
      timeout.response = settings.responseTimeout;
    }

    if (settings.deadlineTimeout) {
      timeout.deadline = settings.deadlineTimeout;
    }

    if (settings.parser) {
      if (settings.parser === 'cheerio') {
        let parser = app.tryRequire('cheerio');

        this._afterReceive = text => {
          return parser.load(text);
        };
      }
    }

    this._beforeSend = req => {
      req.timeout(timeout);

      if (settings.basicAuth) {
        basicAuth(req, settings.basicAuth);
      } else if (settings.bearerAuth) {
        bearerAuth(req, settings.bearerAuth);
      }
    };
  }

  async _sendRequest_(req) {
    this._beforeSend(req);

    req.buffer(true);

    try {
      let res = await req;
      return this._afterReceive ? this._afterReceive(res.text) : res.text;
    } catch (error) {
      if (this.onErrorHandler) {
        await this.onErrorHandler(error);
      }

      if (error.response) {
        let {
          status,
          body,
          text
        } = error.response;
        let message = body && body.error || error.response.error && error.response.error.message || text;
        error.message = message;
        error.status = status;
      }

      throw error;
    }
  }

  async get_(url, query) {
    let req = this.agent.get(url);

    if (query) {
      req.query(query);
    }

    return this._sendRequest_(req);
  }

  async post_(url, query, body) {
    let req = this.agent.post(url);

    if (query) {
      req.query(query);
    }

    if (body) {
      req.send(body);
    }

    return this._sendRequest_(req);
  }

}

module.exports = {
  type: Feature.SERVICE,
  groupable: true,
  load_: async function (app, settings, name) {
    ensureFeatureName(name);
    let client = new SimpleCrawler(app, settings);
    app.registerService(name, client);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9zaW1wbGVDcmF3bGVyLmpzIl0sIm5hbWVzIjpbIkZlYXR1cmUiLCJyZXF1aXJlIiwiZW5zdXJlRmVhdHVyZU5hbWUiLCJiYXNpY0F1dGgiLCJyZXEiLCJhdXRoSW5mbyIsImF1dGgiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwiYmVhcmVyQXV0aCIsInNldCIsIlNpbXBsZUNyYXdsZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsInNldHRpbmdzIiwiYWdlbnQiLCJ0cnlSZXF1aXJlIiwic2F2ZUNvb2tpZXMiLCJ0aW1lb3V0IiwicmVzcG9uc2UiLCJkZWFkbGluZSIsInJlc3BvbnNlVGltZW91dCIsImRlYWRsaW5lVGltZW91dCIsInBhcnNlciIsIl9hZnRlclJlY2VpdmUiLCJ0ZXh0IiwibG9hZCIsIl9iZWZvcmVTZW5kIiwiX3NlbmRSZXF1ZXN0XyIsImJ1ZmZlciIsInJlcyIsImVycm9yIiwib25FcnJvckhhbmRsZXIiLCJzdGF0dXMiLCJib2R5IiwibWVzc2FnZSIsImdldF8iLCJ1cmwiLCJxdWVyeSIsImdldCIsInBvc3RfIiwicG9zdCIsInNlbmQiLCJtb2R1bGUiLCJleHBvcnRzIiwidHlwZSIsIlNFUlZJQ0UiLCJncm91cGFibGUiLCJsb2FkXyIsIm5hbWUiLCJjbGllbnQiLCJyZWdpc3RlclNlcnZpY2UiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxNQUFNQSxPQUFPLEdBQUdDLE9BQU8sQ0FBQyxpQkFBRCxDQUF2Qjs7QUFDQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBd0JELE9BQU8sQ0FBQyxrQkFBRCxDQUFyQzs7QUFFQSxNQUFNRSxTQUFTLEdBQUcsQ0FBQ0MsR0FBRCxFQUFNQyxRQUFOLEtBQW1CO0FBQ2pDRCxFQUFBQSxHQUFHLENBQUNFLElBQUosQ0FBU0QsUUFBUSxDQUFDRSxRQUFsQixFQUE0QkYsUUFBUSxDQUFDRyxRQUFyQztBQUNILENBRkQ7O0FBSUEsTUFBTUMsVUFBVSxHQUFHLENBQUNMLEdBQUQsRUFBTUMsUUFBTixLQUFtQjtBQUNsQ0QsRUFBQUEsR0FBRyxDQUFDTSxHQUFKLENBQVEsZUFBUixFQUEwQixVQUFTTCxRQUFTLEVBQTVDO0FBQ0gsQ0FGRDs7QUFJQSxNQUFNTSxhQUFOLENBQW9CO0FBQ2hCQyxFQUFBQSxXQUFXLENBQUNDLEdBQUQsRUFBTUMsUUFBTixFQUFnQjtBQUN2QixTQUFLQyxLQUFMLEdBQWFGLEdBQUcsQ0FBQ0csVUFBSixDQUFlLFlBQWYsQ0FBYjs7QUFFQSxRQUFJRixRQUFRLENBQUNHLFdBQWIsRUFBMEI7QUFDdEIsV0FBS0YsS0FBTCxHQUFhLEtBQUtBLEtBQUwsQ0FBV0EsS0FBWCxFQUFiO0FBQ0g7O0FBR0QsUUFBSUcsT0FBTyxHQUFHO0FBQ1ZDLE1BQUFBLFFBQVEsRUFBRSxJQURBO0FBRVZDLE1BQUFBLFFBQVEsRUFBRTtBQUZBLEtBQWQ7O0FBS0EsUUFBSU4sUUFBUSxDQUFDTyxlQUFiLEVBQThCO0FBQzFCSCxNQUFBQSxPQUFPLENBQUNDLFFBQVIsR0FBbUJMLFFBQVEsQ0FBQ08sZUFBNUI7QUFDSDs7QUFFRCxRQUFJUCxRQUFRLENBQUNRLGVBQWIsRUFBOEI7QUFDMUJKLE1BQUFBLE9BQU8sQ0FBQ0UsUUFBUixHQUFtQk4sUUFBUSxDQUFDUSxlQUE1QjtBQUNIOztBQUVELFFBQUlSLFFBQVEsQ0FBQ1MsTUFBYixFQUFxQjtBQUNqQixVQUFJVCxRQUFRLENBQUNTLE1BQVQsS0FBb0IsU0FBeEIsRUFBbUM7QUFDL0IsWUFBSUEsTUFBTSxHQUFHVixHQUFHLENBQUNHLFVBQUosQ0FBZSxTQUFmLENBQWI7O0FBQ0EsYUFBS1EsYUFBTCxHQUFzQkMsSUFBRCxJQUFVO0FBQzNCLGlCQUFPRixNQUFNLENBQUNHLElBQVAsQ0FBWUQsSUFBWixDQUFQO0FBQ0gsU0FGRDtBQUdIO0FBQ0o7O0FBRUQsU0FBS0UsV0FBTCxHQUFvQnZCLEdBQUQsSUFBUztBQUV4QkEsTUFBQUEsR0FBRyxDQUFDYyxPQUFKLENBQVlBLE9BQVo7O0FBR0EsVUFBSUosUUFBUSxDQUFDWCxTQUFiLEVBQXdCO0FBQ3BCQSxRQUFBQSxTQUFTLENBQUNDLEdBQUQsRUFBTVUsUUFBUSxDQUFDWCxTQUFmLENBQVQ7QUFDSCxPQUZELE1BRU8sSUFBSVcsUUFBUSxDQUFDTCxVQUFiLEVBQXlCO0FBQzVCQSxRQUFBQSxVQUFVLENBQUNMLEdBQUQsRUFBTVUsUUFBUSxDQUFDTCxVQUFmLENBQVY7QUFDSDtBQUNKLEtBVkQ7QUFXSDs7QUFFRCxRQUFNbUIsYUFBTixDQUFvQnhCLEdBQXBCLEVBQXlCO0FBQ3JCLFNBQUt1QixXQUFMLENBQWlCdkIsR0FBakI7O0FBRUFBLElBQUFBLEdBQUcsQ0FBQ3lCLE1BQUosQ0FBVyxJQUFYOztBQUVBLFFBQUk7QUFDQSxVQUFJQyxHQUFHLEdBQUcsTUFBTTFCLEdBQWhCO0FBQ0EsYUFBTyxLQUFLb0IsYUFBTCxHQUFxQixLQUFLQSxhQUFMLENBQW1CTSxHQUFHLENBQUNMLElBQXZCLENBQXJCLEdBQW9ESyxHQUFHLENBQUNMLElBQS9EO0FBQ0gsS0FIRCxDQUdFLE9BQU9NLEtBQVAsRUFBYztBQUNaLFVBQUksS0FBS0MsY0FBVCxFQUF5QjtBQUNyQixjQUFNLEtBQUtBLGNBQUwsQ0FBb0JELEtBQXBCLENBQU47QUFDSDs7QUFFRCxVQUFJQSxLQUFLLENBQUNaLFFBQVYsRUFBb0I7QUFDaEIsWUFBSTtBQUFFYyxVQUFBQSxNQUFGO0FBQVVDLFVBQUFBLElBQVY7QUFBZ0JULFVBQUFBO0FBQWhCLFlBQXlCTSxLQUFLLENBQUNaLFFBQW5DO0FBRUEsWUFBSWdCLE9BQU8sR0FBSUQsSUFBSSxJQUFJQSxJQUFJLENBQUNILEtBQWQsSUFBeUJBLEtBQUssQ0FBQ1osUUFBTixDQUFlWSxLQUFmLElBQXdCQSxLQUFLLENBQUNaLFFBQU4sQ0FBZVksS0FBZixDQUFxQkksT0FBdEUsSUFBa0ZWLElBQWhHO0FBQ0FNLFFBQUFBLEtBQUssQ0FBQ0ksT0FBTixHQUFnQkEsT0FBaEI7QUFDQUosUUFBQUEsS0FBSyxDQUFDRSxNQUFOLEdBQWVBLE1BQWY7QUFDSDs7QUFFRCxZQUFNRixLQUFOO0FBQ0g7QUFDSjs7QUFFRCxRQUFNSyxJQUFOLENBQVdDLEdBQVgsRUFBZ0JDLEtBQWhCLEVBQXVCO0FBQ25CLFFBQUlsQyxHQUFHLEdBQUcsS0FBS1csS0FBTCxDQUFXd0IsR0FBWCxDQUFlRixHQUFmLENBQVY7O0FBRUEsUUFBSUMsS0FBSixFQUFXO0FBQ1BsQyxNQUFBQSxHQUFHLENBQUNrQyxLQUFKLENBQVVBLEtBQVY7QUFDSDs7QUFFRCxXQUFPLEtBQUtWLGFBQUwsQ0FBbUJ4QixHQUFuQixDQUFQO0FBQ0g7O0FBRUQsUUFBTW9DLEtBQU4sQ0FBWUgsR0FBWixFQUFpQkMsS0FBakIsRUFBd0JKLElBQXhCLEVBQThCO0FBQzFCLFFBQUk5QixHQUFHLEdBQUcsS0FBS1csS0FBTCxDQUFXMEIsSUFBWCxDQUFnQkosR0FBaEIsQ0FBVjs7QUFDQSxRQUFJQyxLQUFKLEVBQVc7QUFDUGxDLE1BQUFBLEdBQUcsQ0FBQ2tDLEtBQUosQ0FBVUEsS0FBVjtBQUNIOztBQUVELFFBQUlKLElBQUosRUFBVTtBQUNOOUIsTUFBQUEsR0FBRyxDQUFDc0MsSUFBSixDQUFTUixJQUFUO0FBQ0g7O0FBRUQsV0FBTyxLQUFLTixhQUFMLENBQW1CeEIsR0FBbkIsQ0FBUDtBQUNIOztBQTFGZTs7QUE2RnBCdUMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBTWJDLEVBQUFBLElBQUksRUFBRTdDLE9BQU8sQ0FBQzhDLE9BTkQ7QUFZWkMsRUFBQUEsU0FBUyxFQUFFLElBWkM7QUEwQmJDLEVBQUFBLEtBQUssRUFBRSxnQkFBZ0JuQyxHQUFoQixFQUFxQkMsUUFBckIsRUFBK0JtQyxJQUEvQixFQUFxQztBQUN4Qy9DLElBQUFBLGlCQUFpQixDQUFDK0MsSUFBRCxDQUFqQjtBQUVBLFFBQUlDLE1BQU0sR0FBRyxJQUFJdkMsYUFBSixDQUFrQkUsR0FBbEIsRUFBdUJDLFFBQXZCLENBQWI7QUFFQUQsSUFBQUEsR0FBRyxDQUFDc0MsZUFBSixDQUFvQkYsSUFBcEIsRUFBMEJDLE1BQTFCO0FBQ0g7QUFoQ1ksQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBGZWF0dXJlID0gcmVxdWlyZSgnLi4vZW51bS9GZWF0dXJlJyk7XG5jb25zdCB7IGVuc3VyZUZlYXR1cmVOYW1lIH0gPSByZXF1aXJlKFwiLi4vdXRpbHMvSGVscGVyc1wiKTtcblxuY29uc3QgYmFzaWNBdXRoID0gKHJlcSwgYXV0aEluZm8pID0+IHtcbiAgICByZXEuYXV0aChhdXRoSW5mby51c2VybmFtZSwgYXV0aEluZm8ucGFzc3dvcmQpO1xufVxuXG5jb25zdCBiZWFyZXJBdXRoID0gKHJlcSwgYXV0aEluZm8pID0+IHtcbiAgICByZXEuc2V0KCdBdXRob3JpemF0aW9uJywgYEJlYXJlciAke2F1dGhJbmZvfWApO1xufVxuXG5jbGFzcyBTaW1wbGVDcmF3bGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhcHAsIHNldHRpbmdzKSB7XG4gICAgICAgIHRoaXMuYWdlbnQgPSBhcHAudHJ5UmVxdWlyZSgnc3VwZXJhZ2VudCcpO1xuXG4gICAgICAgIGlmIChzZXR0aW5ncy5zYXZlQ29va2llcykge1xuICAgICAgICAgICAgdGhpcy5hZ2VudCA9IHRoaXMuYWdlbnQuYWdlbnQoKTsgLy8gY3JlYXRlIGEgc2VwYXJhdGUgY29va2llIGphclxuICAgICAgICB9XG5cbiAgICAgICAgLy90aW1lb3V0XG4gICAgICAgIGxldCB0aW1lb3V0ID0ge1xuICAgICAgICAgICAgcmVzcG9uc2U6IDUwMDAsIC8vIFdhaXQgNSBzZWNvbmRzIGZvciB0aGUgc2VydmVyIHRvIHN0YXJ0IHNlbmRpbmcsXG4gICAgICAgICAgICBkZWFkbGluZTogNjAwMDAgLy8gYnV0IGFsbG93IDEgbWludXRlIGZvciB0aGUgZmlsZSB0byBmaW5pc2ggbG9hZGluZy5cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoc2V0dGluZ3MucmVzcG9uc2VUaW1lb3V0KSB7XG4gICAgICAgICAgICB0aW1lb3V0LnJlc3BvbnNlID0gc2V0dGluZ3MucmVzcG9uc2VUaW1lb3V0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNldHRpbmdzLmRlYWRsaW5lVGltZW91dCkge1xuICAgICAgICAgICAgdGltZW91dC5kZWFkbGluZSA9IHNldHRpbmdzLmRlYWRsaW5lVGltZW91dDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzZXR0aW5ncy5wYXJzZXIpIHtcbiAgICAgICAgICAgIGlmIChzZXR0aW5ncy5wYXJzZXIgPT09ICdjaGVlcmlvJykge1xuICAgICAgICAgICAgICAgIGxldCBwYXJzZXIgPSBhcHAudHJ5UmVxdWlyZSgnY2hlZXJpbycpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyUmVjZWl2ZSA9ICh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZXIubG9hZCh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBcbiAgICAgICAgfSBcblxuICAgICAgICB0aGlzLl9iZWZvcmVTZW5kID0gKHJlcSkgPT4ge1xuICAgICAgICAgICAgLy90aW1lb3V0XG4gICAgICAgICAgICByZXEudGltZW91dCh0aW1lb3V0KTtcblxuICAgICAgICAgICAgLy9hdXRoXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MuYmFzaWNBdXRoKSB7XG4gICAgICAgICAgICAgICAgYmFzaWNBdXRoKHJlcSwgc2V0dGluZ3MuYmFzaWNBdXRoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MuYmVhcmVyQXV0aCkge1xuICAgICAgICAgICAgICAgIGJlYXJlckF1dGgocmVxLCBzZXR0aW5ncy5iZWFyZXJBdXRoKTtcbiAgICAgICAgICAgIH0gICAgICBcbiAgICAgICAgfTsgICAgICAgICBcbiAgICB9XG5cbiAgICBhc3luYyBfc2VuZFJlcXVlc3RfKHJlcSkge1xuICAgICAgICB0aGlzLl9iZWZvcmVTZW5kKHJlcSk7XG5cbiAgICAgICAgcmVxLmJ1ZmZlcih0cnVlKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IHJlcTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZnRlclJlY2VpdmUgPyB0aGlzLl9hZnRlclJlY2VpdmUocmVzLnRleHQpIDogcmVzLnRleHQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vbkVycm9ySGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMub25FcnJvckhhbmRsZXIoZXJyb3IpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBsZXQgeyBzdGF0dXMsIGJvZHksIHRleHQgfSA9IGVycm9yLnJlc3BvbnNlO1xuXG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSAoYm9keSAmJiBib2R5LmVycm9yKSB8fCAoZXJyb3IucmVzcG9uc2UuZXJyb3IgJiYgZXJyb3IucmVzcG9uc2UuZXJyb3IubWVzc2FnZSkgfHwgdGV4dDtcbiAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlID0gbWVzc2FnZTsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZXJyb3Iuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldF8odXJsLCBxdWVyeSkge1xuICAgICAgICBsZXQgcmVxID0gdGhpcy5hZ2VudC5nZXQodXJsKTtcblxuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIHJlcS5xdWVyeShxdWVyeSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3RfKHJlcSk7XG4gICAgfVxuXG4gICAgYXN5bmMgcG9zdF8odXJsLCBxdWVyeSwgYm9keSkge1xuICAgICAgICBsZXQgcmVxID0gdGhpcy5hZ2VudC5wb3N0KHVybCk7XG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgcmVxLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChib2R5KSB7XG4gICAgICAgICAgICByZXEuc2VuZChib2R5KTsgICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdF8ocmVxKTtcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBwbHVnaW4gc3RhZ2VcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgdHlwZTogRmVhdHVyZS5TRVJWSUNFLFxuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGNhbiBiZSBncm91cGVkIGJ5IHNlcnZpY2VHcm91cFxuICAgICAqIEBtZW1iZXIge2Jvb2xlYW59XG4gICAgICovXG4gICAgIGdyb3VwYWJsZTogdHJ1ZSxcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge0FwcH0gYXBwIC0gVGhlIGNsaSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzZXR0aW5ncyAtIFNldHRpbmdzIG9mIHNpbXBsZSBjcmF3bGVyXG4gICAgICogQHByb3BlcnR5IHtib29sZWFufSBbc2V0dGluZ3Muc2F2ZUNvb2tpZXNdIC0gRmxhZyBvZiBzYXZlIGNvb2tpZXMgb3Igbm90XG4gICAgICogQHByb3BlcnR5IHtvYmplY3R9IFtzZXR0aW5ncy5iYXNpY0F1dGhdIC0gQmFzaWMgYXV0aGVudGljYXRpb25cbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3NldHRpbmdzLmJlYXJlckF1dGhdIC0gQmVhcmVyIGF1dGhlbnRpY2F0aW9uXG4gICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFtzZXR0aW5ncy5yZXNwb25zZVRpbWVvdXRdIC0gU2V0cyBtYXhpbXVtIHRpbWUgKG1zKSB0byB3YWl0IGZvciB0aGUgZmlyc3QgYnl0ZSB0byBhcnJpdmUgZnJvbSB0aGUgc2VydmVyLCBidXQgaXQgZG9lcyBub3QgbGltaXQgaG93IGxvbmcgdGhlIGVudGlyZSBkb3dubG9hZCBjYW4gdGFrZS5cbiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gW3NldHRpbmdzLmRlYWRsaW5lVGltZW91dF0gLSBTZXRzIGEgZGVhZGxpbmUgKG1zKSBmb3IgdGhlIGVudGlyZSByZXF1ZXN0IChpbmNsdWRpbmcgYWxsIHVwbG9hZHMsIHJlZGlyZWN0cywgc2VydmVyIHByb2Nlc3NpbmcgdGltZSkgdG8gY29tcGxldGUuXG4gICAgICogXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPCo+fVxuICAgICAqL1xuICAgIGxvYWRfOiBhc3luYyBmdW5jdGlvbiAoYXBwLCBzZXR0aW5ncywgbmFtZSkge1xuICAgICAgICBlbnN1cmVGZWF0dXJlTmFtZShuYW1lKTtcblxuICAgICAgICBsZXQgY2xpZW50ID0gbmV3IFNpbXBsZUNyYXdsZXIoYXBwLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgYXBwLnJlZ2lzdGVyU2VydmljZShuYW1lLCBjbGllbnQpOyAgICBcbiAgICB9XG59OyJdfQ==