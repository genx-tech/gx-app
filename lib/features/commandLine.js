"use strict";

require("source-map-support/register");

const path = require('path');

const Feature = require('../enum/Feature');

const {
  _,
  putIntoBucket,
  setValueByPath,
  eachAsync_
} = require('rk-utils');

const {
  tryRequire
} = require('../utils/Helpers');

const {
  ApplicationError,
  InvalidConfiguration
} = require('../utils/Errors');

function translateMinimistOptions(opts) {
  let m = {};

  _.forOwn(opts, (detail, name) => {
    if (detail.bool) {
      putIntoBucket(m, 'boolean', name);
    } else {
      putIntoBucket(m, 'string', name);
    }

    if ('default' in detail) {
      setValueByPath(m, `default.${name}`, detail.default);
    }

    if (detail.alias) {
      setValueByPath(m, `alias.${name}`, detail.alias);
    }
  });

  return m;
}

function optionDecorator(name) {
  return name.length == 1 ? '-' + name : '--' + name;
}

const gArgv = process.argv.slice(2);

class CommandLineArgumentError extends ApplicationError {
  constructor(message, name, nonOption) {
    super(message, 'E_CLI_INVALID_ARG', {
      name,
      nonOption
    });
  }

}

class CommandLine {
  constructor(app, usage) {
    this.app = app;
    this.usage = usage;
    this.parse(usage.options);
  }

  injectUsage(injects) {
    this.injects = injects;
  }

  parse(options) {
    const minimist = tryRequire('minimist');
    this.argv = minimist(gArgv, translateMinimistOptions(options));
  }

  option(name) {
    return this.argv[name];
  }

  arg(name) {
    if (this.args[name]) return this.args[name];

    let index = _.findIndex(this.usage.arguments, arg => arg.name === name);

    if (index === -1 || this.argv._.length <= index) {
      return undefined;
    }

    this.args || (this.args = {});
    return this.args[name] = this.argv._[index];
  }

  updateOption(name, value) {
    this.argv[name] = value;
    let opts = this.usage.options[name];

    if (opts.alias) {
      _.each(opts.alias, a => {
        this.argv[a] = value;
      });
    }
  }

  async valueOrFunctionCall_(functor) {
    if (typeof functor === 'function') {
      return await functor(this);
    }

    return functor;
  }

  async inquire_() {
    const inquirer = tryRequire('inquirer');

    const doInquire_ = (item, argIndex) => inquirer.prompt([item]).then(answers => {
      console.log();

      _.forOwn(answers, (ans, name) => {
        if (typeof argIndex === 'undefined') {
          this.updateOption(name, ans);
        } else {
          if (!(this.argv._.length === argIndex)) {
            throw new Error("Assertion failed: this.argv._.length === argIndex");
          }

          this.argv._ = this.argv._.concat([ans]);
        }
      });
    });

    const doFilter_ = async (name, opt, argIndex) => {
      if (opt.filter) {
        if (typeof argIndex === 'undefined') {
          if (!(typeof opt.filter !== 'function')) {
            throw new InvalidConfiguration(`The "filter" in the inquirer option for argument option "${name}" should be a function!`, this.app, `commandLine.options[${name}].filter`);
          }

          this.updateOption(name, (await opt.filter(this.argv[name], this)));
        } else {
          if (!(typeof opt.filter !== 'function')) {
            throw new InvalidConfiguration(`The "filter" in the inquirer option for argument value "${name}" at position ${argIndex} should be a function!`, this.app, `commandLine.arguments[${argIndex}].filter`);
          }

          this.argv._[argIndex] = await opt.filter(this.argv._[argIndex], this);
        }
      }
    };

    const argExist = (name, argIndex) => typeof argIndex === 'undefined' ? name in this.argv : this.argv._.length > argIndex;

    const prepareInquire_ = async (opts, name, argIndex) => {
      let argExists = argExist(name, argIndex);

      if ('inquire' in opts && !argExists) {
        let inquire = this.valueOrFunctionCall_(opts.inquire);

        if (inquire) {
          let type;
          let q = {
            name: name,
            message: opts.promptMessage || opts.desc
          };

          if (opts.promptType) {
            type = opts.promptType;

            if (type === 'list' || type === 'rawList' || type === 'checkbox' || type === 'expand') {
              if (!opts.choicesProvider) {
                throw new InvalidConfiguration(typeof argIndex === 'undefined' ? `Missing "choicesProvider" in the inquirer option for argument option "${name}"!` : `Missing "choicesProvider" in the inquirer option for argument value "${name}" at postion ${argIndex}!`, app, typeof argIndex === 'undefined' ? `commandLine.options[${name}].choicesProvider` : `commandLine.arguments[${argIndex}].choicesProvider`);
              }

              q.choices = await this.valueOrFunctionCall_(opts.choicesProvider);
            }
          } else if (opts.bool) {
            type = 'confirm';
          } else {
            type = 'input';
          }

          q.type = type;

          if ('promptDefault' in opts) {
            q.default = await this.valueOrFunctionCall_(opts.promptDefault);
          }

          await doInquire_(q, argIndex);
          await doFilter_(name, opts, argIndex);

          if (opts.afterInquire) {
            await opts.afterInquire(this);
          }
        }
      } else if (argExists) {
        await doFilter_(name, opts, argIndex);
      }

      if (this.usage.showArguments && argExist(name, argIndex)) {
        if (typeof argIndex === 'undefined') {
          console.log('option', name, `(${opts.desc})`, ':', this.argv[name]);
        } else {
          console.log(`<${name}>`, ':', this.argv._[argIndex]);
        }
      }
    };

    if (!_.isEmpty(this.usage.arguments)) {
      await eachAsync_(this.usage.arguments, async (argOpt, index) => {
        let {
          name,
          ...opts
        } = argOpt;
        return prepareInquire_(opts, name, index);
      });
    }

    return _.isEmpty(this.usage.options) || eachAsync_(this.usage.options, (opts, name) => prepareInquire_(opts, name));
  }

  async validate_() {
    const checkRequire_ = opts => this.valueOrFunctionCall_(opts.required);

    let errors = [];

    if (!_.isEmpty(this.usage.arguments)) {
      let argNum = this.argv._.length;

      if (argNum < this.usage.arguments.length) {
        let args = [];
        let i = 0;
        await eachAsync_(this.usage.arguments, async arg => {
          let required = await checkRequire_(arg);

          if (required) {
            if (i >= argNum) {
              let msg = `Missing required argument "${arg.name}"!`;

              if (this.usage.showUsageOnError) {
                errors.push(msg);
              } else {
                throw new CommandLineArgumentError(msg, arg.name, true);
              }
            } else {
              args.push(this.argv._[i++]);
            }
          }
        });
        this.argv._ = args;
      }
    }

    this.usage.options && (await eachAsync_(this.usage.options, async (opts, name) => {
      let required = await checkRequire_(opts);

      if (required && !(name in this.argv)) {
        let msg = `Missing required argument option of "${name}"!`;

        if (this.usage.showUsageOnError) {
          errors.push(msg);
        } else {
          throw new CommandLineArgumentError(msg, name);
        }
      }
    }));

    if (errors.length > 0) {
      this.showUsage({
        afterBanner: () => 'Error(s):\n' + errors.map(msg => ' - ' + msg).join('\n') + '\n\n'
      });
      process.exit(1);
    }
  }

  async fillSilentModeDefaults_() {
    await eachAsync_(this.usage.arguments, async (arg, index) => {
      if (this.argv._.length <= index) {
        if (arg.hasOwnProperty('silentModeDefault')) {
          for (let i = this.argv._.length; i < index; i++) {
            this.argv._.push(undefined);
          }

          this.argv._.push((await this.valueOrFunctionCall_(arg.silentModeDefault)));
        }
      }
    });
    await eachAsync_(this.usage.options, async (opts, name) => {
      if (!this.argv.hasOwnProperty(name) && opts.hasOwnProperty('silentModeDefault')) {
        this.updateOption(name, (await this.valueOrFunctionCall_(opts.silentModeDefault)));
      }
    });
  }

  getBanner() {
    if (this.usage.banner) {
      let banner = '';

      if (typeof this.usage.banner === 'function') {
        banner += this.usage.banner(this);
      } else if (typeof this.usage.banner === 'string') {
        banner += this.usage.banner;
      } else {
        throw new InvalidConfiguration('Invalid banner value of commandLine feature.', this.app, `commandLine.banner`);
      }

      banner += '\n';
      return banner;
    }

    return undefined;
  }

  getUsage(injects) {
    injects = { ...this.injects,
      ...injects
    };
    let usage = '';
    let banner = !this.bannerShown && this.getBanner();

    if (banner) {
      usage += banner + '\n';
    }

    if (injects && injects.afterBanner) {
      usage += injects.afterBanner();
    }

    let fmtArgs = '';

    if (!_.isEmpty(this.usage.arguments)) {
      fmtArgs = ' ' + this.usage.arguments.map(arg => arg.required ? `<${arg.name}>` : `[${arg.name}]`).join(' ');
    }

    usage += `Usage: ${this.usage.program || path.basename(process.argv[1])}${fmtArgs} [options]\n\n`;

    if (injects && injects.afterCommandLine) {
      usage += injects.afterCommandLine();
    }

    if (!_.isEmpty(this.usage.options)) {
      usage += `Options:\n`;

      _.forOwn(this.usage.options, (opts, name) => {
        let line = '  ' + optionDecorator(name);

        if (opts.alias) {
          line += _.reduce(opts.alias, (sum, a) => sum + ', ' + optionDecorator(a), '');
        }

        line += '\n';
        line += '    ' + opts.desc + '\n';

        if ('default' in opts) {
          line += '    default: ' + opts.default.toString() + '\n';
        }

        if (opts.required) {
          if (typeof opts.required === 'function') {
            line += '    conditional\n';
          } else {
            line += '    required\n';
          }
        }

        if (opts.choicesProvider && Array.isArray(opts.choicesProvider)) {
          line += '    available values:\n';
          opts.choicesProvider.forEach(choice => {
            line += `        "${choice.value}": ${choice.name}\n`;
          });
        }

        line += '\n';
        usage += line;
      });
    }

    if (injects && injects.afterOptions) {
      usage += injects.afterOptions();
    }

    return usage;
  }

  showBannar() {
    let banner = this.getBanner();

    if (banner) {
      console.log(banner);
      this.bannerShown = true;
    }
  }

  showUsage(injects) {
    console.log(this.getUsage(injects));
  }

}

module.exports = {
  type: Feature.INIT,
  load_: async (app, usageOptions) => {
    app.commandLine = new CommandLine(app, usageOptions);
    let silentMode = usageOptions.silentMode;

    if (silentMode && typeof silentMode === 'function') {
      silentMode = silentMode(app.commandLine);
    }

    app.commandLine.silentMode = silentMode;

    if (silentMode) {
      await app.commandLine.fillSilentModeDefaults_();
    } else {
      app.commandLine.showBannar();
      await app.commandLine.inquire_();
    }

    let nonValidationMode = usageOptions.nonValidationMode;

    if (nonValidationMode && typeof nonValidationMode === 'function') {
      nonValidationMode = nonValidationMode(app.commandLine);
    }

    app.commandLine.nonValidationMode = nonValidationMode;

    if (!nonValidationMode) {
      await app.commandLine.validate_();
    }
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9jb21tYW5kTGluZS5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsIkZlYXR1cmUiLCJfIiwicHV0SW50b0J1Y2tldCIsInNldFZhbHVlQnlQYXRoIiwiZWFjaEFzeW5jXyIsInRyeVJlcXVpcmUiLCJBcHBsaWNhdGlvbkVycm9yIiwiSW52YWxpZENvbmZpZ3VyYXRpb24iLCJ0cmFuc2xhdGVNaW5pbWlzdE9wdGlvbnMiLCJvcHRzIiwibSIsImZvck93biIsImRldGFpbCIsIm5hbWUiLCJib29sIiwiZGVmYXVsdCIsImFsaWFzIiwib3B0aW9uRGVjb3JhdG9yIiwibGVuZ3RoIiwiZ0FyZ3YiLCJwcm9jZXNzIiwiYXJndiIsInNsaWNlIiwiQ29tbWFuZExpbmVBcmd1bWVudEVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwibm9uT3B0aW9uIiwiQ29tbWFuZExpbmUiLCJhcHAiLCJ1c2FnZSIsInBhcnNlIiwib3B0aW9ucyIsImluamVjdFVzYWdlIiwiaW5qZWN0cyIsIm1pbmltaXN0Iiwib3B0aW9uIiwiYXJnIiwiYXJncyIsImluZGV4IiwiZmluZEluZGV4IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwidXBkYXRlT3B0aW9uIiwidmFsdWUiLCJlYWNoIiwiYSIsInZhbHVlT3JGdW5jdGlvbkNhbGxfIiwiZnVuY3RvciIsImlucXVpcmVfIiwiaW5xdWlyZXIiLCJkb0lucXVpcmVfIiwiaXRlbSIsImFyZ0luZGV4IiwicHJvbXB0IiwidGhlbiIsImFuc3dlcnMiLCJjb25zb2xlIiwibG9nIiwiYW5zIiwiY29uY2F0IiwiZG9GaWx0ZXJfIiwib3B0IiwiZmlsdGVyIiwiYXJnRXhpc3QiLCJwcmVwYXJlSW5xdWlyZV8iLCJhcmdFeGlzdHMiLCJpbnF1aXJlIiwidHlwZSIsInEiLCJwcm9tcHRNZXNzYWdlIiwiZGVzYyIsInByb21wdFR5cGUiLCJjaG9pY2VzUHJvdmlkZXIiLCJjaG9pY2VzIiwicHJvbXB0RGVmYXVsdCIsImFmdGVySW5xdWlyZSIsInNob3dBcmd1bWVudHMiLCJpc0VtcHR5IiwiYXJnT3B0IiwidmFsaWRhdGVfIiwiY2hlY2tSZXF1aXJlXyIsInJlcXVpcmVkIiwiZXJyb3JzIiwiYXJnTnVtIiwiaSIsIm1zZyIsInNob3dVc2FnZU9uRXJyb3IiLCJwdXNoIiwic2hvd1VzYWdlIiwiYWZ0ZXJCYW5uZXIiLCJtYXAiLCJqb2luIiwiZXhpdCIsImZpbGxTaWxlbnRNb2RlRGVmYXVsdHNfIiwiaGFzT3duUHJvcGVydHkiLCJzaWxlbnRNb2RlRGVmYXVsdCIsImdldEJhbm5lciIsImJhbm5lciIsImdldFVzYWdlIiwiYmFubmVyU2hvd24iLCJmbXRBcmdzIiwicHJvZ3JhbSIsImJhc2VuYW1lIiwiYWZ0ZXJDb21tYW5kTGluZSIsImxpbmUiLCJyZWR1Y2UiLCJzdW0iLCJ0b1N0cmluZyIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJjaG9pY2UiLCJhZnRlck9wdGlvbnMiLCJzaG93QmFubmFyIiwibW9kdWxlIiwiZXhwb3J0cyIsIklOSVQiLCJsb2FkXyIsInVzYWdlT3B0aW9ucyIsImNvbW1hbmRMaW5lIiwic2lsZW50TW9kZSIsIm5vblZhbGlkYXRpb25Nb2RlIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQU9BLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBQ0EsTUFBTTtBQUFFRSxFQUFBQSxDQUFGO0FBQUtDLEVBQUFBLGFBQUw7QUFBb0JDLEVBQUFBLGNBQXBCO0FBQW9DQyxFQUFBQTtBQUFwQyxJQUFtREwsT0FBTyxDQUFDLFVBQUQsQ0FBaEU7O0FBQ0EsTUFBTTtBQUFFTSxFQUFBQTtBQUFGLElBQWlCTixPQUFPLENBQUMsa0JBQUQsQ0FBOUI7O0FBQ0EsTUFBTTtBQUFFTyxFQUFBQSxnQkFBRjtBQUFvQkMsRUFBQUE7QUFBcEIsSUFBNkNSLE9BQU8sQ0FBQyxpQkFBRCxDQUEx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Q0FBZ0J4QyxTQUFoQixFQUFOO0FBQ0g7QUFDSjtBQW5FWSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIFBhcnNlIGNvbW1hbmQgbGluZSBhcmd1bWVudHMgdXNpbmcgbWluaW1pc3QgYW5kIHN0b3JlIHRoZSBwYXJzZWQgb2JqZWN0IGludG8gYXBwLmFyZ3YsIGFuZCBhZGQgYXBwLnNob3dVc2FnZSgpIGhlbHBlciBmdW5jdGlvblxuICogQG1vZHVsZSBGZWF0dXJlX0NvbW1hbmRMaW5lXG4gKi9cblxuY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmNvbnN0IEZlYXR1cmUgPSByZXF1aXJlKCcuLi9lbnVtL0ZlYXR1cmUnKTtcbmNvbnN0IHsgXywgcHV0SW50b0J1Y2tldCwgc2V0VmFsdWVCeVBhdGgsIGVhY2hBc3luY18gfSA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5jb25zdCB7IHRyeVJlcXVpcmUgfSA9IHJlcXVpcmUoJy4uL3V0aWxzL0hlbHBlcnMnKTtcbmNvbnN0IHsgQXBwbGljYXRpb25FcnJvciwgSW52YWxpZENvbmZpZ3VyYXRpb24gfSA9IHJlcXVpcmUoJy4uL3V0aWxzL0Vycm9ycycpXG5cbmZ1bmN0aW9uIHRyYW5zbGF0ZU1pbmltaXN0T3B0aW9ucyhvcHRzKSB7XG4gICAgbGV0IG0gPSB7fTtcblxuICAgIF8uZm9yT3duKG9wdHMsIChkZXRhaWwsIG5hbWUpID0+IHtcbiAgICAgICAgaWYgKGRldGFpbC5ib29sKSB7XG4gICAgICAgICAgICBwdXRJbnRvQnVja2V0KG0sICdib29sZWFuJywgbmFtZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwdXRJbnRvQnVja2V0KG0sICdzdHJpbmcnLCBuYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgnZGVmYXVsdCcgaW4gZGV0YWlsKSB7XG4gICAgICAgICAgICBzZXRWYWx1ZUJ5UGF0aChtLCBgZGVmYXVsdC4ke25hbWV9YCwgZGV0YWlsLmRlZmF1bHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRldGFpbC5hbGlhcykge1xuICAgICAgICAgICAgc2V0VmFsdWVCeVBhdGgobSwgYGFsaWFzLiR7bmFtZX1gLCBkZXRhaWwuYWxpYXMpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbTtcbn1cblxuZnVuY3Rpb24gb3B0aW9uRGVjb3JhdG9yKG5hbWUpIHtcbiAgICByZXR1cm4gbmFtZS5sZW5ndGggPT0gMSA/ICgnLScgKyBuYW1lKSA6ICgnLS0nICsgbmFtZSk7XG59XG5cbmNvbnN0IGdBcmd2ID0gcHJvY2Vzcy5hcmd2LnNsaWNlKDIpO1xuXG4vKipcbiAqIEVycm9yIGNhdXNlZCBieSBjb21tYW5kIGxpbmUgYXJndW1lbnRzLlxuICogQGNsYXNzXG4gKiBAZXh0ZW5kcyBBcHBsaWNhdGlvbkVycm9yICBcbiAqL1xuY2xhc3MgQ29tbWFuZExpbmVBcmd1bWVudEVycm9yIGV4dGVuZHMgQXBwbGljYXRpb25FcnJvciB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBFcnJvciBtZXNzYWdlICAgICBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSByZWxhdGVkIGNvbmZpZyBpdGVtICBcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IG5vbk9wdGlvbiAtIFdoZXRoZXIgaXQgaXMgYW4gb3B0aW9uIFxuICAgICAqLyBcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBuYW1lLCBub25PcHRpb24pIHsgICAgIFxuICAgICAgICBzdXBlcihtZXNzYWdlLCAnRV9DTElfSU5WQUxJRF9BUkcnLCB7IG5hbWUsIG5vbk9wdGlvbiB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tbWFuZCBsaW5lIGhlbHBlciBvYmplY3QuXG4gKi9cbmNsYXNzIENvbW1hbmRMaW5lIHtcbiAgICBjb25zdHJ1Y3RvcihhcHAsIHVzYWdlKSB7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLnVzYWdlID0gdXNhZ2U7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnBhcnNlKHVzYWdlLm9wdGlvbnMpO1xuICAgIH1cblxuICAgIGluamVjdFVzYWdlKGluamVjdHMpIHtcbiAgICAgICAgdGhpcy5pbmplY3RzID0gaW5qZWN0cztcbiAgICB9XG5cbiAgICBwYXJzZShvcHRpb25zKSB7ICAgICAgICBcbiAgICAgICAgY29uc3QgbWluaW1pc3QgPSB0cnlSZXF1aXJlKCdtaW5pbWlzdCcpO1xuICAgICAgICB0aGlzLmFyZ3YgPSBtaW5pbWlzdChnQXJndiwgdHJhbnNsYXRlTWluaW1pc3RPcHRpb25zKG9wdGlvbnMpKTtcbiAgICB9XG5cbiAgICBvcHRpb24obmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hcmd2W25hbWVdO1xuICAgIH1cblxuICAgIGFyZyhuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmFyZ3NbbmFtZV0pIHJldHVybiB0aGlzLmFyZ3NbbmFtZV07XG5cbiAgICAgICAgbGV0IGluZGV4ID0gXy5maW5kSW5kZXgodGhpcy51c2FnZS5hcmd1bWVudHMsIGFyZyA9PiBhcmcubmFtZSA9PT0gbmFtZSk7XG5cbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSB8fCB0aGlzLmFyZ3YuXy5sZW5ndGggPD0gaW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFyZ3MgfHwgKHRoaXMuYXJncyA9IHt9KTtcbiAgICAgICAgcmV0dXJuICh0aGlzLmFyZ3NbbmFtZV0gPSB0aGlzLmFyZ3YuX1tpbmRleF0pO1xuICAgIH1cblxuICAgIHVwZGF0ZU9wdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLmFyZ3ZbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgbGV0IG9wdHMgPSB0aGlzLnVzYWdlLm9wdGlvbnNbbmFtZV07XG4gICAgICAgIGlmIChvcHRzLmFsaWFzKSB7XG4gICAgICAgICAgICBfLmVhY2gob3B0cy5hbGlhcywgYSA9PiB7IHRoaXMuYXJndlthXSA9IHZhbHVlOyB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHZhbHVlT3JGdW5jdGlvbkNhbGxfKGZ1bmN0b3IpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBmdW5jdG9yID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgZnVuY3Rvcih0aGlzKTtcbiAgICAgICAgfSBcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBmdW5jdG9yO1xuICAgIH1cblxuICAgIGFzeW5jIGlucXVpcmVfKCkge1xuICAgICAgICBjb25zdCBpbnF1aXJlciA9IHRyeVJlcXVpcmUoJ2lucXVpcmVyJyk7XG5cbiAgICAgICAgY29uc3QgZG9JbnF1aXJlXyA9IChpdGVtLCBhcmdJbmRleCkgPT4gaW5xdWlyZXIucHJvbXB0KFtpdGVtXSkudGhlbihhbnN3ZXJzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCk7XG5cbiAgICAgICAgICAgIF8uZm9yT3duKGFuc3dlcnMsIChhbnMsIG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU9wdGlvbihuYW1lLCBhbnMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydDogdGhpcy5hcmd2Ll8ubGVuZ3RoID09PSBhcmdJbmRleDtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyZ3YuXyA9IHRoaXMuYXJndi5fLmNvbmNhdChbYW5zXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7IFxuXG4gICAgICAgIGNvbnN0IGRvRmlsdGVyXyA9IGFzeW5jIChuYW1lLCBvcHQsIGFyZ0luZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAob3B0LmZpbHRlcikge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiBvcHQuZmlsdGVyICE9PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDb25maWd1cmF0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBUaGUgXCJmaWx0ZXJcIiBpbiB0aGUgaW5xdWlyZXIgb3B0aW9uIGZvciBhcmd1bWVudCBvcHRpb24gXCIke25hbWV9XCIgc2hvdWxkIGJlIGEgZnVuY3Rpb24hYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29tbWFuZExpbmUub3B0aW9uc1ske25hbWV9XS5maWx0ZXJgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9uKG5hbWUsIGF3YWl0IG9wdC5maWx0ZXIodGhpcy5hcmd2W25hbWVdLCB0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIG9wdC5maWx0ZXIgIT09ICdmdW5jdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYFRoZSBcImZpbHRlclwiIGluIHRoZSBpbnF1aXJlciBvcHRpb24gZm9yIGFyZ3VtZW50IHZhbHVlIFwiJHtuYW1lfVwiIGF0IHBvc2l0aW9uICR7YXJnSW5kZXh9IHNob3VsZCBiZSBhIGZ1bmN0aW9uIWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYGNvbW1hbmRMaW5lLmFyZ3VtZW50c1ske2FyZ0luZGV4fV0uZmlsdGVyYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyZ3YuX1thcmdJbmRleF0gPSBhd2FpdCBvcHQuZmlsdGVyKHRoaXMuYXJndi5fW2FyZ0luZGV4XSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGFyZ0V4aXN0ID0gKG5hbWUsIGFyZ0luZGV4KSA9PiB0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnID8gKG5hbWUgaW4gdGhpcy5hcmd2KSA6ICh0aGlzLmFyZ3YuXy5sZW5ndGggPiBhcmdJbmRleCk7XG5cbiAgICAgICAgY29uc3QgcHJlcGFyZUlucXVpcmVfID0gYXN5bmMgKG9wdHMsIG5hbWUsIGFyZ0luZGV4KSA9PiB7XG4gICAgICAgICAgICBsZXQgYXJnRXhpc3RzID0gYXJnRXhpc3QobmFtZSwgYXJnSW5kZXgpO1xuXG4gICAgICAgICAgICBpZiAoKCdpbnF1aXJlJyBpbiBvcHRzKSAmJiAhYXJnRXhpc3RzKSB7IFxuICAgICAgICAgICAgICAgIC8vbmVlZCBpbnF1aXJlIGFuZCB0aGUgdmFsdWUgbm90IGdpdmVuIHRocm91Z2ggY29tbWFuZCBsaW5lXG4gICAgICAgICAgICAgICAgbGV0IGlucXVpcmUgPSB0aGlzLnZhbHVlT3JGdW5jdGlvbkNhbGxfKG9wdHMuaW5xdWlyZSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGlucXVpcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGxldCBxID0geyBuYW1lOiBuYW1lLCBtZXNzYWdlOiBvcHRzLnByb21wdE1lc3NhZ2UgfHwgb3B0cy5kZXNjIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMucHJvbXB0VHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG9wdHMucHJvbXB0VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnbGlzdCcgfHwgdHlwZSAgPT09ICdyYXdMaXN0JyB8fCB0eXBlID09PSAnY2hlY2tib3gnIHx8IHR5cGUgPT09ICdleHBhbmQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRzLmNob2ljZXNQcm92aWRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnID8gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYE1pc3NpbmcgXCJjaG9pY2VzUHJvdmlkZXJcIiBpbiB0aGUgaW5xdWlyZXIgb3B0aW9uIGZvciBhcmd1bWVudCBvcHRpb24gXCIke25hbWV9XCIhYCA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBNaXNzaW5nIFwiY2hvaWNlc1Byb3ZpZGVyXCIgaW4gdGhlIGlucXVpcmVyIG9wdGlvbiBmb3IgYXJndW1lbnQgdmFsdWUgXCIke25hbWV9XCIgYXQgcG9zdGlvbiAke2FyZ0luZGV4fSFgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJyA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjb21tYW5kTGluZS5vcHRpb25zWyR7bmFtZX1dLmNob2ljZXNQcm92aWRlcmAgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjb21tYW5kTGluZS5hcmd1bWVudHNbJHthcmdJbmRleH1dLmNob2ljZXNQcm92aWRlcmApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEuY2hvaWNlcyA9IGF3YWl0IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8ob3B0cy5jaG9pY2VzUHJvdmlkZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdHMuYm9vbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICdjb25maXJtJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnaW5wdXQnXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBxLnR5cGUgPSB0eXBlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgncHJvbXB0RGVmYXVsdCcgaW4gb3B0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcS5kZWZhdWx0ID0gYXdhaXQgdGhpcy52YWx1ZU9yRnVuY3Rpb25DYWxsXyhvcHRzLnByb21wdERlZmF1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZG9JbnF1aXJlXyhxLCBhcmdJbmRleCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZG9GaWx0ZXJfKG5hbWUsIG9wdHMsIGFyZ0luZGV4KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5hZnRlcklucXVpcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG9wdHMuYWZ0ZXJJbnF1aXJlKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFyZ0V4aXN0cykge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRvRmlsdGVyXyhuYW1lLCBvcHRzLCBhcmdJbmRleCk7XG4gICAgICAgICAgICB9IFxuXG4gICAgICAgICAgICBpZiAodGhpcy51c2FnZS5zaG93QXJndW1lbnRzICYmIGFyZ0V4aXN0KG5hbWUsIGFyZ0luZGV4KSkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnKSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdvcHRpb24nLCBuYW1lLCBgKCR7b3B0cy5kZXNjfSlgLCAnOicsIHRoaXMuYXJndltuYW1lXSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYDwke25hbWV9PmAsICc6JywgdGhpcy5hcmd2Ll9bYXJnSW5kZXhdKTtcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICghXy5pc0VtcHR5KHRoaXMudXNhZ2UuYXJndW1lbnRzKSkge1xuICAgICAgICAgICAgYXdhaXQgZWFjaEFzeW5jXyh0aGlzLnVzYWdlLmFyZ3VtZW50cywgYXN5bmMgKGFyZ09wdCwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgeyBuYW1lLCAuLi5vcHRzIH0gPSBhcmdPcHQ7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJlcGFyZUlucXVpcmVfKG9wdHMsIG5hbWUsIGluZGV4KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gXy5pc0VtcHR5KHRoaXMudXNhZ2Uub3B0aW9ucykgfHwgZWFjaEFzeW5jXyh0aGlzLnVzYWdlLm9wdGlvbnMsIChvcHRzLCBuYW1lKSA9PiBwcmVwYXJlSW5xdWlyZV8ob3B0cywgbmFtZSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIHZhbGlkYXRlIHBhcnNlZCBhbmQgZmlsbGVkIGFyZ3VtZW50IG9wdGlvbnMuXG4gICAgICovXG4gICAgYXN5bmMgdmFsaWRhdGVfKCkge1xuICAgICAgICBjb25zdCBjaGVja1JlcXVpcmVfID0gKG9wdHMpID0+IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8ob3B0cy5yZXF1aXJlZCk7XG5cbiAgICAgICAgbGV0IGVycm9ycyA9IFtdO1xuXG4gICAgICAgIGlmICghXy5pc0VtcHR5KHRoaXMudXNhZ2UuYXJndW1lbnRzKSkgeyAgICAgXG4gICAgICAgICAgICBsZXQgYXJnTnVtID0gdGhpcy5hcmd2Ll8ubGVuZ3RoO1xuXG4gICAgICAgICAgICBpZiAoYXJnTnVtIDwgdGhpcy51c2FnZS5hcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgbGV0IGFyZ3MgPSBbXTtcblxuICAgICAgICAgICAgICAgIGxldCBpID0gMDtcblxuICAgICAgICAgICAgICAgIGF3YWl0IGVhY2hBc3luY18odGhpcy51c2FnZS5hcmd1bWVudHMsIGFzeW5jIGFyZyA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGxldCByZXF1aXJlZCA9IGF3YWl0IGNoZWNrUmVxdWlyZV8oYXJnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAocmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpID49IGFyZ051bSkgeyAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbXNnID0gYE1pc3NpbmcgcmVxdWlyZWQgYXJndW1lbnQgXCIke2FyZy5uYW1lfVwiIWA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMudXNhZ2Uuc2hvd1VzYWdlT25FcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnMucHVzaChtc2cpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7ICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBDb21tYW5kTGluZUFyZ3VtZW50RXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtc2csXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmcubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoKHRoaXMuYXJndi5fW2krK10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5hcmd2Ll8gPSBhcmdzO1xuICAgICAgICAgICAgfSAgICAgICAgICAgIFxuICAgICAgICB9ICAgICAgICAgIFxuXG4gICAgICAgIHRoaXMudXNhZ2Uub3B0aW9ucyAmJiBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2Uub3B0aW9ucywgYXN5bmMgKG9wdHMsIG5hbWUpID0+IHsgICAgICBcbiAgICAgICAgICAgIGxldCByZXF1aXJlZCA9IGF3YWl0IGNoZWNrUmVxdWlyZV8ob3B0cyk7XG5cbiAgICAgICAgICAgIGlmIChyZXF1aXJlZCAmJiAhKG5hbWUgaW4gdGhpcy5hcmd2KSkge1xuICAgICAgICAgICAgICAgIGxldCBtc2cgPSBgTWlzc2luZyByZXF1aXJlZCBhcmd1bWVudCBvcHRpb24gb2YgXCIke25hbWV9XCIhYDtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzYWdlLnNob3dVc2FnZU9uRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2gobXNnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ29tbWFuZExpbmVBcmd1bWVudEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgbXNnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1VzYWdlKHtcbiAgICAgICAgICAgICAgICBhZnRlckJhbm5lcjogKCkgPT4gJ0Vycm9yKHMpOlxcbicgKyBlcnJvcnMubWFwKG1zZyA9PiAnIC0gJyArIG1zZykuam9pbignXFxuJykgKyAnXFxuXFxuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGZpbGxTaWxlbnRNb2RlRGVmYXVsdHNfKCkge1xuICAgICAgICBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2UuYXJndW1lbnRzLCBhc3luYyAoYXJnLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXJndi5fLmxlbmd0aCA8PSBpbmRleCkge1xuICAgICAgICAgICAgICAgIGlmIChhcmcuaGFzT3duUHJvcGVydHkoJ3NpbGVudE1vZGVEZWZhdWx0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuYXJndi5fLmxlbmd0aDsgaSA8IGluZGV4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJndi5fLnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJndi5fLnB1c2goYXdhaXQgdGhpcy52YWx1ZU9yRnVuY3Rpb25DYWxsXyhhcmcuc2lsZW50TW9kZURlZmF1bHQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGF3YWl0IGVhY2hBc3luY18odGhpcy51c2FnZS5vcHRpb25zLCBhc3luYyAob3B0cywgbmFtZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFyZ3YuaGFzT3duUHJvcGVydHkobmFtZSkgJiYgb3B0cy5oYXNPd25Qcm9wZXJ0eSgnc2lsZW50TW9kZURlZmF1bHQnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9uKG5hbWUsIGF3YWl0IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8ob3B0cy5zaWxlbnRNb2RlRGVmYXVsdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRCYW5uZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnVzYWdlLmJhbm5lcikge1xuICAgICAgICAgICAgbGV0IGJhbm5lciA9ICcnO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMudXNhZ2UuYmFubmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgYmFubmVyICs9IHRoaXMudXNhZ2UuYmFubmVyKHRoaXMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy51c2FnZS5iYW5uZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgYmFubmVyICs9IHRoaXMudXNhZ2UuYmFubmVyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICdJbnZhbGlkIGJhbm5lciB2YWx1ZSBvZiBjb21tYW5kTGluZSBmZWF0dXJlLicsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgICAgICBgY29tbWFuZExpbmUuYmFubmVyYFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICBiYW5uZXIgKz0gJ1xcbic7XG5cbiAgICAgICAgICAgIHJldHVybiBiYW5uZXI7XG4gICAgICAgIH0gICAgICAgIFxuXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgZ2V0VXNhZ2UoaW5qZWN0cykge1xuICAgICAgICBpbmplY3RzID0geyAuLi50aGlzLmluamVjdHMsIC4uLmluamVjdHMgfTtcblxuICAgICAgICBsZXQgdXNhZ2UgPSAnJztcblxuICAgICAgICBsZXQgYmFubmVyID0gIXRoaXMuYmFubmVyU2hvd24gJiYgdGhpcy5nZXRCYW5uZXIoKTtcbiAgICAgICAgaWYgKGJhbm5lcikge1xuICAgICAgICAgICAgdXNhZ2UgKz0gYmFubmVyICsgJ1xcbic7XG4gICAgICAgIH0gICAgICAgIFxuICAgIFxuICAgICAgICBpZiAoaW5qZWN0cyAmJiBpbmplY3RzLmFmdGVyQmFubmVyKSB7XG4gICAgICAgICAgICB1c2FnZSArPSBpbmplY3RzLmFmdGVyQmFubmVyKCk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgbGV0IGZtdEFyZ3MgPSAnJztcbiAgICAgICAgaWYgKCFfLmlzRW1wdHkodGhpcy51c2FnZS5hcmd1bWVudHMpKSB7XG4gICAgICAgICAgICBmbXRBcmdzID0gJyAnICsgdGhpcy51c2FnZS5hcmd1bWVudHMubWFwKGFyZyA9PiBhcmcucmVxdWlyZWQgPyBgPCR7YXJnLm5hbWV9PmAgOiBgWyR7YXJnLm5hbWV9XWApLmpvaW4oJyAnKTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICB1c2FnZSArPSBgVXNhZ2U6ICR7dGhpcy51c2FnZS5wcm9ncmFtIHx8IHBhdGguYmFzZW5hbWUocHJvY2Vzcy5hcmd2WzFdKX0ke2ZtdEFyZ3N9IFtvcHRpb25zXVxcblxcbmA7XG4gICAgXG4gICAgICAgIGlmIChpbmplY3RzICYmIGluamVjdHMuYWZ0ZXJDb21tYW5kTGluZSkge1xuICAgICAgICAgICAgdXNhZ2UgKz0gaW5qZWN0cy5hZnRlckNvbW1hbmRMaW5lKCk7XG4gICAgICAgIH0gXG4gICAgICAgIFxuICAgICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLnVzYWdlLm9wdGlvbnMpKSB7XG4gICAgICAgICAgICB1c2FnZSArPSBgT3B0aW9uczpcXG5gO1xuICAgICAgICAgICAgXy5mb3JPd24odGhpcy51c2FnZS5vcHRpb25zLCAob3B0cywgbmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBsaW5lID0gJyAgJyArIG9wdGlvbkRlY29yYXRvcihuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0cy5hbGlhcykge1xuICAgICAgICAgICAgICAgICAgICBsaW5lICs9IF8ucmVkdWNlKG9wdHMuYWxpYXMsIChzdW0sIGEpID0+IChzdW0gKyAnLCAnICsgb3B0aW9uRGVjb3JhdG9yKGEpKSwgJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICBsaW5lICs9ICdcXG4nO1xuICAgICAgICAgICAgICAgIGxpbmUgKz0gJyAgICAnICsgb3B0cy5kZXNjICsgJ1xcbic7XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKCdkZWZhdWx0JyBpbiBvcHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gJyAgICBkZWZhdWx0OiAnICsgb3B0cy5kZWZhdWx0LnRvU3RyaW5nKCkgKyAnXFxuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKG9wdHMucmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRzLnJlcXVpcmVkID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcgICAgY29uZGl0aW9uYWxcXG4nO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSArPSAnICAgIHJlcXVpcmVkXFxuJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvcHRzLmNob2ljZXNQcm92aWRlciAmJiBBcnJheS5pc0FycmF5KG9wdHMuY2hvaWNlc1Byb3ZpZGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcgICAgYXZhaWxhYmxlIHZhbHVlczpcXG4nO1xuICAgICAgICAgICAgICAgICAgICBvcHRzLmNob2ljZXNQcm92aWRlci5mb3JFYWNoKGNob2ljZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lICs9IGAgICAgICAgIFwiJHtjaG9pY2UudmFsdWV9XCI6ICR7Y2hvaWNlLm5hbWV9XFxuYDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIGxpbmUgKz0gJ1xcbic7XG4gICAgXG4gICAgICAgICAgICAgICAgdXNhZ2UgKz0gbGluZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9ICAgICAgICBcbiAgICBcbiAgICAgICAgaWYgKGluamVjdHMgJiYgaW5qZWN0cy5hZnRlck9wdGlvbnMpIHtcbiAgICAgICAgICAgIHVzYWdlICs9IGluamVjdHMuYWZ0ZXJPcHRpb25zKCk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgcmV0dXJuIHVzYWdlO1xuICAgIH1cblxuICAgIHNob3dCYW5uYXIoKSB7XG4gICAgICAgIGxldCBiYW5uZXIgPSB0aGlzLmdldEJhbm5lcigpO1xuICAgICAgICBpZiAoYmFubmVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhiYW5uZXIpO1xuICAgICAgICAgICAgdGhpcy5iYW5uZXJTaG93biA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgc2hvd1VzYWdlKGluamVjdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5nZXRVc2FnZShpbmplY3RzKSk7XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGZlYXR1cmUgaXMgbG9hZGVkIGF0IGNvbmZpZ3VyYXRpb24gc3RhZ2VcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgdHlwZTogRmVhdHVyZS5JTklULFxuXG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgZmVhdHVyZVxuICAgICAqIEBwYXJhbSB7QXBwfSBhcHAgLSBUaGUgY2xpIGFwcCBtb2R1bGUgb2JqZWN0XG4gICAgICogQHBhcmFtIHtvYmplY3R9IHVzYWdlT3B0aW9ucyAtIE9wdGlvbnMgZm9yIHRoZSBmZWF0dXJlICAgICBcbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3VzYWdlT3B0aW9ucy5iYW5uZXJdIC0gQmFubmVyIG1lc3NhZ2Ugb3IgYmFubmVyIGdlbmVyYXRvciBmdW5jdGlvblxuICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdXNhZ2VPcHRpb25zLnByb2dyYW1dIC0gRXhlY3V0YWJsZSBuYW1lXG4gICAgICogQHByb3BlcnR5IHthcnJheX0gW3VzYWdlT3B0aW9ucy5hcmd1bWVudHNdIC0gQ29tbWFuZCBsaW5lIGFyZ3VtZW50cywgaWRlbnRpZmllZCBieSB0aGUgcG9zaXRpb24gb2YgYXBwZWFyYW5jZVxuICAgICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBbdXNhZ2VPcHRpb25zLm9wdGlvbnNdIC0gQ29tbWFuZCBsaW5lIG9wdGlvbnMgICAgIFxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbnxmdW5jdGlvbn0gW3VzYWdlT3B0aW9ucy5zaWxlbnRNb2RlXSAtIFdoZXRoZXIgdG8gcnVuIGluIHNpbGllbnQgbW9kZSwgZGVmYXVsdCBmYWxzZVxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbnxmdW5jdGlvbn0gW3VzYWdlT3B0aW9ucy5ub25WYWxpZGF0aW9uTW9kZV0gLSBXaGV0aGVyIHRvIHJ1biB2YWxpZGF0aW9uXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFt1c2FnZU9wdGlvbnMuaGVscE9wdGlvbj0nPyddIC0gVGhlIG9wdGlvbiB3aGljaCBhY3QgYXMgaGVscFxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3VzYWdlT3B0aW9ucy5zaG93VXNhZ2VPbkVycm9yXVxuICAgICAqIFxuICAgICAqIEBleGFtcGxlXG4gICAgICogICBvcHRpb25zOiB7IFthcmd1bWVudEtleV06IHtcbiAgICAgKiAgICAgIGRlc2MsIC8vIHtzdHJpbmd9IC0gZGVzY3JpcHRpb25cbiAgICAgKiAgICAgIGFsaWFzLCAvLyB7YXJyYXkuPHN0cmluZz59IC0gYWxpYXMgYXJyYXlcbiAgICAgKiAgICAgIGJvb2wsIC8vIHtib29sZWFufSAtIHdoZXRoZXIgaXQgaXMgYSBib29sZWFuIHZhbHVlXG4gICAgICogICAgICBkZWZhdWx0LCAvLyB7Kn0gLSBkZWZhdWx0IHZhbHVlXG4gICAgICogICAgICBpbnF1aXJlLCAvLyB7Ym9vbGVhbiB8IGZ1bmN0aW9uKGNsaSkuPGJvb2xlYW4+fSAtIHdoZXRoZXIgdG8gZW5hYmxlIGludGVyYWN0aXZlIHF1ZXJ5XG4gICAgICogICAgICBwcm9tcHRNZXNzYWdlLCAvLyB7c3RyaW5nfSAtIHByb21wdCBtZXNzYWdlIGZvciBxdWVyeSwgd2lsbCB1c2UgZGVzYyBpZiBub3Qgc2V0XG4gICAgICogICAgICBwcm9tcHRUeXBlLCAvLyB7c3RyaW5nfSAtIHByb21wdCB0eXBlLCBjYW4gYmUgb25lIG9mIFsgaW5wdXQsIG51bWJlciwgY29uZmlybSwgbGlzdCwgcmF3bGlzdCwgZXhwYW5kLCBjaGVja2JveCwgcGFzc3dvcmQsIGVkaXRvciBdXG4gICAgICogICAgICBwcm9tcHREZWZhdWx0LCAvLyB7KiB8IGZ1bmN0aW9uKGNsaSkuPCo+fSAtIGRlZmF1bHQgdmFsdWUgYXBwZWFyZWQgb24gcXVlcnkgb3IgYSBhc3luYyBmdW5jdGlvbiB0byByZXR1cm4gdGhlIGRlZmF1bHQgdmFsdWVcbiAgICAgKiAgICAgIGNob2ljZXNQcm92aWRlciwgLy8ge2FycmF5IHwgZnVuY3Rpb24oY2xpKS48YXJyYXk+IHwgZnVuY3Rpb24uPGZ1bmN0aW9uKHN0cmluZykuPGFycmF5Pj59IC0gcmVxdWlyZWQgZm9yIHByb21wdCB0eXBlIGxpc3QsIHJhd2xpc3QsIGV4cGFuZCwgY2hlY2tib3hcbiAgICAgKiAgICAgIGZpbHRlciwgLy8ge2Z1bmN0aW9uKGFyZ3YsIGNsaSkuPGFyZ3Y+fSAtIGZpbHRlciB0byBwcm9jZXNzIHRoZSBhcmd1bWVudCB2YWx1ZVxuICAgICAqICAgICAgYWZ0ZXJJbnF1aXJlLCAvLyB7ZnVuY3Rpb259IC0gYWZ0ZXIgaW5xdWlyZSBob29rLFxuICAgICAqICAgICAgc2lsZW50TW9kZURlZmF1bHQgLy8geyp9IC0gZGVmYXVsdCB2YWx1ZSB3aGVuIHJ1biBpbiBzaWxpZW50IG1vZGUsXG4gICAgICogICB9IH1cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48Kj59XG4gICAgICovXG4gICAgbG9hZF86IGFzeW5jIChhcHAsIHVzYWdlT3B0aW9ucykgPT4geyAgIFxuICAgICAgICBhcHAuY29tbWFuZExpbmUgPSBuZXcgQ29tbWFuZExpbmUoYXBwLCB1c2FnZU9wdGlvbnMpOyAgICAgICAgICAgICBcblxuICAgICAgICBsZXQgc2lsZW50TW9kZSA9IHVzYWdlT3B0aW9ucy5zaWxlbnRNb2RlO1xuXG4gICAgICAgIGlmIChzaWxlbnRNb2RlICYmIHR5cGVvZiBzaWxlbnRNb2RlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBzaWxlbnRNb2RlID0gc2lsZW50TW9kZShhcHAuY29tbWFuZExpbmUpO1xuICAgICAgICB9ICBcblxuICAgICAgICBhcHAuY29tbWFuZExpbmUuc2lsZW50TW9kZSA9IHNpbGVudE1vZGU7XG5cbiAgICAgICAgaWYgKHNpbGVudE1vZGUpIHtcbiAgICAgICAgICAgIGF3YWl0IGFwcC5jb21tYW5kTGluZS5maWxsU2lsZW50TW9kZURlZmF1bHRzXygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXBwLmNvbW1hbmRMaW5lLnNob3dCYW5uYXIoKTtcbiAgICAgICAgICAgIGF3YWl0IGFwcC5jb21tYW5kTGluZS5pbnF1aXJlXygpOyAgICAgICAgICAgIFxuICAgICAgICB9ICAgICAgICBcblxuICAgICAgICBsZXQgbm9uVmFsaWRhdGlvbk1vZGUgPSB1c2FnZU9wdGlvbnMubm9uVmFsaWRhdGlvbk1vZGU7XG5cbiAgICAgICAgaWYgKG5vblZhbGlkYXRpb25Nb2RlICYmIHR5cGVvZiBub25WYWxpZGF0aW9uTW9kZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgbm9uVmFsaWRhdGlvbk1vZGUgPSBub25WYWxpZGF0aW9uTW9kZShhcHAuY29tbWFuZExpbmUpO1xuICAgICAgICB9ICBcblxuICAgICAgICBhcHAuY29tbWFuZExpbmUubm9uVmFsaWRhdGlvbk1vZGUgPSBub25WYWxpZGF0aW9uTW9kZTtcblxuICAgICAgICBpZiAoIW5vblZhbGlkYXRpb25Nb2RlKSB7ICAgICAgICAgICAgXG4gICAgICAgICAgICBhd2FpdCBhcHAuY29tbWFuZExpbmUudmFsaWRhdGVfKCk7XG4gICAgICAgIH1cbiAgICB9XG59OyJdfQ==