"use strict";

require("source-map-support/register");

const path = require('path');

const Feature = require('../enum/Feature');

const {
  _,
  pushIntoBucket,
  eachAsync_
} = require('@genx/july');

const {
  ApplicationError,
  InvalidConfiguration
} = require('@genx/error');

function translateMinimistOptions(opts) {
  let m = {};

  _.forOwn(opts, (detail, name) => {
    if (detail.bool) {
      pushIntoBucket(m, 'boolean', name);
    } else {
      pushIntoBucket(m, 'string', name);
    }

    if ('default' in detail) {
      _.set(m, `default.${name}`, detail.default);
    }

    if (detail.alias) {
      _.set(m, `alias.${name}`, detail.alias);
    }
  });

  return m;
}

function optionDecorator(name) {
  return name.length == 1 ? '-' + name : '--' + name;
}

const gArgv = process.argv.slice(2);

class CommandLineArgumentError extends ApplicationError {
  constructor(message, name, nonOption) {
    super(message, 'E_CLI_INVALID_ARG', {
      name,
      nonOption
    });
  }

}

class CommandLine {
  constructor(app, usage) {
    this.app = app;
    this.usage = usage;
    this.parse(usage.options);
  }

  injectUsage(injects) {
    this.injects = injects;
  }

  parse(options) {
    const minimist = this.app.tryRequire('minimist');
    this.argv = minimist(gArgv, translateMinimistOptions(options));
  }

  option(name) {
    return this.argv[name];
  }

  arg(name) {
    if (this.args[name]) return this.args[name];

    let index = _.findIndex(this.usage.arguments, arg => arg.name === name);

    if (index === -1 || this.argv._.length <= index) {
      return undefined;
    }

    this.args || (this.args = {});
    return this.args[name] = this.argv._[index];
  }

  updateOption(name, value) {
    this.argv[name] = value;
    let opts = this.usage.options[name];

    if (opts.alias) {
      _.each(opts.alias, a => {
        this.argv[a] = value;
      });
    }
  }

  async valueOrFunctionCall_(functor) {
    if (typeof functor === 'function') {
      return await functor(this);
    }

    return functor;
  }

  async inquire_() {
    const inquirer = this.app.tryRequire('inquirer');

    const doInquire_ = (item, argIndex) => inquirer.prompt([item]).then(answers => {
      console.log();

      _.forOwn(answers, (ans, name) => {
        if (typeof argIndex === 'undefined') {
          this.updateOption(name, ans);
        } else {
          if (!(this.argv._.length === argIndex)) {
            throw new Error("Assertion failed: this.argv._.length === argIndex");
          }

          this.argv._ = this.argv._.concat([ans]);
        }
      });
    });

    const doFilter_ = async (name, opt, argIndex) => {
      if (opt.filter) {
        if (typeof argIndex === 'undefined') {
          if (!(typeof opt.filter !== 'function')) {
            throw new InvalidConfiguration(`The "filter" in the inquirer option for argument option "${name}" should be a function!`, this.app, `commandLine.options[${name}].filter`);
          }

          this.updateOption(name, (await opt.filter(this.argv[name], this)));
        } else {
          if (!(typeof opt.filter !== 'function')) {
            throw new InvalidConfiguration(`The "filter" in the inquirer option for argument value "${name}" at position ${argIndex} should be a function!`, this.app, `commandLine.arguments[${argIndex}].filter`);
          }

          this.argv._[argIndex] = await opt.filter(this.argv._[argIndex], this);
        }
      }
    };

    const argExist = (name, argIndex) => typeof argIndex === 'undefined' ? name in this.argv : this.argv._.length > argIndex;

    const prepareInquire_ = async (opts, name, argIndex) => {
      let argExists = argExist(name, argIndex);

      if ('inquire' in opts && !argExists) {
        let inquire = this.valueOrFunctionCall_(opts.inquire);

        if (inquire) {
          let type;
          let q = {
            name: name,
            message: opts.promptMessage || opts.desc
          };

          if (opts.promptType) {
            type = opts.promptType;

            if (type === 'list' || type === 'rawList' || type === 'checkbox' || type === 'expand') {
              if (!opts.choicesProvider) {
                throw new InvalidConfiguration(typeof argIndex === 'undefined' ? `Missing "choicesProvider" in the inquirer option for argument option "${name}"!` : `Missing "choicesProvider" in the inquirer option for argument value "${name}" at postion ${argIndex}!`, app, typeof argIndex === 'undefined' ? `commandLine.options[${name}].choicesProvider` : `commandLine.arguments[${argIndex}].choicesProvider`);
              }

              q.choices = await this.valueOrFunctionCall_(opts.choicesProvider);
            }
          } else if (opts.bool) {
            type = 'confirm';
          } else {
            type = 'input';
          }

          q.type = type;

          if ('promptDefault' in opts) {
            q.default = await this.valueOrFunctionCall_(opts.promptDefault);
          }

          await doInquire_(q, argIndex);
          await doFilter_(name, opts, argIndex);

          if (opts.afterInquire) {
            await opts.afterInquire(this);
          }
        }
      } else if (argExists) {
        await doFilter_(name, opts, argIndex);

        if (opts.onArgumentExists) {
          await opts.onArgumentExists(this);
        }
      }

      if (this.usage.showArguments && argExist(name, argIndex)) {
        if (typeof argIndex === 'undefined') {
          console.log('option', name, `(${opts.desc})`, ':', this.argv[name]);
        } else {
          console.log(`<${name}>`, ':', this.argv._[argIndex]);
        }
      }
    };

    if (!_.isEmpty(this.usage.arguments)) {
      await eachAsync_(this.usage.arguments, async (argOpt, index) => {
        let {
          name,
          ...opts
        } = argOpt;
        return prepareInquire_(opts, name, index);
      });
    }

    return _.isEmpty(this.usage.options) || eachAsync_(this.usage.options, (opts, name) => prepareInquire_(opts, name));
  }

  async validate_() {
    const checkRequire_ = opts => this.valueOrFunctionCall_(opts.required);

    let errors = [];

    if (!_.isEmpty(this.usage.arguments)) {
      let argNum = this.argv._.length;

      if (argNum < this.usage.arguments.length) {
        let args = [];
        let i = 0;
        await eachAsync_(this.usage.arguments, async arg => {
          let required = await checkRequire_(arg);

          if (required) {
            if (i >= argNum) {
              let msg = `Missing required argument "${arg.name}"!`;

              if (this.usage.showUsageOnError) {
                errors.push(msg);
              } else {
                throw new CommandLineArgumentError(msg, arg.name, true);
              }
            } else {
              args.push(this.argv._[i++]);
            }
          }
        });
        this.argv._ = args;
      }
    }

    this.usage.options && (await eachAsync_(this.usage.options, async (opts, name) => {
      let required = await checkRequire_(opts);

      if (required && !(name in this.argv)) {
        let msg = `Missing required argument option of "${name}"!`;

        if (this.usage.showUsageOnError) {
          errors.push(msg);
        } else {
          throw new CommandLineArgumentError(msg, name);
        }
      }
    }));

    if (errors.length > 0) {
      this.showUsage({
        afterBanner: () => 'Error(s):\n' + errors.map(msg => ' - ' + msg).join('\n') + '\n\n'
      });
      process.exit(1);
    }
  }

  async fillSilentModeDefaults_() {
    await eachAsync_(this.usage.arguments, async (arg, index) => {
      if (this.argv._.length <= index) {
        if (arg.hasOwnProperty('silentModeDefault')) {
          for (let i = this.argv._.length; i < index; i++) {
            this.argv._.push(undefined);
          }

          this.argv._.push((await this.valueOrFunctionCall_(arg.silentModeDefault)));
        }
      }
    });
    await eachAsync_(this.usage.options, async (opts, name) => {
      if (!this.argv.hasOwnProperty(name) && opts.hasOwnProperty('silentModeDefault')) {
        this.updateOption(name, (await this.valueOrFunctionCall_(opts.silentModeDefault)));
      }
    });
  }

  getBanner() {
    if (this.usage.banner) {
      let banner = '';

      if (typeof this.usage.banner === 'function') {
        banner += this.usage.banner(this);
      } else if (typeof this.usage.banner === 'string') {
        banner += this.usage.banner;
      } else {
        throw new InvalidConfiguration('Invalid banner value of commandLine feature.', this.app, `commandLine.banner`);
      }

      banner += '\n';
      return banner;
    }

    return undefined;
  }

  getUsage(injects) {
    injects = { ...this.injects,
      ...injects
    };
    let usage = '';
    let banner = !this.bannerShown && this.getBanner();

    if (banner) {
      usage += banner + '\n';
    }

    if (injects && injects.afterBanner) {
      usage += injects.afterBanner();
    }

    let fmtArgs = '';

    if (!_.isEmpty(this.usage.arguments)) {
      fmtArgs = ' ' + this.usage.arguments.map(arg => arg.required ? `<${arg.name}>` : `[${arg.name}]`).join(' ');
    }

    usage += `Usage: ${this.usage.program || path.basename(process.argv[1])}${fmtArgs} [options]\n\n`;

    if (injects && injects.afterCommandLine) {
      usage += injects.afterCommandLine();
    }

    if (!_.isEmpty(this.usage.options)) {
      usage += `Options:\n`;

      _.forOwn(this.usage.options, (opts, name) => {
        let line = '  ' + optionDecorator(name);

        if (opts.alias) {
          line += _.reduce(opts.alias, (sum, a) => sum + ', ' + optionDecorator(a), '');
        }

        line += '\n';
        line += '    ' + opts.desc + '\n';

        if ('default' in opts) {
          line += '    default: ' + opts.default.toString() + '\n';
        }

        if (opts.required) {
          if (typeof opts.required === 'function') {
            line += '    conditional\n';
          } else {
            line += '    required\n';
          }
        }

        if (opts.choicesProvider && Array.isArray(opts.choicesProvider)) {
          line += '    available values:\n';
          opts.choicesProvider.forEach(choice => {
            line += `        "${choice.value}": ${choice.name}\n`;
          });
        }

        line += '\n';
        usage += line;
      });
    }

    if (injects && injects.afterOptions) {
      usage += injects.afterOptions();
    }

    return usage;
  }

  showBannar() {
    let banner = this.getBanner();

    if (banner) {
      console.log(banner);
      this.bannerShown = true;
    }
  }

  showUsage(injects) {
    console.log(this.getUsage(injects));
  }

}

module.exports = {
  type: Feature.INIT,
  load_: async (app, usageOptions) => {
    app.commandLine = new CommandLine(app, usageOptions);
    let silentMode = usageOptions.silentMode;

    if (silentMode && typeof silentMode === 'function') {
      silentMode = silentMode(app.commandLine);
    }

    app.commandLine.silentMode = silentMode;

    if (silentMode) {
      await app.commandLine.fillSilentModeDefaults_();
    } else {
      app.commandLine.showBannar();
      await app.commandLine.inquire_();
    }

    let nonValidationMode = usageOptions.nonValidationMode;

    if (nonValidationMode && typeof nonValidationMode === 'function') {
      nonValidationMode = nonValidationMode(app.commandLine);
    }

    app.commandLine.nonValidationMode = nonValidationMode;

    if (!nonValidationMode) {
      await app.commandLine.validate_();
    }
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9jb21tYW5kTGluZS5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsIkZlYXR1cmUiLCJfIiwicHVzaEludG9CdWNrZXQiLCJlYWNoQXN5bmNfIiwiQXBwbGljYXRpb25FcnJvciIsIkludmFsaWRDb25maWd1cmF0aW9uIiwidHJhbnNsYXRlTWluaW1pc3RPcHRpb25zIiwib3B0cyIsIm0iLCJmb3JPd24iLCJkZXRhaWwiLCJuYW1lIiwiYm9vbCIsInNldCIsImRlZmF1bHQiLCJhbGlhcyIsIm9wdGlvbkRlY29yYXRvciIsImxlbmd0aCIsImdBcmd2IiwicHJvY2VzcyIsImFyZ3YiLCJzbGljZSIsIkNvbW1hbmRMaW5lQXJndW1lbnRFcnJvciIsImNvbnN0cnVjdG9yIiwibWVzc2FnZSIsIm5vbk9wdGlvbiIsIkNvbW1hbmRMaW5lIiwiYXBwIiwidXNhZ2UiLCJwYXJzZSIsIm9wdGlvbnMiLCJpbmplY3RVc2FnZSIsImluamVjdHMiLCJtaW5pbWlzdCIsInRyeVJlcXVpcmUiLCJvcHRpb24iLCJhcmciLCJhcmdzIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJ1cGRhdGVPcHRpb24iLCJ2YWx1ZSIsImVhY2giLCJhIiwidmFsdWVPckZ1bmN0aW9uQ2FsbF8iLCJmdW5jdG9yIiwiaW5xdWlyZV8iLCJpbnF1aXJlciIsImRvSW5xdWlyZV8iLCJpdGVtIiwiYXJnSW5kZXgiLCJwcm9tcHQiLCJ0aGVuIiwiYW5zd2VycyIsImNvbnNvbGUiLCJsb2ciLCJhbnMiLCJjb25jYXQiLCJkb0ZpbHRlcl8iLCJvcHQiLCJmaWx0ZXIiLCJhcmdFeGlzdCIsInByZXBhcmVJbnF1aXJlXyIsImFyZ0V4aXN0cyIsImlucXVpcmUiLCJ0eXBlIiwicSIsInByb21wdE1lc3NhZ2UiLCJkZXNjIiwicHJvbXB0VHlwZSIsImNob2ljZXNQcm92aWRlciIsImNob2ljZXMiLCJwcm9tcHREZWZhdWx0IiwiYWZ0ZXJJbnF1aXJlIiwib25Bcmd1bWVudEV4aXN0cyIsInNob3dBcmd1bWVudHMiLCJpc0VtcHR5IiwiYXJnT3B0IiwidmFsaWRhdGVfIiwiY2hlY2tSZXF1aXJlXyIsInJlcXVpcmVkIiwiZXJyb3JzIiwiYXJnTnVtIiwiaSIsIm1zZyIsInNob3dVc2FnZU9uRXJyb3IiLCJwdXNoIiwic2hvd1VzYWdlIiwiYWZ0ZXJCYW5uZXIiLCJtYXAiLCJqb2luIiwiZXhpdCIsImZpbGxTaWxlbnRNb2RlRGVmYXVsdHNfIiwiaGFzT3duUHJvcGVydHkiLCJzaWxlbnRNb2RlRGVmYXVsdCIsImdldEJhbm5lciIsImJhbm5lciIsImdldFVzYWdlIiwiYmFubmVyU2hvd24iLCJmbXRBcmdzIiwicHJvZ3JhbSIsImJhc2VuYW1lIiwiYWZ0ZXJDb21tYW5kTGluZSIsImxpbmUiLCJyZWR1Y2UiLCJzdW0iLCJ0b1N0cmluZyIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJjaG9pY2UiLCJhZnRlck9wdGlvbnMiLCJzaG93QmFubmFyIiwibW9kdWxlIiwiZXhwb3J0cyIsIklOSVQiLCJsb2FkXyIsInVzYWdlT3B0aW9ucyIsImNvbW1hbmRMaW5lIiwic2lsZW50TW9kZSIsIm5vblZhbGlkYXRpb25Nb2RlIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQU9BLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBQ0EsTUFBTTtBQUFFRSxFQUFBQSxDQUFGO0FBQUtDLEVBQUFBLGNBQUw7QUFBcUJDLEVBQUFBO0FBQXJCLElBQW9DSixPQUFPLENBQUMsWUFBRCxDQUFqRDs7QUFDQSxNQUFNO0FBQUVLLEVBQUFBLGdCQUFGO0FBQW9CQyxFQUFBQTtBQUFwQixJQUE2Q04sT0FBTyxDQUFDLGFBQUQsQ0FBMUQ7O0FBRUEsU0FBU08sd0JBQVQsQ0FBa0NDLElBQWxDLEVBQXdDO0FBQ3BDLE1BQUlDLENBQUMsR0FBRyxFQUFSOztB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QW9DQSxpQkFBcEM7O0FBRUEsUUFBSSxDQUFDQSxpQkFBTCxFQUF3QjtBQUNwQixZQUFNL0YsR0FBRyxDQUFDNkYsV0FBSixDQUFnQnhDLFNBQWhCLEVBQU47QUFDSDtBQUNKO0FBcEVZLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogUGFyc2UgY29tbWFuZCBsaW5lIGFyZ3VtZW50cyB1c2luZyBtaW5pbWlzdCBhbmQgc3RvcmUgdGhlIHBhcnNlZCBvYmplY3QgaW50byBhcHAuYXJndiwgYW5kIGFkZCBhcHAuc2hvd1VzYWdlKCkgaGVscGVyIGZ1bmN0aW9uXG4gKiBAbW9kdWxlIEZlYXR1cmVfQ29tbWFuZExpbmVcbiAqL1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgRmVhdHVyZSA9IHJlcXVpcmUoJy4uL2VudW0vRmVhdHVyZScpO1xuY29uc3QgeyBfLCBwdXNoSW50b0J1Y2tldCwgZWFjaEFzeW5jXyB9ID0gcmVxdWlyZSgnQGdlbngvanVseScpO1xuY29uc3QgeyBBcHBsaWNhdGlvbkVycm9yLCBJbnZhbGlkQ29uZmlndXJhdGlvbiB9ID0gcmVxdWlyZSgnQGdlbngvZXJyb3InKVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVNaW5pbWlzdE9wdGlvbnMob3B0cykge1xuICAgIGxldCBtID0ge307XG5cbiAgICBfLmZvck93bihvcHRzLCAoZGV0YWlsLCBuYW1lKSA9PiB7XG4gICAgICAgIGlmIChkZXRhaWwuYm9vbCkge1xuICAgICAgICAgICAgcHVzaEludG9CdWNrZXQobSwgJ2Jvb2xlYW4nLCBuYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHB1c2hJbnRvQnVja2V0KG0sICdzdHJpbmcnLCBuYW1lKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICgnZGVmYXVsdCcgaW4gZGV0YWlsKSB7XG4gICAgICAgICAgICBfLnNldChtLCBgZGVmYXVsdC4ke25hbWV9YCwgZGV0YWlsLmRlZmF1bHQpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGRldGFpbC5hbGlhcykge1xuICAgICAgICAgICAgXy5zZXQobSwgYGFsaWFzLiR7bmFtZX1gLCBkZXRhaWwuYWxpYXMpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbTtcbn1cblxuZnVuY3Rpb24gb3B0aW9uRGVjb3JhdG9yKG5hbWUpIHtcbiAgICByZXR1cm4gbmFtZS5sZW5ndGggPT0gMSA/ICgnLScgKyBuYW1lKSA6ICgnLS0nICsgbmFtZSk7XG59XG5cbmNvbnN0IGdBcmd2ID0gcHJvY2Vzcy5hcmd2LnNsaWNlKDIpO1xuXG4vKipcbiAqIEVycm9yIGNhdXNlZCBieSBjb21tYW5kIGxpbmUgYXJndW1lbnRzLlxuICogQGNsYXNzXG4gKiBAZXh0ZW5kcyBBcHBsaWNhdGlvbkVycm9yICBcbiAqL1xuY2xhc3MgQ29tbWFuZExpbmVBcmd1bWVudEVycm9yIGV4dGVuZHMgQXBwbGljYXRpb25FcnJvciB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2UgLSBFcnJvciBtZXNzYWdlICAgICBcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSByZWxhdGVkIGNvbmZpZyBpdGVtICBcbiAgICAgKiBAcGFyYW0ge2Jvb2xlYW59IG5vbk9wdGlvbiAtIFdoZXRoZXIgaXQgaXMgYW4gb3B0aW9uIFxuICAgICAqLyBcbiAgICBjb25zdHJ1Y3RvcihtZXNzYWdlLCBuYW1lLCBub25PcHRpb24pIHsgICAgIFxuICAgICAgICBzdXBlcihtZXNzYWdlLCAnRV9DTElfSU5WQUxJRF9BUkcnLCB7IG5hbWUsIG5vbk9wdGlvbiB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29tbWFuZCBsaW5lIGhlbHBlciBvYmplY3QuXG4gKi9cbmNsYXNzIENvbW1hbmRMaW5lIHtcbiAgICBjb25zdHJ1Y3RvcihhcHAsIHVzYWdlKSB7XG4gICAgICAgIHRoaXMuYXBwID0gYXBwO1xuICAgICAgICB0aGlzLnVzYWdlID0gdXNhZ2U7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnBhcnNlKHVzYWdlLm9wdGlvbnMpO1xuICAgIH1cblxuICAgIGluamVjdFVzYWdlKGluamVjdHMpIHtcbiAgICAgICAgdGhpcy5pbmplY3RzID0gaW5qZWN0cztcbiAgICB9XG5cbiAgICBwYXJzZShvcHRpb25zKSB7ICAgICAgICBcbiAgICAgICAgY29uc3QgbWluaW1pc3QgPSB0aGlzLmFwcC50cnlSZXF1aXJlKCdtaW5pbWlzdCcpO1xuICAgICAgICB0aGlzLmFyZ3YgPSBtaW5pbWlzdChnQXJndiwgdHJhbnNsYXRlTWluaW1pc3RPcHRpb25zKG9wdGlvbnMpKTtcbiAgICB9XG5cbiAgICBvcHRpb24obmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hcmd2W25hbWVdO1xuICAgIH1cblxuICAgIGFyZyhuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLmFyZ3NbbmFtZV0pIHJldHVybiB0aGlzLmFyZ3NbbmFtZV07XG5cbiAgICAgICAgbGV0IGluZGV4ID0gXy5maW5kSW5kZXgodGhpcy51c2FnZS5hcmd1bWVudHMsIGFyZyA9PiBhcmcubmFtZSA9PT0gbmFtZSk7XG5cbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSB8fCB0aGlzLmFyZ3YuXy5sZW5ndGggPD0gaW5kZXgpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFyZ3MgfHwgKHRoaXMuYXJncyA9IHt9KTtcbiAgICAgICAgcmV0dXJuICh0aGlzLmFyZ3NbbmFtZV0gPSB0aGlzLmFyZ3YuX1tpbmRleF0pO1xuICAgIH1cblxuICAgIHVwZGF0ZU9wdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICB0aGlzLmFyZ3ZbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgbGV0IG9wdHMgPSB0aGlzLnVzYWdlLm9wdGlvbnNbbmFtZV07XG4gICAgICAgIGlmIChvcHRzLmFsaWFzKSB7XG4gICAgICAgICAgICBfLmVhY2gob3B0cy5hbGlhcywgYSA9PiB7IHRoaXMuYXJndlthXSA9IHZhbHVlOyB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIHZhbHVlT3JGdW5jdGlvbkNhbGxfKGZ1bmN0b3IpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBmdW5jdG9yID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgZnVuY3Rvcih0aGlzKTtcbiAgICAgICAgfSBcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBmdW5jdG9yO1xuICAgIH1cblxuICAgIGFzeW5jIGlucXVpcmVfKCkge1xuICAgICAgICBjb25zdCBpbnF1aXJlciA9IHRoaXMuYXBwLnRyeVJlcXVpcmUoJ2lucXVpcmVyJyk7XG5cbiAgICAgICAgY29uc3QgZG9JbnF1aXJlXyA9IChpdGVtLCBhcmdJbmRleCkgPT4gaW5xdWlyZXIucHJvbXB0KFtpdGVtXSkudGhlbihhbnN3ZXJzID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCk7XG5cbiAgICAgICAgICAgIF8uZm9yT3duKGFuc3dlcnMsIChhbnMsIG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU9wdGlvbihuYW1lLCBhbnMpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2VydDogdGhpcy5hcmd2Ll8ubGVuZ3RoID09PSBhcmdJbmRleDtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyZ3YuXyA9IHRoaXMuYXJndi5fLmNvbmNhdChbYW5zXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7IFxuXG4gICAgICAgIGNvbnN0IGRvRmlsdGVyXyA9IGFzeW5jIChuYW1lLCBvcHQsIGFyZ0luZGV4KSA9PiB7XG4gICAgICAgICAgICBpZiAob3B0LmZpbHRlcikge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiBvcHQuZmlsdGVyICE9PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDb25maWd1cmF0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBUaGUgXCJmaWx0ZXJcIiBpbiB0aGUgaW5xdWlyZXIgb3B0aW9uIGZvciBhcmd1bWVudCBvcHRpb24gXCIke25hbWV9XCIgc2hvdWxkIGJlIGEgZnVuY3Rpb24hYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29tbWFuZExpbmUub3B0aW9uc1ske25hbWV9XS5maWx0ZXJgKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9uKG5hbWUsIGF3YWl0IG9wdC5maWx0ZXIodGhpcy5hcmd2W25hbWVdLCB0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEodHlwZW9mIG9wdC5maWx0ZXIgIT09ICdmdW5jdGlvbicpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYFRoZSBcImZpbHRlclwiIGluIHRoZSBpbnF1aXJlciBvcHRpb24gZm9yIGFyZ3VtZW50IHZhbHVlIFwiJHtuYW1lfVwiIGF0IHBvc2l0aW9uICR7YXJnSW5kZXh9IHNob3VsZCBiZSBhIGZ1bmN0aW9uIWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYGNvbW1hbmRMaW5lLmFyZ3VtZW50c1ske2FyZ0luZGV4fV0uZmlsdGVyYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyZ3YuX1thcmdJbmRleF0gPSBhd2FpdCBvcHQuZmlsdGVyKHRoaXMuYXJndi5fW2FyZ0luZGV4XSwgdGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGFyZ0V4aXN0ID0gKG5hbWUsIGFyZ0luZGV4KSA9PiB0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnID8gKG5hbWUgaW4gdGhpcy5hcmd2KSA6ICh0aGlzLmFyZ3YuXy5sZW5ndGggPiBhcmdJbmRleCk7XG5cbiAgICAgICAgY29uc3QgcHJlcGFyZUlucXVpcmVfID0gYXN5bmMgKG9wdHMsIG5hbWUsIGFyZ0luZGV4KSA9PiB7XG4gICAgICAgICAgICBsZXQgYXJnRXhpc3RzID0gYXJnRXhpc3QobmFtZSwgYXJnSW5kZXgpO1xuXG4gICAgICAgICAgICBpZiAoKCdpbnF1aXJlJyBpbiBvcHRzKSAmJiAhYXJnRXhpc3RzKSB7IFxuICAgICAgICAgICAgICAgIC8vbmVlZCBpbnF1aXJlIGFuZCB0aGUgdmFsdWUgbm90IGdpdmVuIHRocm91Z2ggY29tbWFuZCBsaW5lXG4gICAgICAgICAgICAgICAgbGV0IGlucXVpcmUgPSB0aGlzLnZhbHVlT3JGdW5jdGlvbkNhbGxfKG9wdHMuaW5xdWlyZSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYgKGlucXVpcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGU7XG4gICAgICAgICAgICAgICAgICAgIGxldCBxID0geyBuYW1lOiBuYW1lLCBtZXNzYWdlOiBvcHRzLnByb21wdE1lc3NhZ2UgfHwgb3B0cy5kZXNjIH07XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMucHJvbXB0VHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9IG9wdHMucHJvbXB0VHlwZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnbGlzdCcgfHwgdHlwZSAgPT09ICdyYXdMaXN0JyB8fCB0eXBlID09PSAnY2hlY2tib3gnIHx8IHR5cGUgPT09ICdleHBhbmQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvcHRzLmNob2ljZXNQcm92aWRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgYXJnSW5kZXggPT09ICd1bmRlZmluZWQnID8gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYE1pc3NpbmcgXCJjaG9pY2VzUHJvdmlkZXJcIiBpbiB0aGUgaW5xdWlyZXIgb3B0aW9uIGZvciBhcmd1bWVudCBvcHRpb24gXCIke25hbWV9XCIhYCA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBNaXNzaW5nIFwiY2hvaWNlc1Byb3ZpZGVyXCIgaW4gdGhlIGlucXVpcmVyIG9wdGlvbiBmb3IgYXJndW1lbnQgdmFsdWUgXCIke25hbWV9XCIgYXQgcG9zdGlvbiAke2FyZ0luZGV4fSFgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXBwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJyA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjb21tYW5kTGluZS5vcHRpb25zWyR7bmFtZX1dLmNob2ljZXNQcm92aWRlcmAgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjb21tYW5kTGluZS5hcmd1bWVudHNbJHthcmdJbmRleH1dLmNob2ljZXNQcm92aWRlcmApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHEuY2hvaWNlcyA9IGF3YWl0IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8ob3B0cy5jaG9pY2VzUHJvdmlkZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9wdHMuYm9vbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZSA9ICdjb25maXJtJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnaW5wdXQnXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBxLnR5cGUgPSB0eXBlO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICgncHJvbXB0RGVmYXVsdCcgaW4gb3B0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcS5kZWZhdWx0ID0gYXdhaXQgdGhpcy52YWx1ZU9yRnVuY3Rpb25DYWxsXyhvcHRzLnByb21wdERlZmF1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZG9JbnF1aXJlXyhxLCBhcmdJbmRleCk7XG5cbiAgICAgICAgICAgICAgICAgICAgYXdhaXQgZG9GaWx0ZXJfKG5hbWUsIG9wdHMsIGFyZ0luZGV4KTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAob3B0cy5hZnRlcklucXVpcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG9wdHMuYWZ0ZXJJbnF1aXJlKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGFyZ0V4aXN0cykge1xuICAgICAgICAgICAgICAgIGF3YWl0IGRvRmlsdGVyXyhuYW1lLCBvcHRzLCBhcmdJbmRleCk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdHMub25Bcmd1bWVudEV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcHRzLm9uQXJndW1lbnRFeGlzdHModGhpcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBcblxuICAgICAgICAgICAgaWYgKHRoaXMudXNhZ2Uuc2hvd0FyZ3VtZW50cyAmJiBhcmdFeGlzdChuYW1lLCBhcmdJbmRleCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJykgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb3B0aW9uJywgbmFtZSwgYCgke29wdHMuZGVzY30pYCwgJzonLCB0aGlzLmFyZ3ZbbmFtZV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGA8JHtuYW1lfT5gLCAnOicsIHRoaXMuYXJndi5fW2FyZ0luZGV4XSk7XG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLnVzYWdlLmFyZ3VtZW50cykpIHtcbiAgICAgICAgICAgIGF3YWl0IGVhY2hBc3luY18odGhpcy51c2FnZS5hcmd1bWVudHMsIGFzeW5jIChhcmdPcHQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHsgbmFtZSwgLi4ub3B0cyB9ID0gYXJnT3B0O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZXBhcmVJbnF1aXJlXyhvcHRzLCBuYW1lLCBpbmRleCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIF8uaXNFbXB0eSh0aGlzLnVzYWdlLm9wdGlvbnMpIHx8IGVhY2hBc3luY18odGhpcy51c2FnZS5vcHRpb25zLCAob3B0cywgbmFtZSkgPT4gcHJlcGFyZUlucXVpcmVfKG9wdHMsIG5hbWUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB2YWxpZGF0ZSBwYXJzZWQgYW5kIGZpbGxlZCBhcmd1bWVudCBvcHRpb25zLlxuICAgICAqL1xuICAgIGFzeW5jIHZhbGlkYXRlXygpIHtcbiAgICAgICAgY29uc3QgY2hlY2tSZXF1aXJlXyA9IChvcHRzKSA9PiB0aGlzLnZhbHVlT3JGdW5jdGlvbkNhbGxfKG9wdHMucmVxdWlyZWQpO1xuXG4gICAgICAgIGxldCBlcnJvcnMgPSBbXTtcblxuICAgICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLnVzYWdlLmFyZ3VtZW50cykpIHsgICAgIFxuICAgICAgICAgICAgbGV0IGFyZ051bSA9IHRoaXMuYXJndi5fLmxlbmd0aDtcblxuICAgICAgICAgICAgaWYgKGFyZ051bSA8IHRoaXMudXNhZ2UuYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGxldCBhcmdzID0gW107XG5cbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2UuYXJndW1lbnRzLCBhc3luYyBhcmcgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWlyZWQgPSBhd2FpdCBjaGVja1JlcXVpcmVfKGFyZyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+PSBhcmdOdW0pIHsgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1zZyA9IGBNaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50IFwiJHthcmcubmFtZX1cIiFgO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzYWdlLnNob3dVc2FnZU9uRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2gobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ29tbWFuZExpbmVBcmd1bWVudEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh0aGlzLmFyZ3YuX1tpKytdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYXJndi5fID0gYXJncztcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcbiAgICAgICAgfSAgICAgICAgICBcblxuICAgICAgICB0aGlzLnVzYWdlLm9wdGlvbnMgJiYgYXdhaXQgZWFjaEFzeW5jXyh0aGlzLnVzYWdlLm9wdGlvbnMsIGFzeW5jIChvcHRzLCBuYW1lKSA9PiB7ICAgICAgXG4gICAgICAgICAgICBsZXQgcmVxdWlyZWQgPSBhd2FpdCBjaGVja1JlcXVpcmVfKG9wdHMpO1xuXG4gICAgICAgICAgICBpZiAocmVxdWlyZWQgJiYgIShuYW1lIGluIHRoaXMuYXJndikpIHtcbiAgICAgICAgICAgICAgICBsZXQgbXNnID0gYE1pc3NpbmcgcmVxdWlyZWQgYXJndW1lbnQgb3B0aW9uIG9mIFwiJHtuYW1lfVwiIWA7XG5cbiAgICAgICAgICAgICAgICBpZiAodGhpcy51c2FnZS5zaG93VXNhZ2VPbkVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGVycm9ycy5wdXNoKG1zZyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IENvbW1hbmRMaW5lQXJndW1lbnRFcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgIG1zZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLnNob3dVc2FnZSh7XG4gICAgICAgICAgICAgICAgYWZ0ZXJCYW5uZXI6ICgpID0+ICdFcnJvcihzKTpcXG4nICsgZXJyb3JzLm1hcChtc2cgPT4gJyAtICcgKyBtc2cpLmpvaW4oJ1xcbicpICsgJ1xcblxcbidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBmaWxsU2lsZW50TW9kZURlZmF1bHRzXygpIHtcbiAgICAgICAgYXdhaXQgZWFjaEFzeW5jXyh0aGlzLnVzYWdlLmFyZ3VtZW50cywgYXN5bmMgKGFyZywgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmFyZ3YuXy5sZW5ndGggPD0gaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXJnLmhhc093blByb3BlcnR5KCdzaWxlbnRNb2RlRGVmYXVsdCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmFyZ3YuXy5sZW5ndGg7IGkgPCBpbmRleDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmFyZ3YuXy5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFyZ3YuXy5wdXNoKGF3YWl0IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8oYXJnLnNpbGVudE1vZGVEZWZhdWx0KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2Uub3B0aW9ucywgYXN5bmMgKG9wdHMsIG5hbWUpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5hcmd2Lmhhc093blByb3BlcnR5KG5hbWUpICYmIG9wdHMuaGFzT3duUHJvcGVydHkoJ3NpbGVudE1vZGVEZWZhdWx0JykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU9wdGlvbihuYW1lLCBhd2FpdCB0aGlzLnZhbHVlT3JGdW5jdGlvbkNhbGxfKG9wdHMuc2lsZW50TW9kZURlZmF1bHQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZ2V0QmFubmVyKCkge1xuICAgICAgICBpZiAodGhpcy51c2FnZS5iYW5uZXIpIHtcbiAgICAgICAgICAgIGxldCBiYW5uZXIgPSAnJztcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLnVzYWdlLmJhbm5lciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIGJhbm5lciArPSB0aGlzLnVzYWdlLmJhbm5lcih0aGlzKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMudXNhZ2UuYmFubmVyID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIGJhbm5lciArPSB0aGlzLnVzYWdlLmJhbm5lcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDb25maWd1cmF0aW9uKFxuICAgICAgICAgICAgICAgICAgICAnSW52YWxpZCBiYW5uZXIgdmFsdWUgb2YgY29tbWFuZExpbmUgZmVhdHVyZS4nLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcCxcbiAgICAgICAgICAgICAgICAgICAgYGNvbW1hbmRMaW5lLmJhbm5lcmBcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgYmFubmVyICs9ICdcXG4nO1xuXG4gICAgICAgICAgICByZXR1cm4gYmFubmVyO1xuICAgICAgICB9ICAgICAgICBcblxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGdldFVzYWdlKGluamVjdHMpIHtcbiAgICAgICAgaW5qZWN0cyA9IHsgLi4udGhpcy5pbmplY3RzLCAuLi5pbmplY3RzIH07XG5cbiAgICAgICAgbGV0IHVzYWdlID0gJyc7XG5cbiAgICAgICAgbGV0IGJhbm5lciA9ICF0aGlzLmJhbm5lclNob3duICYmIHRoaXMuZ2V0QmFubmVyKCk7XG4gICAgICAgIGlmIChiYW5uZXIpIHtcbiAgICAgICAgICAgIHVzYWdlICs9IGJhbm5lciArICdcXG4nO1xuICAgICAgICB9ICAgICAgICBcbiAgICBcbiAgICAgICAgaWYgKGluamVjdHMgJiYgaW5qZWN0cy5hZnRlckJhbm5lcikge1xuICAgICAgICAgICAgdXNhZ2UgKz0gaW5qZWN0cy5hZnRlckJhbm5lcigpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIGxldCBmbXRBcmdzID0gJyc7XG4gICAgICAgIGlmICghXy5pc0VtcHR5KHRoaXMudXNhZ2UuYXJndW1lbnRzKSkge1xuICAgICAgICAgICAgZm10QXJncyA9ICcgJyArIHRoaXMudXNhZ2UuYXJndW1lbnRzLm1hcChhcmcgPT4gYXJnLnJlcXVpcmVkID8gYDwke2FyZy5uYW1lfT5gIDogYFske2FyZy5uYW1lfV1gKS5qb2luKCcgJyk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgdXNhZ2UgKz0gYFVzYWdlOiAke3RoaXMudXNhZ2UucHJvZ3JhbSB8fCBwYXRoLmJhc2VuYW1lKHByb2Nlc3MuYXJndlsxXSl9JHtmbXRBcmdzfSBbb3B0aW9uc11cXG5cXG5gO1xuICAgIFxuICAgICAgICBpZiAoaW5qZWN0cyAmJiBpbmplY3RzLmFmdGVyQ29tbWFuZExpbmUpIHtcbiAgICAgICAgICAgIHVzYWdlICs9IGluamVjdHMuYWZ0ZXJDb21tYW5kTGluZSgpO1xuICAgICAgICB9IFxuICAgICAgICBcbiAgICAgICAgaWYgKCFfLmlzRW1wdHkodGhpcy51c2FnZS5vcHRpb25zKSkge1xuICAgICAgICAgICAgdXNhZ2UgKz0gYE9wdGlvbnM6XFxuYDtcbiAgICAgICAgICAgIF8uZm9yT3duKHRoaXMudXNhZ2Uub3B0aW9ucywgKG9wdHMsIG5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICBsZXQgbGluZSA9ICcgICcgKyBvcHRpb25EZWNvcmF0b3IobmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKG9wdHMuYWxpYXMpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluZSArPSBfLnJlZHVjZShvcHRzLmFsaWFzLCAoc3VtLCBhKSA9PiAoc3VtICsgJywgJyArIG9wdGlvbkRlY29yYXRvcihhKSksICcnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgbGluZSArPSAnXFxuJztcbiAgICAgICAgICAgICAgICBsaW5lICs9ICcgICAgJyArIG9wdHMuZGVzYyArICdcXG4nO1xuICAgIFxuICAgICAgICAgICAgICAgIGlmICgnZGVmYXVsdCcgaW4gb3B0cykge1xuICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcgICAgZGVmYXVsdDogJyArIG9wdHMuZGVmYXVsdC50b1N0cmluZygpICsgJ1xcbic7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIGlmIChvcHRzLnJlcXVpcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0cy5yZXF1aXJlZCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSArPSAnICAgIGNvbmRpdGlvbmFsXFxuJztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gJyAgICByZXF1aXJlZFxcbic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAob3B0cy5jaG9pY2VzUHJvdmlkZXIgJiYgQXJyYXkuaXNBcnJheShvcHRzLmNob2ljZXNQcm92aWRlcikpIHtcbiAgICAgICAgICAgICAgICAgICAgbGluZSArPSAnICAgIGF2YWlsYWJsZSB2YWx1ZXM6XFxuJztcbiAgICAgICAgICAgICAgICAgICAgb3B0cy5jaG9pY2VzUHJvdmlkZXIuZm9yRWFjaChjaG9pY2UgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSArPSBgICAgICAgICBcIiR7Y2hvaWNlLnZhbHVlfVwiOiAke2Nob2ljZS5uYW1lfVxcbmA7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICBsaW5lICs9ICdcXG4nO1xuICAgIFxuICAgICAgICAgICAgICAgIHVzYWdlICs9IGxpbmU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSAgICAgICAgXG4gICAgXG4gICAgICAgIGlmIChpbmplY3RzICYmIGluamVjdHMuYWZ0ZXJPcHRpb25zKSB7XG4gICAgICAgICAgICB1c2FnZSArPSBpbmplY3RzLmFmdGVyT3B0aW9ucygpO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJldHVybiB1c2FnZTtcbiAgICB9XG5cbiAgICBzaG93QmFubmFyKCkge1xuICAgICAgICBsZXQgYmFubmVyID0gdGhpcy5nZXRCYW5uZXIoKTtcbiAgICAgICAgaWYgKGJhbm5lcikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYmFubmVyKTtcbiAgICAgICAgICAgIHRoaXMuYmFubmVyU2hvd24gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHNob3dVc2FnZShpbmplY3RzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKHRoaXMuZ2V0VXNhZ2UoaW5qZWN0cykpO1xuICAgIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBjb25maWd1cmF0aW9uIHN0YWdlXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIHR5cGU6IEZlYXR1cmUuSU5JVCxcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge0FwcH0gYXBwIC0gVGhlIGNsaSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSB1c2FnZU9wdGlvbnMgLSBPcHRpb25zIGZvciB0aGUgZmVhdHVyZSAgICAgXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFt1c2FnZU9wdGlvbnMuYmFubmVyXSAtIEJhbm5lciBtZXNzYWdlIG9yIGJhbm5lciBnZW5lcmF0b3IgZnVuY3Rpb25cbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3VzYWdlT3B0aW9ucy5wcm9ncmFtXSAtIEV4ZWN1dGFibGUgbmFtZVxuICAgICAqIEBwcm9wZXJ0eSB7YXJyYXl9IFt1c2FnZU9wdGlvbnMuYXJndW1lbnRzXSAtIENvbW1hbmQgbGluZSBhcmd1bWVudHMsIGlkZW50aWZpZWQgYnkgdGhlIHBvc2l0aW9uIG9mIGFwcGVhcmFuY2VcbiAgICAgKiBAcHJvcGVydHkge29iamVjdH0gW3VzYWdlT3B0aW9ucy5vcHRpb25zXSAtIENvbW1hbmQgbGluZSBvcHRpb25zICAgICBcbiAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW58ZnVuY3Rpb259IFt1c2FnZU9wdGlvbnMuc2lsZW50TW9kZV0gLSBXaGV0aGVyIHRvIHJ1biBpbiBzaWxpZW50IG1vZGUsIGRlZmF1bHQgZmFsc2VcbiAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW58ZnVuY3Rpb259IFt1c2FnZU9wdGlvbnMubm9uVmFsaWRhdGlvbk1vZGVdIC0gV2hldGhlciB0byBydW4gdmFsaWRhdGlvblxuICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdXNhZ2VPcHRpb25zLmhlbHBPcHRpb249Jz8nXSAtIFRoZSBvcHRpb24gd2hpY2ggYWN0IGFzIGhlbHBcbiAgICAgKiBAcHJvcGVydHkge2Jvb2xlYW59IFt1c2FnZU9wdGlvbnMuc2hvd1VzYWdlT25FcnJvcl1cbiAgICAgKiBcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqICAgb3B0aW9uczogeyBbYXJndW1lbnRLZXldOiB7XG4gICAgICogICAgICBkZXNjLCAvLyB7c3RyaW5nfSAtIGRlc2NyaXB0aW9uXG4gICAgICogICAgICBhbGlhcywgLy8ge2FycmF5LjxzdHJpbmc+fSAtIGFsaWFzIGFycmF5XG4gICAgICogICAgICBib29sLCAvLyB7Ym9vbGVhbn0gLSB3aGV0aGVyIGl0IGlzIGEgYm9vbGVhbiB2YWx1ZVxuICAgICAqICAgICAgZGVmYXVsdCwgLy8geyp9IC0gZGVmYXVsdCB2YWx1ZVxuICAgICAqICAgICAgaW5xdWlyZSwgLy8ge2Jvb2xlYW4gfCBmdW5jdGlvbihjbGkpLjxib29sZWFuPn0gLSB3aGV0aGVyIHRvIGVuYWJsZSBpbnRlcmFjdGl2ZSBxdWVyeVxuICAgICAqICAgICAgcHJvbXB0TWVzc2FnZSwgLy8ge3N0cmluZ30gLSBwcm9tcHQgbWVzc2FnZSBmb3IgcXVlcnksIHdpbGwgdXNlIGRlc2MgaWYgbm90IHNldFxuICAgICAqICAgICAgcHJvbXB0VHlwZSwgLy8ge3N0cmluZ30gLSBwcm9tcHQgdHlwZSwgY2FuIGJlIG9uZSBvZiBbIGlucHV0LCBudW1iZXIsIGNvbmZpcm0sIGxpc3QsIHJhd2xpc3QsIGV4cGFuZCwgY2hlY2tib3gsIHBhc3N3b3JkLCBlZGl0b3IgXVxuICAgICAqICAgICAgcHJvbXB0RGVmYXVsdCwgLy8geyogfCBmdW5jdGlvbihjbGkpLjwqPn0gLSBkZWZhdWx0IHZhbHVlIGFwcGVhcmVkIG9uIHF1ZXJ5IG9yIGEgYXN5bmMgZnVuY3Rpb24gdG8gcmV0dXJuIHRoZSBkZWZhdWx0IHZhbHVlXG4gICAgICogICAgICBjaG9pY2VzUHJvdmlkZXIsIC8vIHthcnJheSB8IGZ1bmN0aW9uKGNsaSkuPGFycmF5PiB8IGZ1bmN0aW9uLjxmdW5jdGlvbihzdHJpbmcpLjxhcnJheT4+fSAtIHJlcXVpcmVkIGZvciBwcm9tcHQgdHlwZSBsaXN0LCByYXdsaXN0LCBleHBhbmQsIGNoZWNrYm94XG4gICAgICogICAgICBmaWx0ZXIsIC8vIHtmdW5jdGlvbihhcmd2LCBjbGkpLjxhcmd2Pn0gLSBmaWx0ZXIgdG8gcHJvY2VzcyB0aGUgYXJndW1lbnQgdmFsdWVcbiAgICAgKiAgICAgIGFmdGVySW5xdWlyZSwgLy8ge2Z1bmN0aW9ufSAtIGFmdGVyIGlucXVpcmUgaG9vayxcbiAgICAgKiAgICAgIG9uQXJndW1lbnRFeGlzdHMsIC8vIHtmdW5jdGlvbn0gLSB3aGVuIGFyZ3VtZW50IGV4aXN0cyxcbiAgICAgKiAgICAgIHNpbGVudE1vZGVEZWZhdWx0IC8vIHsqfSAtIGRlZmF1bHQgdmFsdWUgd2hlbiBydW4gaW4gc2lsaWVudCBtb2RlLFxuICAgICAqICAgfSB9XG4gICAgICogXG4gICAgICogQHJldHVybnMge1Byb21pc2UuPCo+fVxuICAgICAqL1xuICAgIGxvYWRfOiBhc3luYyAoYXBwLCB1c2FnZU9wdGlvbnMpID0+IHsgICBcbiAgICAgICAgYXBwLmNvbW1hbmRMaW5lID0gbmV3IENvbW1hbmRMaW5lKGFwcCwgdXNhZ2VPcHRpb25zKTsgICAgICAgICAgICAgXG5cbiAgICAgICAgbGV0IHNpbGVudE1vZGUgPSB1c2FnZU9wdGlvbnMuc2lsZW50TW9kZTtcblxuICAgICAgICBpZiAoc2lsZW50TW9kZSAmJiB0eXBlb2Ygc2lsZW50TW9kZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgc2lsZW50TW9kZSA9IHNpbGVudE1vZGUoYXBwLmNvbW1hbmRMaW5lKTtcbiAgICAgICAgfSAgXG5cbiAgICAgICAgYXBwLmNvbW1hbmRMaW5lLnNpbGVudE1vZGUgPSBzaWxlbnRNb2RlO1xuXG4gICAgICAgIGlmIChzaWxlbnRNb2RlKSB7XG4gICAgICAgICAgICBhd2FpdCBhcHAuY29tbWFuZExpbmUuZmlsbFNpbGVudE1vZGVEZWZhdWx0c18oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFwcC5jb21tYW5kTGluZS5zaG93QmFubmFyKCk7XG4gICAgICAgICAgICBhd2FpdCBhcHAuY29tbWFuZExpbmUuaW5xdWlyZV8oKTsgICAgICAgICAgICBcbiAgICAgICAgfSAgICAgICAgXG5cbiAgICAgICAgbGV0IG5vblZhbGlkYXRpb25Nb2RlID0gdXNhZ2VPcHRpb25zLm5vblZhbGlkYXRpb25Nb2RlO1xuXG4gICAgICAgIGlmIChub25WYWxpZGF0aW9uTW9kZSAmJiB0eXBlb2Ygbm9uVmFsaWRhdGlvbk1vZGUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG5vblZhbGlkYXRpb25Nb2RlID0gbm9uVmFsaWRhdGlvbk1vZGUoYXBwLmNvbW1hbmRMaW5lKTtcbiAgICAgICAgfSAgXG5cbiAgICAgICAgYXBwLmNvbW1hbmRMaW5lLm5vblZhbGlkYXRpb25Nb2RlID0gbm9uVmFsaWRhdGlvbk1vZGU7XG5cbiAgICAgICAgaWYgKCFub25WYWxpZGF0aW9uTW9kZSkgeyAgICAgICAgICAgIFxuICAgICAgICAgICAgYXdhaXQgYXBwLmNvbW1hbmRMaW5lLnZhbGlkYXRlXygpO1xuICAgICAgICB9XG4gICAgfVxufTsiXX0=