"use strict";

require("source-map-support/register");

const path = require('path');

const Feature = require('../enum/Feature');

const {
  _,
  putIntoBucket,
  setValueByPath,
  eachAsync_
} = require('rk-utils');

const {
  tryRequire
} = require('../utils/Helpers');

const {
  ApplicationError,
  InvalidConfiguration
} = require('../utils/Errors');

function translateMinimistOptions(opts) {
  let m = {};

  _.forOwn(opts, (detail, name) => {
    if (detail.bool) {
      putIntoBucket(m, 'boolean', name);
    } else {
      putIntoBucket(m, 'string', name);
    }

    if ('default' in detail) {
      setValueByPath(m, `default.${name}`, detail.default);
    }

    if (detail.alias) {
      setValueByPath(m, `alias.${name}`, detail.alias);
    }
  });

  return m;
}

function optionDecorator(name) {
  return name.length == 1 ? '-' + name : '--' + name;
}

const gArgv = process.argv.slice(2);

class CommandLineArgumentError extends ApplicationError {
  constructor(message, name, nonOption) {
    super(message, 'E_CLI_INVALID_ARG', {
      name,
      nonOption
    });
  }

}

class CommandLine {
  constructor(app, usage) {
    this.app = app;
    this.usage = usage;
    this.parse(usage.options);
  }

  injectUsage(injects) {
    this.injects = injects;
  }

  parse(options) {
    const minimist = tryRequire('minimist');
    this.argv = minimist(gArgv, translateMinimistOptions(options));
  }

  option(name) {
    return this.argv[name];
  }

  arg(name) {
    if (this.args[name]) return this.args[name];

    let index = _.findIndex(this.usage.arguments, arg => arg.name === name);

    if (index === -1 || this.argv._.length <= index) {
      return undefined;
    }

    this.args || (this.args = {});
    return this.args[name] = this.argv._[index];
  }

  updateOption(name, value) {
    this.argv[name] = value;
    let opts = this.usage.options[name];

    if (opts.alias) {
      _.each(opts.alias, a => {
        this.argv[a] = value;
      });
    }
  }

  async valueOrFunctionCall_(functor) {
    if (typeof functor === 'function') {
      return await functor(this);
    }

    return functor;
  }

  async inquire_() {
    const inquirer = tryRequire('inquirer');

    const doInquire_ = (item, argIndex) => inquirer.prompt([item]).then(answers => {
      console.log();

      _.forOwn(answers, (ans, name) => {
        if (typeof argIndex === 'undefined') {
          this.updateOption(name, ans);
        } else {
          if (!(this.argv._.length === argIndex)) {
            throw new Error("Assertion failed: this.argv._.length === argIndex");
          }

          this.argv._ = this.argv._.concat([ans]);
        }
      });
    });

    const doFilter_ = async (name, opt, argIndex) => {
      if (opt.filter) {
        if (typeof argIndex === 'undefined') {
          if (!(typeof opt.filter !== 'function')) {
            throw new InvalidConfiguration(`The "filter" in the inquirer option for argument option "${name}" should be a function!`, this.app, `commandLine.options[${name}].filter`);
          }

          this.updateOption(name, (await opt.filter(this.argv[name], this)));
        } else {
          if (!(typeof opt.filter !== 'function')) {
            throw new InvalidConfiguration(`The "filter" in the inquirer option for argument value "${name}" at position ${argIndex} should be a function!`, this.app, `commandLine.arguments[${argIndex}].filter`);
          }

          this.argv._[argIndex] = await opt.filter(this.argv._[argIndex], this);
        }
      }
    };

    const argExist = (name, argIndex) => typeof argIndex === 'undefined' ? name in this.argv : this.argv._.length > argIndex;

    const prepareInquire_ = async (opts, name, argIndex) => {
      let argExists = argExist(name, argIndex);

      if ('inquire' in opts && !argExists) {
        let inquire = this.valueOrFunctionCall_(opts.inquire);

        if (inquire) {
          let type;
          let q = {
            name: name,
            message: opts.promptMessage || opts.desc
          };

          if (opts.promptType) {
            type = opts.promptType;

            if (type === 'list' || type === 'rawList' || type === 'checkbox' || type === 'expand') {
              if (!opts.choicesProvider) {
                throw new InvalidConfiguration(typeof argIndex === 'undefined' ? `Missing "choicesProvider" in the inquirer option for argument option "${name}"!` : `Missing "choicesProvider" in the inquirer option for argument value "${name}" at postion ${argIndex}!`, app, typeof argIndex === 'undefined' ? `commandLine.options[${name}].choicesProvider` : `commandLine.arguments[${argIndex}].choicesProvider`);
              }

              q.choices = await this.valueOrFunctionCall_(opts.choicesProvider);
            }
          } else if (opts.bool) {
            type = 'confirm';
          } else {
            type = 'input';
          }

          q.type = type;

          if ('promptDefault' in opts) {
            q.default = await this.valueOrFunctionCall_(opts.promptDefault);
          }

          await doInquire_(q, argIndex);
          await doFilter_(name, opts, argIndex);

          if (opts.afterInquire) {
            await opts.afterInquire(this);
          }
        }
      } else if (argExists) {
        await doFilter_(name, opts, argIndex);
      }

      if (this.usage.showArguments && argExist(name, argIndex)) {
        if (typeof argIndex === 'undefined') {
          console.log('option', name, `(${opts.desc})`, ':', this.argv[name]);
        } else {
          console.log(`<${name}>`, ':', this.argv._[argIndex]);
        }
      }
    };

    if (!_.isEmpty(this.usage.arguments)) {
      await eachAsync_(this.usage.arguments, async (argOpt, index) => {
        let {
          name,
          ...opts
        } = argOpt;
        return prepareInquire_(opts, name, index);
      });
    }

    return _.isEmpty(this.usage.options) || eachAsync_(this.usage.options, (opts, name) => prepareInquire_(opts, name));
  }

  async validate_() {
    const checkRequire_ = opts => this.valueOrFunctionCall_(opts.required);

    let errors = [];

    if (!_.isEmpty(this.usage.arguments)) {
      let argNum = this.argv._.length;

      if (argNum < this.usage.arguments.length) {
        let args = [];
        let i = 0;
        await eachAsync_(this.usage.arguments, async arg => {
          let required = await checkRequire_(arg);

          if (required) {
            if (i >= argNum) {
              let msg = `Missing required argument "${arg.name}"!`;

              if (this.usage.showUsageOnError) {
                errors.push(msg);
              } else {
                throw new CommandLineArgumentError(msg, arg.name, true);
              }
            } else {
              args.push(this.argv._[i++]);
            }
          }
        });
        this.argv._ = args;
      }
    }

    await eachAsync_(this.usage.options, async (opts, name) => {
      let required = await checkRequire_(opts);

      if (required && !(name in this.argv)) {
        let msg = `Missing required argument option of "${name}"!`;

        if (this.usage.showUsageOnError) {
          errors.push(msg);
        } else {
          throw new CommandLineArgumentError(msg, name);
        }
      }
    });

    if (errors.length > 0) {
      this.showUsage({
        afterBanner: () => 'Error(s):\n' + errors.map(msg => ' - ' + msg).join('\n') + '\n\n'
      });
      process.exit(1);
    }
  }

  async fillSilentModeDefaults_() {
    await eachAsync_(this.usage.arguments, async (arg, index) => {
      if (this.argv._.length <= index) {
        if (arg.hasOwnProperty('silentModeDefault')) {
          for (let i = this.argv._.length; i < index; i++) {
            this.argv._.push(undefined);
          }

          this.argv._.push((await this.valueOrFunctionCall_(arg.silentModeDefault)));
        }
      }
    });
    await eachAsync_(this.usage.options, async (opts, name) => {
      if (!this.argv.hasOwnProperty(name) && opts.hasOwnProperty('silentModeDefault')) {
        this.updateOption(name, (await this.valueOrFunctionCall_(opts.silentModeDefault)));
      }
    });
  }

  getBanner() {
    if (this.usage.banner) {
      let banner = '';

      if (typeof this.usage.banner === 'function') {
        banner += this.usage.banner(this);
      } else if (typeof this.usage.banner === 'string') {
        banner += this.usage.banner;
      } else {
        throw new InvalidConfiguration('Invalid banner value of commandLine feature.', this.app, `commandLine.banner`);
      }

      banner += '\n';
      return banner;
    }

    return undefined;
  }

  getUsage(injects) {
    injects = { ...this.injects,
      ...injects
    };
    let usage = '';
    let banner = !this.bannerShown && this.getBanner();

    if (banner) {
      usage += banner + '\n';
    }

    if (injects && injects.afterBanner) {
      usage += injects.afterBanner();
    }

    let fmtArgs = '';

    if (!_.isEmpty(this.usage.arguments)) {
      fmtArgs = ' ' + this.usage.arguments.map(arg => arg.required ? `<${arg.name}>` : `[${arg.name}]`).join(' ');
    }

    usage += `Usage: ${this.usage.program || path.basename(process.argv[1])}${fmtArgs} [options]\n\n`;

    if (injects && injects.afterCommandLine) {
      usage += injects.afterCommandLine();
    }

    if (!_.isEmpty(this.usage.options)) {
      usage += `Options:\n`;

      _.forOwn(this.usage.options, (opts, name) => {
        let line = '  ' + optionDecorator(name);

        if (opts.alias) {
          line += _.reduce(opts.alias, (sum, a) => sum + ', ' + optionDecorator(a), '');
        }

        line += '\n';
        line += '    ' + opts.desc + '\n';

        if ('default' in opts) {
          line += '    default: ' + opts.default.toString() + '\n';
        }

        if (opts.required) {
          if (typeof opts.required === 'function') {
            line += '    conditional\n';
          } else {
            line += '    required\n';
          }
        }

        if (opts.choicesProvider && Array.isArray(opts.choicesProvider)) {
          line += '    available values:\n';
          opts.choicesProvider.forEach(choice => {
            line += `        "${choice.value}": ${choice.name}\n`;
          });
        }

        line += '\n';
        usage += line;
      });
    }

    if (injects && injects.afterOptions) {
      usage += injects.afterOptions();
    }

    return usage;
  }

  showBannar() {
    let banner = this.getBanner();

    if (banner) {
      console.log(banner);
      this.bannerShown = true;
    }
  }

  showUsage(injects) {
    console.log(this.getUsage(injects));
  }

}

module.exports = {
  type: Feature.INIT,
  load_: async (app, usageOptions) => {
    app.commandLine = new CommandLine(app, usageOptions);
    let silentMode = usageOptions.silentMode;

    if (silentMode && typeof silentMode === 'function') {
      silentMode = silentMode(app.commandLine);
    }

    app.commandLine.silentMode = silentMode;

    if (silentMode) {
      await app.commandLine.fillSilentModeDefaults_();
    } else {
      app.commandLine.showBannar();
      await app.commandLine.inquire_();
    }

    let nonValidationMode = usageOptions.nonValidationMode;

    if (nonValidationMode && typeof nonValidationMode === 'function') {
      nonValidationMode = nonValidationMode(app.commandLine);
    }

    app.commandLine.nonValidationMode = nonValidationMode;

    if (!nonValidationMode) {
      await app.commandLine.validate_();
    }
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9jb21tYW5kTGluZS5qcyJdLCJuYW1lcyI6WyJwYXRoIiwicmVxdWlyZSIsIkZlYXR1cmUiLCJfIiwicHV0SW50b0J1Y2tldCIsInNldFZhbHVlQnlQYXRoIiwiZWFjaEFzeW5jXyIsInRyeVJlcXVpcmUiLCJBcHBsaWNhdGlvbkVycm9yIiwiSW52YWxpZENvbmZpZ3VyYXRpb24iLCJ0cmFuc2xhdGVNaW5pbWlzdE9wdGlvbnMiLCJvcHRzIiwibSIsImZvck93biIsImRldGFpbCIsIm5hbWUiLCJib29sIiwiZGVmYXVsdCIsImFsaWFzIiwib3B0aW9uRGVjb3JhdG9yIiwibGVuZ3RoIiwiZ0FyZ3YiLCJwcm9jZXNzIiwiYXJndiIsInNsaWNlIiwiQ29tbWFuZExpbmVBcmd1bWVudEVycm9yIiwiY29uc3RydWN0b3IiLCJtZXNzYWdlIiwibm9uT3B0aW9uIiwiQ29tbWFuZExpbmUiLCJhcHAiLCJ1c2FnZSIsInBhcnNlIiwib3B0aW9ucyIsImluamVjdFVzYWdlIiwiaW5qZWN0cyIsIm1pbmltaXN0Iiwib3B0aW9uIiwiYXJnIiwiYXJncyIsImluZGV4IiwiZmluZEluZGV4IiwiYXJndW1lbnRzIiwidW5kZWZpbmVkIiwidXBkYXRlT3B0aW9uIiwidmFsdWUiLCJlYWNoIiwiYSIsInZhbHVlT3JGdW5jdGlvbkNhbGxfIiwiZnVuY3RvciIsImlucXVpcmVfIiwiaW5xdWlyZXIiLCJkb0lucXVpcmVfIiwiaXRlbSIsImFyZ0luZGV4IiwicHJvbXB0IiwidGhlbiIsImFuc3dlcnMiLCJjb25zb2xlIiwibG9nIiwiYW5zIiwiY29uY2F0IiwiZG9GaWx0ZXJfIiwib3B0IiwiZmlsdGVyIiwiYXJnRXhpc3QiLCJwcmVwYXJlSW5xdWlyZV8iLCJhcmdFeGlzdHMiLCJpbnF1aXJlIiwidHlwZSIsInEiLCJwcm9tcHRNZXNzYWdlIiwiZGVzYyIsInByb21wdFR5cGUiLCJjaG9pY2VzUHJvdmlkZXIiLCJjaG9pY2VzIiwicHJvbXB0RGVmYXVsdCIsImFmdGVySW5xdWlyZSIsInNob3dBcmd1bWVudHMiLCJpc0VtcHR5IiwiYXJnT3B0IiwidmFsaWRhdGVfIiwiY2hlY2tSZXF1aXJlXyIsInJlcXVpcmVkIiwiZXJyb3JzIiwiYXJnTnVtIiwiaSIsIm1zZyIsInNob3dVc2FnZU9uRXJyb3IiLCJwdXNoIiwic2hvd1VzYWdlIiwiYWZ0ZXJCYW5uZXIiLCJtYXAiLCJqb2luIiwiZXhpdCIsImZpbGxTaWxlbnRNb2RlRGVmYXVsdHNfIiwiaGFzT3duUHJvcGVydHkiLCJzaWxlbnRNb2RlRGVmYXVsdCIsImdldEJhbm5lciIsImJhbm5lciIsImdldFVzYWdlIiwiYmFubmVyU2hvd24iLCJmbXRBcmdzIiwicHJvZ3JhbSIsImJhc2VuYW1lIiwiYWZ0ZXJDb21tYW5kTGluZSIsImxpbmUiLCJyZWR1Y2UiLCJzdW0iLCJ0b1N0cmluZyIsIkFycmF5IiwiaXNBcnJheSIsImZvckVhY2giLCJjaG9pY2UiLCJhZnRlck9wdGlvbnMiLCJzaG93QmFubmFyIiwibW9kdWxlIiwiZXhwb3J0cyIsIklOSVQiLCJsb2FkXyIsInVzYWdlT3B0aW9ucyIsImNvbW1hbmRMaW5lIiwic2lsZW50TW9kZSIsIm5vblZhbGlkYXRpb25Nb2RlIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQU9BLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLE1BQUQsQ0FBcEI7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBQ0EsTUFBTTtBQUFFRSxFQUFBQSxDQUFGO0FBQUtDLEVBQUFBLGFBQUw7QUFBb0JDLEVBQUFBLGNBQXBCO0FBQW9DQyxFQUFBQTtBQUFwQyxJQUFtREwsT0FBTyxDQUFDLFVBQUQsQ0FBaEU7O0FBQ0EsTUFBTTtBQUFFTSxFQUFBQTtBQUFGLElBQWlCTixPQUFPLENBQUMsa0JBQUQsQ0FBOUI7O0FBQ0EsTUFBTTtBQUFFTyxFQUFBQSxnQkFBRjtBQUFvQkMsRUFBQUE7QUFBcEIsSUFBNkNSLE9BQU8sQ0FBQyxpQkFBRCxDQUEx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QUFuRVksQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBQYXJzZSBjb21tYW5kIGxpbmUgYXJndW1lbnRzIHVzaW5nIG1pbmltaXN0IGFuZCBzdG9yZSB0aGUgcGFyc2VkIG9iamVjdCBpbnRvIGFwcC5hcmd2LCBhbmQgYWRkIGFwcC5zaG93VXNhZ2UoKSBoZWxwZXIgZnVuY3Rpb25cbiAqIEBtb2R1bGUgRmVhdHVyZV9Db21tYW5kTGluZVxuICovXG5cbmNvbnN0IHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG5jb25zdCBGZWF0dXJlID0gcmVxdWlyZSgnLi4vZW51bS9GZWF0dXJlJyk7XG5jb25zdCB7IF8sIHB1dEludG9CdWNrZXQsIHNldFZhbHVlQnlQYXRoLCBlYWNoQXN5bmNfIH0gPSByZXF1aXJlKCdyay11dGlscycpO1xuY29uc3QgeyB0cnlSZXF1aXJlIH0gPSByZXF1aXJlKCcuLi91dGlscy9IZWxwZXJzJyk7XG5jb25zdCB7IEFwcGxpY2F0aW9uRXJyb3IsIEludmFsaWRDb25maWd1cmF0aW9uIH0gPSByZXF1aXJlKCcuLi91dGlscy9FcnJvcnMnKVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVNaW5pbWlzdE9wdGlvbnMob3B0cykge1xuICAgIGxldCBtID0ge307XG5cbiAgICBfLmZvck93bihvcHRzLCAoZGV0YWlsLCBuYW1lKSA9PiB7XG4gICAgICAgIGlmIChkZXRhaWwuYm9vbCkge1xuICAgICAgICAgICAgcHV0SW50b0J1Y2tldChtLCAnYm9vbGVhbicsIG5hbWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcHV0SW50b0J1Y2tldChtLCAnc3RyaW5nJywgbmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoJ2RlZmF1bHQnIGluIGRldGFpbCkge1xuICAgICAgICAgICAgc2V0VmFsdWVCeVBhdGgobSwgYGRlZmF1bHQuJHtuYW1lfWAsIGRldGFpbC5kZWZhdWx0KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChkZXRhaWwuYWxpYXMpIHtcbiAgICAgICAgICAgIHNldFZhbHVlQnlQYXRoKG0sIGBhbGlhcy4ke25hbWV9YCwgZGV0YWlsLmFsaWFzKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIG07XG59XG5cbmZ1bmN0aW9uIG9wdGlvbkRlY29yYXRvcihuYW1lKSB7XG4gICAgcmV0dXJuIG5hbWUubGVuZ3RoID09IDEgPyAoJy0nICsgbmFtZSkgOiAoJy0tJyArIG5hbWUpO1xufVxuXG5jb25zdCBnQXJndiA9IHByb2Nlc3MuYXJndi5zbGljZSgyKTtcblxuLyoqXG4gKiBFcnJvciBjYXVzZWQgYnkgY29tbWFuZCBsaW5lIGFyZ3VtZW50cy5cbiAqIEBjbGFzc1xuICogQGV4dGVuZHMgQXBwbGljYXRpb25FcnJvciAgXG4gKi9cbmNsYXNzIENvbW1hbmRMaW5lQXJndW1lbnRFcnJvciBleHRlbmRzIEFwcGxpY2F0aW9uRXJyb3Ige1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBtZXNzYWdlIC0gRXJyb3IgbWVzc2FnZSAgICAgXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgcmVsYXRlZCBjb25maWcgaXRlbSAgXG4gICAgICogQHBhcmFtIHtib29sZWFufSBub25PcHRpb24gLSBXaGV0aGVyIGl0IGlzIGFuIG9wdGlvbiBcbiAgICAgKi8gXG4gICAgY29uc3RydWN0b3IobWVzc2FnZSwgbmFtZSwgbm9uT3B0aW9uKSB7ICAgICBcbiAgICAgICAgc3VwZXIobWVzc2FnZSwgJ0VfQ0xJX0lOVkFMSURfQVJHJywgeyBuYW1lLCBub25PcHRpb24gfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbW1hbmQgbGluZSBoZWxwZXIgb2JqZWN0LlxuICovXG5jbGFzcyBDb21tYW5kTGluZSB7XG4gICAgY29uc3RydWN0b3IoYXBwLCB1c2FnZSkge1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy51c2FnZSA9IHVzYWdlO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5wYXJzZSh1c2FnZS5vcHRpb25zKTtcbiAgICB9XG5cbiAgICBpbmplY3RVc2FnZShpbmplY3RzKSB7XG4gICAgICAgIHRoaXMuaW5qZWN0cyA9IGluamVjdHM7XG4gICAgfVxuXG4gICAgcGFyc2Uob3B0aW9ucykgeyAgICAgICAgXG4gICAgICAgIGNvbnN0IG1pbmltaXN0ID0gdHJ5UmVxdWlyZSgnbWluaW1pc3QnKTtcbiAgICAgICAgdGhpcy5hcmd2ID0gbWluaW1pc3QoZ0FyZ3YsIHRyYW5zbGF0ZU1pbmltaXN0T3B0aW9ucyhvcHRpb25zKSk7XG4gICAgfVxuXG4gICAgb3B0aW9uKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXJndltuYW1lXTtcbiAgICB9XG5cbiAgICBhcmcobmFtZSkge1xuICAgICAgICBpZiAodGhpcy5hcmdzW25hbWVdKSByZXR1cm4gdGhpcy5hcmdzW25hbWVdO1xuXG4gICAgICAgIGxldCBpbmRleCA9IF8uZmluZEluZGV4KHRoaXMudXNhZ2UuYXJndW1lbnRzLCBhcmcgPT4gYXJnLm5hbWUgPT09IG5hbWUpO1xuXG4gICAgICAgIGlmIChpbmRleCA9PT0gLTEgfHwgdGhpcy5hcmd2Ll8ubGVuZ3RoIDw9IGluZGV4KSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hcmdzIHx8ICh0aGlzLmFyZ3MgPSB7fSk7XG4gICAgICAgIHJldHVybiAodGhpcy5hcmdzW25hbWVdID0gdGhpcy5hcmd2Ll9baW5kZXhdKTtcbiAgICB9XG5cbiAgICB1cGRhdGVPcHRpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgdGhpcy5hcmd2W25hbWVdID0gdmFsdWU7XG4gICAgICAgIGxldCBvcHRzID0gdGhpcy51c2FnZS5vcHRpb25zW25hbWVdO1xuICAgICAgICBpZiAob3B0cy5hbGlhcykge1xuICAgICAgICAgICAgXy5lYWNoKG9wdHMuYWxpYXMsIGEgPT4geyB0aGlzLmFyZ3ZbYV0gPSB2YWx1ZTsgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyB2YWx1ZU9yRnVuY3Rpb25DYWxsXyhmdW5jdG9yKSB7XG4gICAgICAgIGlmICh0eXBlb2YgZnVuY3RvciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgcmV0dXJuIGF3YWl0IGZ1bmN0b3IodGhpcyk7XG4gICAgICAgIH0gXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZnVuY3RvcjtcbiAgICB9XG5cbiAgICBhc3luYyBpbnF1aXJlXygpIHtcbiAgICAgICAgY29uc3QgaW5xdWlyZXIgPSB0cnlSZXF1aXJlKCdpbnF1aXJlcicpO1xuXG4gICAgICAgIGNvbnN0IGRvSW5xdWlyZV8gPSAoaXRlbSwgYXJnSW5kZXgpID0+IGlucXVpcmVyLnByb21wdChbaXRlbV0pLnRoZW4oYW5zd2VycyA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygpO1xuXG4gICAgICAgICAgICBfLmZvck93bihhbnN3ZXJzLCAoYW5zLCBuYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcmdJbmRleCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy51cGRhdGVPcHRpb24obmFtZSwgYW5zKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQ6IHRoaXMuYXJndi5fLmxlbmd0aCA9PT0gYXJnSW5kZXg7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmd2Ll8gPSB0aGlzLmFyZ3YuXy5jb25jYXQoW2Fuc10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0pOyBcblxuICAgICAgICBjb25zdCBkb0ZpbHRlcl8gPSBhc3luYyAobmFtZSwgb3B0LCBhcmdJbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKG9wdC5maWx0ZXIpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoISh0eXBlb2Ygb3B0LmZpbHRlciAhPT0gJ2Z1bmN0aW9uJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkQ29uZmlndXJhdGlvbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgVGhlIFwiZmlsdGVyXCIgaW4gdGhlIGlucXVpcmVyIG9wdGlvbiBmb3IgYXJndW1lbnQgb3B0aW9uIFwiJHtuYW1lfVwiIHNob3VsZCBiZSBhIGZ1bmN0aW9uIWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYGNvbW1hbmRMaW5lLm9wdGlvbnNbJHtuYW1lfV0uZmlsdGVyYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZU9wdGlvbihuYW1lLCBhd2FpdCBvcHQuZmlsdGVyKHRoaXMuYXJndltuYW1lXSwgdGhpcykpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghKHR5cGVvZiBvcHQuZmlsdGVyICE9PSAnZnVuY3Rpb24nKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDb25maWd1cmF0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBUaGUgXCJmaWx0ZXJcIiBpbiB0aGUgaW5xdWlyZXIgb3B0aW9uIGZvciBhcmd1bWVudCB2YWx1ZSBcIiR7bmFtZX1cIiBhdCBwb3NpdGlvbiAke2FyZ0luZGV4fSBzaG91bGQgYmUgYSBmdW5jdGlvbiFgLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBjb21tYW5kTGluZS5hcmd1bWVudHNbJHthcmdJbmRleH1dLmZpbHRlcmApO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcmd2Ll9bYXJnSW5kZXhdID0gYXdhaXQgb3B0LmZpbHRlcih0aGlzLmFyZ3YuX1thcmdJbmRleF0sIHRoaXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBhcmdFeGlzdCA9IChuYW1lLCBhcmdJbmRleCkgPT4gdHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJyA/IChuYW1lIGluIHRoaXMuYXJndikgOiAodGhpcy5hcmd2Ll8ubGVuZ3RoID4gYXJnSW5kZXgpO1xuXG4gICAgICAgIGNvbnN0IHByZXBhcmVJbnF1aXJlXyA9IGFzeW5jIChvcHRzLCBuYW1lLCBhcmdJbmRleCkgPT4ge1xuICAgICAgICAgICAgbGV0IGFyZ0V4aXN0cyA9IGFyZ0V4aXN0KG5hbWUsIGFyZ0luZGV4KTtcblxuICAgICAgICAgICAgaWYgKCgnaW5xdWlyZScgaW4gb3B0cykgJiYgIWFyZ0V4aXN0cykgeyBcbiAgICAgICAgICAgICAgICAvL25lZWQgaW5xdWlyZSBhbmQgdGhlIHZhbHVlIG5vdCBnaXZlbiB0aHJvdWdoIGNvbW1hbmQgbGluZVxuICAgICAgICAgICAgICAgIGxldCBpbnF1aXJlID0gdGhpcy52YWx1ZU9yRnVuY3Rpb25DYWxsXyhvcHRzLmlucXVpcmUpO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmIChpbnF1aXJlKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB0eXBlO1xuICAgICAgICAgICAgICAgICAgICBsZXQgcSA9IHsgbmFtZTogbmFtZSwgbWVzc2FnZTogb3B0cy5wcm9tcHRNZXNzYWdlIHx8IG9wdHMuZGVzYyB9O1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChvcHRzLnByb21wdFR5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSBvcHRzLnByb21wdFR5cGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2xpc3QnIHx8IHR5cGUgID09PSAncmF3TGlzdCcgfHwgdHlwZSA9PT0gJ2NoZWNrYm94JyB8fCB0eXBlID09PSAnZXhwYW5kJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghb3B0cy5jaG9pY2VzUHJvdmlkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRDb25maWd1cmF0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJyA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGBNaXNzaW5nIFwiY2hvaWNlc1Byb3ZpZGVyXCIgaW4gdGhlIGlucXVpcmVyIG9wdGlvbiBmb3IgYXJndW1lbnQgb3B0aW9uIFwiJHtuYW1lfVwiIWAgOiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgTWlzc2luZyBcImNob2ljZXNQcm92aWRlclwiIGluIHRoZSBpbnF1aXJlciBvcHRpb24gZm9yIGFyZ3VtZW50IHZhbHVlIFwiJHtuYW1lfVwiIGF0IHBvc3Rpb24gJHthcmdJbmRleH0hYCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGVvZiBhcmdJbmRleCA9PT0gJ3VuZGVmaW5lZCcgPyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29tbWFuZExpbmUub3B0aW9uc1ske25hbWV9XS5jaG9pY2VzUHJvdmlkZXJgIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgY29tbWFuZExpbmUuYXJndW1lbnRzWyR7YXJnSW5kZXh9XS5jaG9pY2VzUHJvdmlkZXJgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBxLmNob2ljZXMgPSBhd2FpdCB0aGlzLnZhbHVlT3JGdW5jdGlvbkNhbGxfKG9wdHMuY2hvaWNlc1Byb3ZpZGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvcHRzLmJvb2wpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGUgPSAnY29uZmlybSc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gJ2lucHV0J1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcS50eXBlID0gdHlwZTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJ3Byb21wdERlZmF1bHQnIGluIG9wdHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHEuZGVmYXVsdCA9IGF3YWl0IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8ob3B0cy5wcm9tcHREZWZhdWx0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRvSW5xdWlyZV8ocSwgYXJnSW5kZXgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGRvRmlsdGVyXyhuYW1lLCBvcHRzLCBhcmdJbmRleCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMuYWZ0ZXJJbnF1aXJlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBvcHRzLmFmdGVySW5xdWlyZSh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChhcmdFeGlzdHMpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBkb0ZpbHRlcl8obmFtZSwgb3B0cywgYXJnSW5kZXgpO1xuICAgICAgICAgICAgfSBcblxuICAgICAgICAgICAgaWYgKHRoaXMudXNhZ2Uuc2hvd0FyZ3VtZW50cyAmJiBhcmdFeGlzdChuYW1lLCBhcmdJbmRleCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyZ0luZGV4ID09PSAndW5kZWZpbmVkJykgeyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnb3B0aW9uJywgbmFtZSwgYCgke29wdHMuZGVzY30pYCwgJzonLCB0aGlzLmFyZ3ZbbmFtZV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGA8JHtuYW1lfT5gLCAnOicsIHRoaXMuYXJndi5fW2FyZ0luZGV4XSk7XG4gICAgICAgICAgICAgICAgfSAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLnVzYWdlLmFyZ3VtZW50cykpIHtcbiAgICAgICAgICAgIGF3YWl0IGVhY2hBc3luY18odGhpcy51c2FnZS5hcmd1bWVudHMsIGFzeW5jIChhcmdPcHQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHsgbmFtZSwgLi4ub3B0cyB9ID0gYXJnT3B0O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByZXBhcmVJbnF1aXJlXyhvcHRzLCBuYW1lLCBpbmRleCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIF8uaXNFbXB0eSh0aGlzLnVzYWdlLm9wdGlvbnMpIHx8IGVhY2hBc3luY18odGhpcy51c2FnZS5vcHRpb25zLCAob3B0cywgbmFtZSkgPT4gcHJlcGFyZUlucXVpcmVfKG9wdHMsIG5hbWUpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiB2YWxpZGF0ZSBwYXJzZWQgYW5kIGZpbGxlZCBhcmd1bWVudCBvcHRpb25zLlxuICAgICAqL1xuICAgIGFzeW5jIHZhbGlkYXRlXygpIHtcbiAgICAgICAgY29uc3QgY2hlY2tSZXF1aXJlXyA9IChvcHRzKSA9PiB0aGlzLnZhbHVlT3JGdW5jdGlvbkNhbGxfKG9wdHMucmVxdWlyZWQpO1xuXG4gICAgICAgIGxldCBlcnJvcnMgPSBbXTtcblxuICAgICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLnVzYWdlLmFyZ3VtZW50cykpIHsgICAgIFxuICAgICAgICAgICAgbGV0IGFyZ051bSA9IHRoaXMuYXJndi5fLmxlbmd0aDtcblxuICAgICAgICAgICAgaWYgKGFyZ051bSA8IHRoaXMudXNhZ2UuYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGxldCBhcmdzID0gW107XG5cbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XG5cbiAgICAgICAgICAgICAgICBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2UuYXJndW1lbnRzLCBhc3luYyBhcmcgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcmVxdWlyZWQgPSBhd2FpdCBjaGVja1JlcXVpcmVfKGFyZyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlcXVpcmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA+PSBhcmdOdW0pIHsgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG1zZyA9IGBNaXNzaW5nIHJlcXVpcmVkIGFyZ3VtZW50IFwiJHthcmcubmFtZX1cIiFgO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzYWdlLnNob3dVc2FnZU9uRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2gobXNnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ29tbWFuZExpbmVBcmd1bWVudEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbXNnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCh0aGlzLmFyZ3YuX1tpKytdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHRoaXMuYXJndi5fID0gYXJncztcbiAgICAgICAgICAgIH0gICAgICAgICAgICBcbiAgICAgICAgfSAgICAgICAgICBcblxuICAgICAgICBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2Uub3B0aW9ucywgYXN5bmMgKG9wdHMsIG5hbWUpID0+IHtcbiAgICAgICAgICAgIGxldCByZXF1aXJlZCA9IGF3YWl0IGNoZWNrUmVxdWlyZV8ob3B0cyk7XG5cbiAgICAgICAgICAgIGlmIChyZXF1aXJlZCAmJiAhKG5hbWUgaW4gdGhpcy5hcmd2KSkge1xuICAgICAgICAgICAgICAgIGxldCBtc2cgPSBgTWlzc2luZyByZXF1aXJlZCBhcmd1bWVudCBvcHRpb24gb2YgXCIke25hbWV9XCIhYDtcblxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzYWdlLnNob3dVc2FnZU9uRXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzLnB1c2gobXNnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQ29tbWFuZExpbmVBcmd1bWVudEVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgbXNnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZiAoZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1VzYWdlKHtcbiAgICAgICAgICAgICAgICBhZnRlckJhbm5lcjogKCkgPT4gJ0Vycm9yKHMpOlxcbicgKyBlcnJvcnMubWFwKG1zZyA9PiAnIC0gJyArIG1zZykuam9pbignXFxuJykgKyAnXFxuXFxuJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGZpbGxTaWxlbnRNb2RlRGVmYXVsdHNfKCkge1xuICAgICAgICBhd2FpdCBlYWNoQXN5bmNfKHRoaXMudXNhZ2UuYXJndW1lbnRzLCBhc3luYyAoYXJnLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuYXJndi5fLmxlbmd0aCA8PSBpbmRleCkge1xuICAgICAgICAgICAgICAgIGlmIChhcmcuaGFzT3duUHJvcGVydHkoJ3NpbGVudE1vZGVEZWZhdWx0JykpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuYXJndi5fLmxlbmd0aDsgaSA8IGluZGV4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXJndi5fLnB1c2godW5kZWZpbmVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXJndi5fLnB1c2goYXdhaXQgdGhpcy52YWx1ZU9yRnVuY3Rpb25DYWxsXyhhcmcuc2lsZW50TW9kZURlZmF1bHQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGF3YWl0IGVhY2hBc3luY18odGhpcy51c2FnZS5vcHRpb25zLCBhc3luYyAob3B0cywgbmFtZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFyZ3YuaGFzT3duUHJvcGVydHkobmFtZSkgJiYgb3B0cy5oYXNPd25Qcm9wZXJ0eSgnc2lsZW50TW9kZURlZmF1bHQnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlT3B0aW9uKG5hbWUsIGF3YWl0IHRoaXMudmFsdWVPckZ1bmN0aW9uQ2FsbF8ob3B0cy5zaWxlbnRNb2RlRGVmYXVsdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXRCYW5uZXIoKSB7XG4gICAgICAgIGlmICh0aGlzLnVzYWdlLmJhbm5lcikge1xuICAgICAgICAgICAgbGV0IGJhbm5lciA9ICcnO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIHRoaXMudXNhZ2UuYmFubmVyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgYmFubmVyICs9IHRoaXMudXNhZ2UuYmFubmVyKHRoaXMpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy51c2FnZS5iYW5uZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgYmFubmVyICs9IHRoaXMudXNhZ2UuYmFubmVyO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENvbmZpZ3VyYXRpb24oXG4gICAgICAgICAgICAgICAgICAgICdJbnZhbGlkIGJhbm5lciB2YWx1ZSBvZiBjb21tYW5kTGluZSBmZWF0dXJlLicsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwLFxuICAgICAgICAgICAgICAgICAgICBgY29tbWFuZExpbmUuYmFubmVyYFxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICBiYW5uZXIgKz0gJ1xcbic7XG5cbiAgICAgICAgICAgIHJldHVybiBiYW5uZXI7XG4gICAgICAgIH0gICAgICAgIFxuXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgZ2V0VXNhZ2UoaW5qZWN0cykge1xuICAgICAgICBpbmplY3RzID0geyAuLi50aGlzLmluamVjdHMsIC4uLmluamVjdHMgfTtcblxuICAgICAgICBsZXQgdXNhZ2UgPSAnJztcblxuICAgICAgICBsZXQgYmFubmVyID0gIXRoaXMuYmFubmVyU2hvd24gJiYgdGhpcy5nZXRCYW5uZXIoKTtcbiAgICAgICAgaWYgKGJhbm5lcikge1xuICAgICAgICAgICAgdXNhZ2UgKz0gYmFubmVyICsgJ1xcbic7XG4gICAgICAgIH0gICAgICAgIFxuICAgIFxuICAgICAgICBpZiAoaW5qZWN0cyAmJiBpbmplY3RzLmFmdGVyQmFubmVyKSB7XG4gICAgICAgICAgICB1c2FnZSArPSBpbmplY3RzLmFmdGVyQmFubmVyKCk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgbGV0IGZtdEFyZ3MgPSAnJztcbiAgICAgICAgaWYgKCFfLmlzRW1wdHkodGhpcy51c2FnZS5hcmd1bWVudHMpKSB7XG4gICAgICAgICAgICBmbXRBcmdzID0gJyAnICsgdGhpcy51c2FnZS5hcmd1bWVudHMubWFwKGFyZyA9PiBhcmcucmVxdWlyZWQgPyBgPCR7YXJnLm5hbWV9PmAgOiBgWyR7YXJnLm5hbWV9XWApLmpvaW4oJyAnKTtcbiAgICAgICAgfVxuICAgIFxuICAgICAgICB1c2FnZSArPSBgVXNhZ2U6ICR7dGhpcy51c2FnZS5wcm9ncmFtIHx8IHBhdGguYmFzZW5hbWUocHJvY2Vzcy5hcmd2WzFdKX0ke2ZtdEFyZ3N9IFtvcHRpb25zXVxcblxcbmA7XG4gICAgXG4gICAgICAgIGlmIChpbmplY3RzICYmIGluamVjdHMuYWZ0ZXJDb21tYW5kTGluZSkge1xuICAgICAgICAgICAgdXNhZ2UgKz0gaW5qZWN0cy5hZnRlckNvbW1hbmRMaW5lKCk7XG4gICAgICAgIH0gXG4gICAgICAgIFxuICAgICAgICBpZiAoIV8uaXNFbXB0eSh0aGlzLnVzYWdlLm9wdGlvbnMpKSB7XG4gICAgICAgICAgICB1c2FnZSArPSBgT3B0aW9uczpcXG5gO1xuICAgICAgICAgICAgXy5mb3JPd24odGhpcy51c2FnZS5vcHRpb25zLCAob3B0cywgbmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgIGxldCBsaW5lID0gJyAgJyArIG9wdGlvbkRlY29yYXRvcihuYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAob3B0cy5hbGlhcykge1xuICAgICAgICAgICAgICAgICAgICBsaW5lICs9IF8ucmVkdWNlKG9wdHMuYWxpYXMsIChzdW0sIGEpID0+IChzdW0gKyAnLCAnICsgb3B0aW9uRGVjb3JhdG9yKGEpKSwgJycpO1xuICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICBsaW5lICs9ICdcXG4nO1xuICAgICAgICAgICAgICAgIGxpbmUgKz0gJyAgICAnICsgb3B0cy5kZXNjICsgJ1xcbic7XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKCdkZWZhdWx0JyBpbiBvcHRzKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpbmUgKz0gJyAgICBkZWZhdWx0OiAnICsgb3B0cy5kZWZhdWx0LnRvU3RyaW5nKCkgKyAnXFxuJztcbiAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgaWYgKG9wdHMucmVxdWlyZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRzLnJlcXVpcmVkID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcgICAgY29uZGl0aW9uYWxcXG4nO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGluZSArPSAnICAgIHJlcXVpcmVkXFxuJztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChvcHRzLmNob2ljZXNQcm92aWRlciAmJiBBcnJheS5pc0FycmF5KG9wdHMuY2hvaWNlc1Byb3ZpZGVyKSkge1xuICAgICAgICAgICAgICAgICAgICBsaW5lICs9ICcgICAgYXZhaWxhYmxlIHZhbHVlczpcXG4nO1xuICAgICAgICAgICAgICAgICAgICBvcHRzLmNob2ljZXNQcm92aWRlci5mb3JFYWNoKGNob2ljZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBsaW5lICs9IGAgICAgICAgIFwiJHtjaG9pY2UudmFsdWV9XCI6ICR7Y2hvaWNlLm5hbWV9XFxuYDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgIGxpbmUgKz0gJ1xcbic7XG4gICAgXG4gICAgICAgICAgICAgICAgdXNhZ2UgKz0gbGluZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9ICAgICAgICBcbiAgICBcbiAgICAgICAgaWYgKGluamVjdHMgJiYgaW5qZWN0cy5hZnRlck9wdGlvbnMpIHtcbiAgICAgICAgICAgIHVzYWdlICs9IGluamVjdHMuYWZ0ZXJPcHRpb25zKCk7XG4gICAgICAgIH1cbiAgICBcbiAgICAgICAgcmV0dXJuIHVzYWdlO1xuICAgIH1cblxuICAgIHNob3dCYW5uYXIoKSB7XG4gICAgICAgIGxldCBiYW5uZXIgPSB0aGlzLmdldEJhbm5lcigpO1xuICAgICAgICBpZiAoYmFubmVyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhiYW5uZXIpO1xuICAgICAgICAgICAgdGhpcy5iYW5uZXJTaG93biA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgc2hvd1VzYWdlKGluamVjdHMpIHtcbiAgICAgICAgY29uc29sZS5sb2codGhpcy5nZXRVc2FnZShpbmplY3RzKSk7XG4gICAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgICAvKipcbiAgICAgKiBUaGlzIGZlYXR1cmUgaXMgbG9hZGVkIGF0IGNvbmZpZ3VyYXRpb24gc3RhZ2VcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgdHlwZTogRmVhdHVyZS5JTklULFxuXG4gICAgLyoqXG4gICAgICogTG9hZCB0aGUgZmVhdHVyZVxuICAgICAqIEBwYXJhbSB7QXBwfSBhcHAgLSBUaGUgY2xpIGFwcCBtb2R1bGUgb2JqZWN0XG4gICAgICogQHBhcmFtIHtvYmplY3R9IHVzYWdlT3B0aW9ucyAtIE9wdGlvbnMgZm9yIHRoZSBmZWF0dXJlICAgICBcbiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gW3VzYWdlT3B0aW9ucy5iYW5uZXJdIC0gQmFubmVyIG1lc3NhZ2Ugb3IgYmFubmVyIGdlbmVyYXRvciBmdW5jdGlvblxuICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbdXNhZ2VPcHRpb25zLnByb2dyYW1dIC0gRXhlY3V0YWJsZSBuYW1lXG4gICAgICogQHByb3BlcnR5IHthcnJheX0gW3VzYWdlT3B0aW9ucy5hcmd1bWVudHNdIC0gQ29tbWFuZCBsaW5lIGFyZ3VtZW50cywgaWRlbnRpZmllZCBieSB0aGUgcG9zaXRpb24gb2YgYXBwZWFyYW5jZVxuICAgICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBbdXNhZ2VPcHRpb25zLm9wdGlvbnNdIC0gQ29tbWFuZCBsaW5lIG9wdGlvbnMgICAgIFxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbnxmdW5jdGlvbn0gW3VzYWdlT3B0aW9ucy5zaWxlbnRNb2RlXSAtIFdoZXRoZXIgdG8gcnVuIGluIHNpbGllbnQgbW9kZSwgZGVmYXVsdCBmYWxzZVxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbnxmdW5jdGlvbn0gW3VzYWdlT3B0aW9ucy5ub25WYWxpZGF0aW9uTW9kZV0gLSBXaGV0aGVyIHRvIHJ1biB2YWxpZGF0aW9uXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFt1c2FnZU9wdGlvbnMuaGVscE9wdGlvbj0nPyddIC0gVGhlIG9wdGlvbiB3aGljaCBhY3QgYXMgaGVscFxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3VzYWdlT3B0aW9ucy5zaG93VXNhZ2VPbkVycm9yXVxuICAgICAqIFxuICAgICAqIEBleGFtcGxlXG4gICAgICogICBvcHRpb25zOiB7IFthcmd1bWVudEtleV06IHtcbiAgICAgKiAgICAgIGRlc2MsIC8vIHtzdHJpbmd9IC0gZGVzY3JpcHRpb25cbiAgICAgKiAgICAgIGFsaWFzLCAvLyB7YXJyYXkuPHN0cmluZz59IC0gYWxpYXMgYXJyYXlcbiAgICAgKiAgICAgIGJvb2wsIC8vIHtib29sZWFufSAtIHdoZXRoZXIgaXQgaXMgYSBib29sZWFuIHZhbHVlXG4gICAgICogICAgICBkZWZhdWx0LCAvLyB7Kn0gLSBkZWZhdWx0IHZhbHVlXG4gICAgICogICAgICBpbnF1aXJlLCAvLyB7Ym9vbGVhbiB8IGZ1bmN0aW9uKGNsaSkuPGJvb2xlYW4+fSAtIHdoZXRoZXIgdG8gZW5hYmxlIGludGVyYWN0aXZlIHF1ZXJ5XG4gICAgICogICAgICBwcm9tcHRNZXNzYWdlLCAvLyB7c3RyaW5nfSAtIHByb21wdCBtZXNzYWdlIGZvciBxdWVyeSwgd2lsbCB1c2UgZGVzYyBpZiBub3Qgc2V0XG4gICAgICogICAgICBwcm9tcHRUeXBlLCAvLyB7c3RyaW5nfSAtIHByb21wdCB0eXBlLCBjYW4gYmUgb25lIG9mIFsgaW5wdXQsIG51bWJlciwgY29uZmlybSwgbGlzdCwgcmF3bGlzdCwgZXhwYW5kLCBjaGVja2JveCwgcGFzc3dvcmQsIGVkaXRvciBdXG4gICAgICogICAgICBwcm9tcHREZWZhdWx0LCAvLyB7KiB8IGZ1bmN0aW9uKGNsaSkuPCo+fSAtIGRlZmF1bHQgdmFsdWUgYXBwZWFyZWQgb24gcXVlcnkgb3IgYSBhc3luYyBmdW5jdGlvbiB0byByZXR1cm4gdGhlIGRlZmF1bHQgdmFsdWVcbiAgICAgKiAgICAgIGNob2ljZXNQcm92aWRlciwgLy8ge2FycmF5IHwgZnVuY3Rpb24oY2xpKS48YXJyYXk+IHwgZnVuY3Rpb24uPGZ1bmN0aW9uKHN0cmluZykuPGFycmF5Pj59IC0gcmVxdWlyZWQgZm9yIHByb21wdCB0eXBlIGxpc3QsIHJhd2xpc3QsIGV4cGFuZCwgY2hlY2tib3hcbiAgICAgKiAgICAgIGZpbHRlciwgLy8ge2Z1bmN0aW9uKGFyZ3YsIGNsaSkuPGFyZ3Y+fSAtIGZpbHRlciB0byBwcm9jZXNzIHRoZSBhcmd1bWVudCB2YWx1ZVxuICAgICAqICAgICAgYWZ0ZXJJbnF1aXJlLCAvLyB7ZnVuY3Rpb259IC0gYWZ0ZXIgaW5xdWlyZSBob29rLFxuICAgICAqICAgICAgc2lsZW50TW9kZURlZmF1bHQgLy8geyp9IC0gZGVmYXVsdCB2YWx1ZSB3aGVuIHJ1biBpbiBzaWxpZW50IG1vZGUsXG4gICAgICogICB9IH1cbiAgICAgKiBcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48Kj59XG4gICAgICovXG4gICAgbG9hZF86IGFzeW5jIChhcHAsIHVzYWdlT3B0aW9ucykgPT4geyAgIFxuICAgICAgICBhcHAuY29tbWFuZExpbmUgPSBuZXcgQ29tbWFuZExpbmUoYXBwLCB1c2FnZU9wdGlvbnMpOyAgICAgICAgICAgICBcblxuICAgICAgICBsZXQgc2lsZW50TW9kZSA9IHVzYWdlT3B0aW9ucy5zaWxlbnRNb2RlO1xuXG4gICAgICAgIGlmIChzaWxlbnRNb2RlICYmIHR5cGVvZiBzaWxlbnRNb2RlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBzaWxlbnRNb2RlID0gc2lsZW50TW9kZShhcHAuY29tbWFuZExpbmUpO1xuICAgICAgICB9ICBcblxuICAgICAgICBhcHAuY29tbWFuZExpbmUuc2lsZW50TW9kZSA9IHNpbGVudE1vZGU7XG5cbiAgICAgICAgaWYgKHNpbGVudE1vZGUpIHtcbiAgICAgICAgICAgIGF3YWl0IGFwcC5jb21tYW5kTGluZS5maWxsU2lsZW50TW9kZURlZmF1bHRzXygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYXBwLmNvbW1hbmRMaW5lLnNob3dCYW5uYXIoKTtcbiAgICAgICAgICAgIGF3YWl0IGFwcC5jb21tYW5kTGluZS5pbnF1aXJlXygpOyAgICAgICAgICAgIFxuICAgICAgICB9ICAgICAgICBcblxuICAgICAgICBsZXQgbm9uVmFsaWRhdGlvbk1vZGUgPSB1c2FnZU9wdGlvbnMubm9uVmFsaWRhdGlvbk1vZGU7XG5cbiAgICAgICAgaWYgKG5vblZhbGlkYXRpb25Nb2RlICYmIHR5cGVvZiBub25WYWxpZGF0aW9uTW9kZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgbm9uVmFsaWRhdGlvbk1vZGUgPSBub25WYWxpZGF0aW9uTW9kZShhcHAuY29tbWFuZExpbmUpO1xuICAgICAgICB9ICBcblxuICAgICAgICBhcHAuY29tbWFuZExpbmUubm9uVmFsaWRhdGlvbk1vZGUgPSBub25WYWxpZGF0aW9uTW9kZTtcblxuICAgICAgICBpZiAoIW5vblZhbGlkYXRpb25Nb2RlKSB7XG4gICAgICAgICAgICBhd2FpdCBhcHAuY29tbWFuZExpbmUudmFsaWRhdGVfKCk7XG4gICAgICAgIH1cbiAgICB9XG59OyJdfQ==