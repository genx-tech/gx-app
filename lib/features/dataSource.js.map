{"version":3,"file":"dataSource.js","names":["require","_","Feature","InvalidConfiguration","module","exports","type","SERVICE","load_","app","dataSources","Connector","tryRequire","loggerProxy","log","args","forOwn","dataSource","dbms","config","connectorName","serviceName","connection","connectionString","other","connectorService","createConnector","logger","registerService","on","elegantStoppers","push","end_"],"sources":["../../src/features/dataSource.js"],"sourcesContent":["\"use strict\";\n\n/**\n * Enable data source feature\n * @module Feature_DataSource\n */\n\nconst { _ } = require('@genx/july');\nconst Feature = require('../enum/Feature');\nconst { InvalidConfiguration } = require('@genx/error');\n\nmodule.exports = {\n    /**\n     * This feature is loaded at service stage\n     * @member {string}\n     */\n    type: Feature.SERVICE,\n\n    /**\n     * Load the feature\n     * @param {ServiceContainer} app - The app module object\n     * @param {object} dataSources - Datasource settings\n     * @returns {Promise.<*>}\n     */\n    load_: async (app, dataSources) => {\n        const { Connector } = app.tryRequire('@genx/data');\n\n        const loggerProxy = {\n            log: (...args) => app.log(...args)\n        };\n\n        _.forOwn(dataSources, (dataSource, dbms) => {\n            _.forOwn(dataSource, (config, connectorName) => {\n                let serviceName = dbms + '.' + connectorName;\n\n                if (!config.connection) {\n                    throw new InvalidConfiguration(\n                        `Missing connection config for data source \"${serviceName}\".`,\n                        app,\n                        `dataSource.${dbms}.${connectorName}`\n                    );\n                }\n                \n                let { connection: connectionString, ...other } = config;  \n                \n                let connectorService = Connector.createConnector(dbms, connectionString, { logger: loggerProxy, ...other });\n                app.registerService(serviceName, connectorService);\n\n                app.on('stopping', (elegantStoppers) => {\n                    elegantStoppers.push(connectorService.end_());\n                });\n            });            \n        });        \n    }\n};"],"mappings":"AAAA,YAAY,CAACA,OAAA,gCAOb,KAAM,CAAEC,CAAE,CAAC,CAAGD,OAAO,CAAC,YAAY,CAAC,CACnC,KAAM,CAAAE,OAAO,CAAGF,OAAO,CAAC,iBAAiB,CAAC,CAC1C,KAAM,CAAEG,oBAAqB,CAAC,CAAGH,OAAO,CAAC,aAAa,CAAC,CAEvDI,MAAM,CAACC,OAAO,CAAG,CAKbC,IAAI,CAAEJ,OAAO,CAACK,OAAO,CAQrBC,KAAK,CAAE,KAAAA,CAAOC,GAAG,CAAEC,WAAW,GAAK,CAC/B,KAAM,CAAEC,SAAU,CAAC,CAAGF,GAAG,CAACG,UAAU,CAAC,YAAY,CAAC,CAElD,KAAM,CAAAC,WAAW,CAAG,CAChBC,GAAG,CAAEA,CAAC,GAAGC,IAAI,GAAKN,GAAG,CAACK,GAAG,CAAC,GAAGC,IAAI,CACrC,CAAC,CAEDd,CAAC,CAACe,MAAM,CAACN,WAAW,CAAE,CAACO,UAAU,CAAEC,IAAI,GAAK,CACxCjB,CAAC,CAACe,MAAM,CAACC,UAAU,CAAE,CAACE,MAAM,CAAEC,aAAa,GAAK,CAC5C,GAAI,CAAAC,WAAW,CAAGH,IAAI,CAAG,GAAG,CAAGE,aAAa,CAE5C,GAAI,CAACD,MAAM,CAACG,UAAU,CAAE,CACpB,KAAM,IAAI,CAAAnB,oBAAoB,CACzB,8CAA6CkB,WAAY,IAAG,CAC7DZ,GAAG,CACF,cAAaS,IAAK,IAAGE,aAAc,EAAC,CAE7C,CAEA,GAAI,CAAEE,UAAU,CAAEC,gBAAgB,CAAE,GAAGC,KAAM,CAAC,CAAGL,MAAM,CAEvD,GAAI,CAAAM,gBAAgB,CAAGd,SAAS,CAACe,eAAe,CAACR,IAAI,CAAEK,gBAAgB,CAAE,CAAEI,MAAM,CAAEd,WAAW,CAAE,GAAGW,KAAM,CAAC,CAAC,CAC3Gf,GAAG,CAACmB,eAAe,CAACP,WAAW,CAAEI,gBAAgB,CAAC,CAElDhB,GAAG,CAACoB,EAAE,CAAC,UAAU,CAAGC,eAAe,EAAK,CACpCA,eAAe,CAACC,IAAI,CAACN,gBAAgB,CAACO,IAAI,EAAE,CAChD,CAAC,CACL,CAAC,CACL,CAAC,CACL,CACJ,CAAC"}