{"version":3,"sources":["../../src/features/objectStore.js"],"names":["_","require","Feature","Store","constructor","app","_app","_store","Map","_factory","registerFactory","name","factory","createAndStore","has","Error","obj","set","ensureOne","get","module","exports","type","PLUGIN","load_","factories","store","forOwn"],"mappings":"AAAA;AAEA;AACA;AACA;AACA;;AAEA,MAAM;AAAEA,EAAAA;AAAF,IAAQC,OAAO,CAAC,YAAD,CAArB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,iBAAD,CAAvB;;AAEA,MAAME,KAAN,CAAY;AACRC,EAAAA,WAAW,CAACC,GAAD,EAAM;AACb,SAAKC,IAAL,GAAYD,GAAZ;AACA,SAAKE,MAAL,GAAc,IAAIC,GAAJ,EAAd;AACA,SAAKC,QAAL,GAAgB,EAAhB;AACH;;AAEDC,EAAAA,eAAe,CAACC,IAAD,EAAOC,OAAP,EAAgB;AAC3B,SAAKH,QAAL,CAAcE,IAAd,IAAsBC,OAAtB;AACH;;AAEDC,EAAAA,cAAc,CAACF,IAAD,EAAO;AACjB,QAAI,KAAKJ,MAAL,CAAYO,GAAZ,CAAgBH,IAAhB,CAAJ,EAA2B;AACvB,YAAM,IAAII,KAAJ,CAAW,IAAGJ,IAAK,sDAAnB,CAAN;AACH;;AAED,QAAIC,OAAO,GAAG,KAAKH,QAAL,CAAcE,IAAd,CAAd;;AACA,QAAI,CAACC,OAAD,IAAY,OAAOA,OAAP,KAAmB,UAAnC,EAA+C;AAC3C,YAAM,IAAIG,KAAJ,CAAW,uBAAsBJ,IAAK,yBAAtC,CAAN;AACH;;AAED,QAAIK,GAAG,GAAGJ,OAAO,CAAC,KAAKN,IAAN,CAAjB;;AACA,SAAKC,MAAL,CAAYU,GAAZ,CAAgBN,IAAhB,EAAsBK,GAAtB;;AACA,WAAOA,GAAP;AACH;;AAEDE,EAAAA,SAAS,CAACP,IAAD,EAAO;AACZ,WAAO,KAAKJ,MAAL,CAAYY,GAAZ,CAAgBR,IAAhB,KAAyB,KAAKE,cAAL,CAAoBF,IAApB,CAAhC;AACH;;AA5BO;;AA+BZS,MAAM,CAACC,OAAP,GAAiB;AAEb;AACJ;AACA;AACA;AACIC,EAAAA,IAAI,EAAEpB,OAAO,CAACqB,MAND;;AAQb;AACJ;AACA;AACA;AACA;AACA;AACIC,EAAAA,KAAK,EAAE,CAACnB,GAAD,EAAMoB,SAAN,KAAoB;AACvB,QAAIC,KAAK,GAAG,IAAIvB,KAAJ,CAAUE,GAAV,CAAZ;;AAEAL,IAAAA,CAAC,CAAC2B,MAAF,CAASF,SAAT,EAAoB,CAACb,OAAD,EAAUD,IAAV,KAAmB;AACnCe,MAAAA,KAAK,CAAChB,eAAN,CAAsBC,IAAtB,EAA4BC,OAA5B;AACH,KAFD;;AAIAP,IAAAA,GAAG,CAACqB,KAAJ,GAAYA,KAAZ;AACH;AAtBY,CAAjB","sourcesContent":["\"use strict\";\n\n/**\n * Enable object store feature\n * @module Feature_ObjectStore\n */\n\nconst { _ } = require('@genx/july');\nconst Feature = require('../enum/Feature');\n\nclass Store {\n    constructor(app) {\n        this._app = app;\n        this._store = new Map();\n        this._factory = {};\n    }\n\n    registerFactory(name, factory) {\n        this._factory[name] = factory;\n    }\n\n    createAndStore(name) {\n        if (this._store.has(name)) {\n            throw new Error(`\"${name}\" already in store and don't need to create another.`);\n        }\n\n        let factory = this._factory[name];      \n        if (!factory || typeof factory !== 'function') {\n            throw new Error(`Factroy for making \"${name}\" not found or invalid!`);\n        }\n\n        let obj = factory(this._app);\n        this._store.set(name, obj);\n        return obj;\n    }\n\n    ensureOne(name) {\n        return this._store.get(name) || this.createAndStore(name);\n    }\n}\n\nmodule.exports = {\n\n    /**\n     * This feature is loaded at plug-in stage\n     * @member {string}\n     */\n    type: Feature.PLUGIN,\n\n    /**\n     * Load the feature\n     * @param {App} app - The app module object\n     * @param {object} factories - Object factories\n     * @returns {Promise.<*>}\n     */\n    load_: (app, factories) => {\n        let store = new Store(app);\n\n        _.forOwn(factories, (factory, name) => {\n            store.registerFactory(name, factory);\n        });\n\n        app.store = store;\n    }\n};"],"file":"objectStore.js"}