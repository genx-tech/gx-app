{"version":3,"file":"objectStore.js","names":["require","_","Feature","Store","constructor","app","_app","_store","Map","_factory","registerFactory","name","factory","createAndStore","has","Error","obj","set","ensureOne","get","module","exports","type","PLUGIN","load_","factories","store","forOwn"],"sources":["../../src/features/objectStore.js"],"sourcesContent":["\"use strict\";\n\n/**\n * Enable object store feature\n * @module Feature_ObjectStore\n */\n\nconst { _ } = require('@genx/july');\nconst Feature = require('../enum/Feature');\n\nclass Store {\n    constructor(app) {\n        this._app = app;\n        this._store = new Map();\n        this._factory = {};\n    }\n\n    registerFactory(name, factory) {\n        this._factory[name] = factory;\n    }\n\n    createAndStore(name) {\n        if (this._store.has(name)) {\n            throw new Error(`\"${name}\" already in store and don't need to create another.`);\n        }\n\n        let factory = this._factory[name];      \n        if (!factory || typeof factory !== 'function') {\n            throw new Error(`Factroy for making \"${name}\" not found or invalid!`);\n        }\n\n        let obj = factory(this._app);\n        this._store.set(name, obj);\n        return obj;\n    }\n\n    ensureOne(name) {\n        return this._store.get(name) || this.createAndStore(name);\n    }\n}\n\nmodule.exports = {\n\n    /**\n     * This feature is loaded at plug-in stage\n     * @member {string}\n     */\n    type: Feature.PLUGIN,\n\n    /**\n     * Load the feature\n     * @param {App} app - The app module object\n     * @param {object} factories - Object factories\n     * @returns {Promise.<*>}\n     */\n    load_: (app, factories) => {\n        let store = new Store(app);\n\n        _.forOwn(factories, (factory, name) => {\n            store.registerFactory(name, factory);\n        });\n\n        app.store = store;\n    }\n};"],"mappings":"AAAA,YAAY,CAACA,OAAA,gCAOb,KAAM,CAAEC,CAAE,CAAC,CAAGD,OAAO,CAAC,YAAY,CAAC,CACnC,KAAM,CAAAE,OAAO,CAAGF,OAAO,CAAC,iBAAiB,CAAC,CAE1C,KAAM,CAAAG,KAAM,CACRC,WAAWA,CAACC,GAAG,CAAE,CACb,IAAI,CAACC,IAAI,CAAGD,GAAG,CACf,IAAI,CAACE,MAAM,CAAG,GAAI,CAAAC,GAAK,CACvB,IAAI,CAACC,QAAQ,CAAG,CAAC,CACrB,CAEAC,eAAeA,CAACC,IAAI,CAAEC,OAAO,CAAE,CAC3B,IAAI,CAACH,QAAQ,CAACE,IAAI,CAAC,CAAGC,OAC1B,CAEAC,cAAcA,CAACF,IAAI,CAAE,CACjB,GAAI,IAAI,CAACJ,MAAM,CAACO,GAAG,CAACH,IAAI,CAAC,CAAE,CACvB,KAAM,IAAI,CAAAI,KAAK,CAAE,IAAGJ,IAAK,sDAAqD,CAClF,CAEA,GAAI,CAAAC,OAAO,CAAG,IAAI,CAACH,QAAQ,CAACE,IAAI,CAAC,CACjC,GAAI,CAACC,OAAO,EAAI,MAAO,CAAAA,OAAO,GAAK,UAAU,CAAE,CAC3C,KAAM,IAAI,CAAAG,KAAK,CAAE,uBAAsBJ,IAAK,yBAAwB,CACxE,CAEA,GAAI,CAAAK,GAAG,CAAGJ,OAAO,CAAC,IAAI,CAACN,IAAI,CAAC,CAC5B,IAAI,CAACC,MAAM,CAACU,GAAG,CAACN,IAAI,CAAEK,GAAG,CAAC,CAC1B,MAAO,CAAAA,GACX,CAEAE,SAASA,CAACP,IAAI,CAAE,CACZ,MAAO,KAAI,CAACJ,MAAM,CAACY,GAAG,CAACR,IAAI,CAAC,EAAI,IAAI,CAACE,cAAc,CAACF,IAAI,CAC5D,CACJ,CAEAS,MAAM,CAACC,OAAO,CAAG,CAMbC,IAAI,CAAEpB,OAAO,CAACqB,MAAM,CAQpBC,KAAK,CAAEA,CAACnB,GAAG,CAAEoB,SAAS,GAAK,CACvB,GAAI,CAAAC,KAAK,CAAG,GAAI,CAAAvB,KAAK,CAACE,GAAG,CAAC,CAE1BJ,CAAC,CAAC0B,MAAM,CAACF,SAAS,CAAE,CAACb,OAAO,CAAED,IAAI,GAAK,CACnCe,KAAK,CAAChB,eAAe,CAACC,IAAI,CAAEC,OAAO,CACvC,CAAC,CAAC,CAEFP,GAAG,CAACqB,KAAK,CAAGA,KAChB,CACJ,CAAC"}