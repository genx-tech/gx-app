"use strict";

require("source-map-support/register");

const {
  fs
} = require('@genx/sys');

const Feature = require('../enum/Feature');

module.exports = {
  type: Feature.INIT,
  load_: async function (app, version) {
    if (version === '@package.version') {
      let pkgFile = app.toAbsolutePath('package.json');

      if (!(await fs.exists(pkgFile))) {
        throw new Error('"package.json" not found in working directory. CWD: ' + app.workingPath);
      }

      let pkg = await fs.readJson(pkgFile);
      version = pkg.version;
    }

    app.version = version;
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy92ZXJzaW9uLmpzIl0sIm5hbWVzIjpbImZzIiwicmVxdWlyZSIsIkZlYXR1cmUiLCJtb2R1bGUiLCJleHBvcnRzIiwidHlwZSIsIklOSVQiLCJsb2FkXyIsImFwcCIsInZlcnNpb24iLCJwa2dGaWxlIiwidG9BYnNvbHV0ZVBhdGgiLCJleGlzdHMiLCJFcnJvciIsIndvcmtpbmdQYXRoIiwicGtnIiwicmVhZEpzb24iXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBT0EsTUFBTTtBQUFFQSxFQUFBQTtBQUFGLElBQVNDLE9BQU8sQ0FBQyxXQUFELENBQXRCOztBQUNBLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLGlCQUFELENBQXZCOztBQUVBRSxNQUFNLENBQUNDLE9BQVAsR0FBaUI7QUFNYkMsRUFBQUEsSUFBSSxFQUFFSCxPQUFPLENBQUNJLElBTkQ7QUFjYkMsRUFBQUEsS0FBSyxFQUFFLGdCQUFnQkMsR0FBaEIsRUFBcUJDLE9BQXJCLEVBQThCO0FBQ2pDLFFBQUlBLE9BQU8sS0FBSyxrQkFBaEIsRUFBb0M7QUFDaEMsVUFBSUMsT0FBTyxHQUFHRixHQUFHLENBQUNHLGNBQUosQ0FBbUIsY0FBbkIsQ0FBZDs7QUFDQSxVQUFJLEVBQUUsTUFBTVgsRUFBRSxDQUFDWSxNQUFILENBQVVGLE9BQVYsQ0FBUixDQUFKLEVBQWlDO0FBQzdCLGNBQU0sSUFBSUcsS0FBSixDQUFVLHlEQUF5REwsR0FBRyxDQUFDTSxXQUF2RSxDQUFOO0FBQ0g7O0FBRUQsVUFBSUMsR0FBRyxHQUFHLE1BQU1mLEVBQUUsQ0FBQ2dCLFFBQUgsQ0FBWU4sT0FBWixDQUFoQjtBQUNBRCxNQUFBQSxPQUFPLEdBQUdNLEdBQUcsQ0FBQ04sT0FBZDtBQUNIOztBQUVERCxJQUFBQSxHQUFHLENBQUNDLE9BQUosR0FBY0EsT0FBZDtBQUNIO0FBMUJZLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogU2V0IGFwcCB2ZXJzaW9uXG4gKiBAbW9kdWxlIEZlYXR1cmVfVmVyc2lvblxuICovXG5cbmNvbnN0IHsgZnMgfSA9IHJlcXVpcmUoJ0BnZW54L3N5cycpO1xuY29uc3QgRmVhdHVyZSA9IHJlcXVpcmUoJy4uL2VudW0vRmVhdHVyZScpO1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICAgIC8qKlxuICAgICAqIFRoaXMgZmVhdHVyZSBpcyBsb2FkZWQgYXQgaW5pdCBzdGFnZVxuICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgKi9cbiAgICB0eXBlOiBGZWF0dXJlLklOSVQsXG5cbiAgICAvKipcbiAgICAgKiBMb2FkIHRoZSBmZWF0dXJlXG4gICAgICogQHBhcmFtIHtBcHB9IGFwcCAtIFRoZSBjbGkgYXBwIG1vZHVsZSBvYmplY3RcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmVyc2lvbiAtIFZlcnNpb24gaW5mb3JtYXRpb24sIHVzZSBAcGFja2FnZS52ZXJzaW9uIHRvIHVzZSB0aGUgdmVyc2lvbiBpbmZvIGZyb20gcGFja2FnZS5qc29uIGxvY2F0ZWQgdW5kZXIgd29ya2luZyBmb2xkZXJcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48Kj59XG4gICAgICovXG4gICAgbG9hZF86IGFzeW5jIGZ1bmN0aW9uIChhcHAsIHZlcnNpb24pIHtcbiAgICAgICAgaWYgKHZlcnNpb24gPT09ICdAcGFja2FnZS52ZXJzaW9uJykge1xuICAgICAgICAgICAgbGV0IHBrZ0ZpbGUgPSBhcHAudG9BYnNvbHV0ZVBhdGgoJ3BhY2thZ2UuanNvbicpO1xuICAgICAgICAgICAgaWYgKCEoYXdhaXQgZnMuZXhpc3RzKHBrZ0ZpbGUpKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignXCJwYWNrYWdlLmpzb25cIiBub3QgZm91bmQgaW4gd29ya2luZyBkaXJlY3RvcnkuIENXRDogJyArIGFwcC53b3JraW5nUGF0aCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBwa2cgPSBhd2FpdCBmcy5yZWFkSnNvbihwa2dGaWxlKTtcbiAgICAgICAgICAgIHZlcnNpb24gPSBwa2cudmVyc2lvbjtcbiAgICAgICAgfSBcblxuICAgICAgICBhcHAudmVyc2lvbiA9IHZlcnNpb247XG4gICAgfVxufTsiXX0=