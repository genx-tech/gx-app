"use strict";

require("source-map-support/register");

const Util = require('rk-utils');

const Feature = require('../enum/Feature');

module.exports = {
  type: Feature.INIT,
  load_: async function (app, version) {
    if (version === '@package.version') {
      let pkgFile = app.toAbsolutePath('package.json');

      if (!(await Util.fs.exists(pkgFile))) {
        throw new Error('"package.json" not found in working directory. CWD: ' + app.workingPath);
      }

      let pkg = await Util.fs.readJson(pkgFile);
      version = pkg.version;
    }

    app.version = version;
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy92ZXJzaW9uLmpzIl0sIm5hbWVzIjpbIlV0aWwiLCJyZXF1aXJlIiwiRmVhdHVyZSIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0eXBlIiwiSU5JVCIsImxvYWRfIiwiYXBwIiwidmVyc2lvbiIsInBrZ0ZpbGUiLCJ0b0Fic29sdXRlUGF0aCIsImZzIiwiZXhpc3RzIiwiRXJyb3IiLCJ3b3JraW5nUGF0aCIsInBrZyIsInJlYWRKc29uIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQU9BLE1BQU1BLElBQUksR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBcEI7O0FBQ0EsTUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsaUJBQUQsQ0FBdkI7O0FBRUFFLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQU1iQyxFQUFBQSxJQUFJLEVBQUVILE9BQU8sQ0FBQ0ksSUFORDtBQWNiQyxFQUFBQSxLQUFLLEVBQUUsZ0JBQWdCQyxHQUFoQixFQUFxQkMsT0FBckIsRUFBOEI7QUFDakMsUUFBSUEsT0FBTyxLQUFLLGtCQUFoQixFQUFvQztBQUNoQyxVQUFJQyxPQUFPLEdBQUdGLEdBQUcsQ0FBQ0csY0FBSixDQUFtQixjQUFuQixDQUFkOztBQUNBLFVBQUksRUFBRSxNQUFNWCxJQUFJLENBQUNZLEVBQUwsQ0FBUUMsTUFBUixDQUFlSCxPQUFmLENBQVIsQ0FBSixFQUFzQztBQUNsQyxjQUFNLElBQUlJLEtBQUosQ0FBVSx5REFBeUROLEdBQUcsQ0FBQ08sV0FBdkUsQ0FBTjtBQUNIOztBQUVELFVBQUlDLEdBQUcsR0FBRyxNQUFNaEIsSUFBSSxDQUFDWSxFQUFMLENBQVFLLFFBQVIsQ0FBaUJQLE9BQWpCLENBQWhCO0FBQ0FELE1BQUFBLE9BQU8sR0FBR08sR0FBRyxDQUFDUCxPQUFkO0FBQ0g7O0FBRURELElBQUFBLEdBQUcsQ0FBQ0MsT0FBSixHQUFjQSxPQUFkO0FBQ0g7QUExQlksQ0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqXG4gKiBTZXQgYXBwIHZlcnNpb25cbiAqIEBtb2R1bGUgRmVhdHVyZV9WZXJzaW9uXG4gKi9cblxuY29uc3QgVXRpbCA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5jb25zdCBGZWF0dXJlID0gcmVxdWlyZSgnLi4vZW51bS9GZWF0dXJlJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBpbml0IHN0YWdlXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIHR5cGU6IEZlYXR1cmUuSU5JVCxcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge0FwcH0gYXBwIC0gVGhlIGNsaSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2ZXJzaW9uIC0gVmVyc2lvbiBpbmZvcm1hdGlvbiwgdXNlIEBwYWNrYWdlLnZlcnNpb24gdG8gdXNlIHRoZSB2ZXJzaW9uIGluZm8gZnJvbSBwYWNrYWdlLmpzb24gbG9jYXRlZCB1bmRlciB3b3JraW5nIGZvbGRlclxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBsb2FkXzogYXN5bmMgZnVuY3Rpb24gKGFwcCwgdmVyc2lvbikge1xuICAgICAgICBpZiAodmVyc2lvbiA9PT0gJ0BwYWNrYWdlLnZlcnNpb24nKSB7XG4gICAgICAgICAgICBsZXQgcGtnRmlsZSA9IGFwcC50b0Fic29sdXRlUGF0aCgncGFja2FnZS5qc29uJyk7XG4gICAgICAgICAgICBpZiAoIShhd2FpdCBVdGlsLmZzLmV4aXN0cyhwa2dGaWxlKSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1wicGFja2FnZS5qc29uXCIgbm90IGZvdW5kIGluIHdvcmtpbmcgZGlyZWN0b3J5LiBDV0Q6ICcgKyBhcHAud29ya2luZ1BhdGgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgcGtnID0gYXdhaXQgVXRpbC5mcy5yZWFkSnNvbihwa2dGaWxlKTtcbiAgICAgICAgICAgIHZlcnNpb24gPSBwa2cudmVyc2lvbjtcbiAgICAgICAgfSBcblxuICAgICAgICBhcHAudmVyc2lvbiA9IHZlcnNpb247XG4gICAgfVxufTsiXX0=