"use strict";const crypto=require("crypto");const Feature=require("../enum/Feature");const{tryRequire}=require("../utils/Helpers");module.exports={type:Feature.SERVICE,load_:async function(app,options){const{RegionId,...opts}=options;const OSS=tryRequire("ali-oss");let client=new OSS(opts);const service={options,putStream_:(objectName,stream,size)=>size==null?client.putStream(objectName,stream):client.putStream(objectName,stream,{contentLength:size}),delete_:objectName=>client.delete(objectName),signPolicy:(policyObject,expiry)=>{const policyText=JSON.stringify(policyObject);const buff=Buffer.from(policyText);const base64data=buff.toString("base64");const hmac=crypto.createHmac("sha1",options.accessKeySecret);hmac.update(base64data);return{expiry:expiry.toMillis(),host:`https://${options.bucket}.${options.region}.aliyuncs.com`,bucket:options.bucket,accessId:options.accessKeyId,policy:base64data,signature:hmac.digest("base64")}}};app.registerService("aliOSS",service)}};