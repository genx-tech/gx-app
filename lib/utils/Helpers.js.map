{"version":3,"file":"Helpers.js","names":["_","require","ApplicationError","InvalidConfiguration","path","spawn","exports","withProps","Base","Props","constructor","args","Object","assign","dependsOn","features","app","fromFeature","hasNotEnabled","find","castArray","feature","enabled","Error","restart","envVariables","processOptions","env","process","detached","stdio","cp","argv","slice","unref","exit","requireConfig","config","keys","prefix","forEach","key","value","get","isNil","ensureFeatureName","name","scriptBaseName","fileName","basename"],"sources":["../../src/utils/Helpers.js"],"sourcesContent":["/**\n * Common helpers for service container.\n * @module Helpers\n */ \n\nconst { _ } = require('@genx/july');\nconst { ApplicationError, InvalidConfiguration } = require('@genx/error');\nconst path = require('path');\nconst spawn = require('child_process').spawn;\n\n/**\n * Returns a new class mixing with given properties and initial values.\n * @mixin\n * @param {*} Base \n * @param {object} Props \n */\nexports.withProps = (Base, Props) => class extends Base {\n    constructor(...args) {\n        super(...args);\n\n        Object.assign(this, Props);\n    }\n};\n\n /**\n  * @param {string|array.<string>} features - Dependencies of other features.\n  * @param {ServiceContainer} app - Origin service container app.\n  * @param {string} fromFeature - Dependent feature.\n  */\nexports.dependsOn = function (features, app, fromFeature) {\n    let hasNotEnabled = _.find(_.castArray(features), feature => !app.enabled(feature));\n\n    if (hasNotEnabled) {\n        throw new Error(`\"${fromFeature}\" feature requires \"${hasNotEnabled}\" feature to be enabled.`);\n    }\n};\n\n/**\n * Restart the current process.\n * @param {object} envVariables - Environment variables\n */\nexports.restart = function (envVariables) {\n    let processOptions = {        \n        env: { ...process.env, ...envVariables },\n        detached: true,\n        stdio: 'ignore'\n    };\n\n    let cp = spawn(process.argv[0], process.argv.slice(1), processOptions);\n    cp.unref();\n    process.exit(0);\n};\n\n/**\n * Check required config item\n * @param {App} app \n * @param {object} config \n * @param {array} keys \n * @param {string} prefix - Path of config item\n */\nexports.requireConfig = function (app, config, keys, prefix) {\n    keys.forEach(key => {\n        let value = _.get(config, key);\n        if (_.isNil(value)) {\n            throw new InvalidConfiguration(`Missing required config item \"${key}\".`, app, `${prefix}.${key}`);\n        }\n    })\n};\n\n/**\n * \n * @param {string} name \n */\nexports.ensureFeatureName = name => {\n    if (!name) throw new ApplicationError('This feature cannot be used in v1.x @genx/app.');\n}\n\nexports.scriptBaseName = (fileName) => path.basename(fileName, '.js');"],"mappings":"oDAKA,KAAM,CAAEA,CAAE,CAAC,CAAGC,OAAO,CAAC,YAAY,CAAC,CACnC,KAAM,CAAEC,gBAAgB,CAAEC,oBAAqB,CAAC,CAAGF,OAAO,CAAC,aAAa,CAAC,CACzE,KAAM,CAAAG,IAAI,CAAGH,OAAO,CAAC,MAAM,CAAC,CAC5B,KAAM,CAAAI,KAAK,CAAGJ,OAAO,CAAC,eAAe,CAAC,CAACI,KAAK,CAQ5CC,OAAO,CAACC,SAAS,CAAG,CAACC,IAAI,CAAEC,KAAK,GAAK,aAAc,CAAAD,IAAK,CACpDE,WAAWA,CAAC,GAAGC,IAAI,CAAE,CACjB,KAAK,CAAC,GAAGA,IAAI,CAAC,CAEdC,MAAM,CAACC,MAAM,CAAC,IAAI,CAAEJ,KAAK,CAC7B,CACJ,CAAC,CAODH,OAAO,CAACQ,SAAS,CAAG,SAAUC,QAAQ,CAAEC,GAAG,CAAEC,WAAW,CAAE,CACtD,GAAI,CAAAC,aAAa,CAAGlB,CAAC,CAACmB,IAAI,CAACnB,CAAC,CAACoB,SAAS,CAACL,QAAQ,CAAC,CAAEM,OAAO,EAAI,CAACL,GAAG,CAACM,OAAO,CAACD,OAAO,CAAC,CAAC,CAEnF,GAAIH,aAAa,CAAE,CACf,KAAM,IAAI,CAAAK,KAAK,CAAE,IAAGN,WAAY,uBAAsBC,aAAc,0BAAyB,CACjG,CACJ,CAAC,CAMDZ,OAAO,CAACkB,OAAO,CAAG,SAAUC,YAAY,CAAE,CACtC,GAAI,CAAAC,cAAc,CAAG,CACjBC,GAAG,CAAE,CAAE,GAAGC,OAAO,CAACD,GAAG,CAAE,GAAGF,YAAa,CAAC,CACxCI,QAAQ,CAAE,IAAI,CACdC,KAAK,CAAE,QACX,CAAC,CAED,GAAI,CAAAC,EAAE,CAAG1B,KAAK,CAACuB,OAAO,CAACI,IAAI,CAAC,CAAC,CAAC,CAAEJ,OAAO,CAACI,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC,CAAEP,cAAc,CAAC,CACtEK,EAAE,CAACG,KAAK,EAAE,CACVN,OAAO,CAACO,IAAI,CAAC,CAAC,CAClB,CAAC,CASD7B,OAAO,CAAC8B,aAAa,CAAG,SAAUpB,GAAG,CAAEqB,MAAM,CAAEC,IAAI,CAAEC,MAAM,CAAE,CACzDD,IAAI,CAACE,OAAO,CAACC,GAAG,EAAI,CAChB,GAAI,CAAAC,KAAK,CAAG1C,CAAC,CAAC2C,GAAG,CAACN,MAAM,CAAEI,GAAG,CAAC,CAC9B,GAAIzC,CAAC,CAAC4C,KAAK,CAACF,KAAK,CAAC,CAAE,CAChB,KAAM,IAAI,CAAAvC,oBAAoB,CAAE,iCAAgCsC,GAAI,IAAG,CAAEzB,GAAG,CAAG,GAAEuB,MAAO,IAAGE,GAAI,EAAC,CACpG,CACJ,CAAC,CACL,CAAC,CAMDnC,OAAO,CAACuC,iBAAiB,CAAGC,IAAI,EAAI,CAChC,GAAI,CAACA,IAAI,CAAE,KAAM,IAAI,CAAA5C,gBAAgB,CAAC,gDAAgD,CAC1F,CAAC,CAEDI,OAAO,CAACyC,cAAc,CAAIC,QAAQ,EAAK5C,IAAI,CAAC6C,QAAQ,CAACD,QAAQ,CAAE,KAAK,CAAC"}