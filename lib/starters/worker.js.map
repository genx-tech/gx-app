{"version":3,"sources":["../../src/starters/worker.js"],"names":["startWorker","worker","options","workerName","dontStop","initializer","uninitializer","appOptions","App","require","app","start_","stop_","error","console","process","exit","module","exports"],"mappings":";;;;AAQA,eAAeA,WAAf,CAA2BC,MAA3B,EAAmCC,OAAnC,EAA4C;AACxC,QAAM;AAAEC,IAAAA,UAAF;AAAcC,IAAAA,QAAd;AAAwBC,IAAAA,WAAxB;AAAqCC,IAAAA,aAArC;AAAoD,OAAGC;AAAvD,MAAuEL,OAAO,IAAI,EAAxF;;AAEA,QAAMM,GAAG,GAAGC,OAAO,CAAC,IAAD,CAAnB;;AAGA,MAAIC,GAAG,GAAG,IAAIF,GAAJ,CAAQL,UAAU,IAAI,QAAtB,EAAgCI,UAAhC,CAAV;;AAEA,MAAI;AACA,UAAMG,GAAG,CAACC,MAAJ,EAAN;;AAEA,QAAIN,WAAJ,EAAiB;AACb,YAAMA,WAAW,CAACK,GAAD,CAAjB;AACH;;AAED,UAAMT,MAAM,CAACS,GAAD,CAAZ;;AAEA,QAAI,CAACN,QAAL,EAAe;AACX,YAAMM,GAAG,CAACE,KAAJ,EAAN;AACH;;AAED,QAAIN,aAAJ,EAAmB;AACf,YAAMA,aAAa,EAAnB;AACH;AACJ,GAhBD,CAgBE,OAAOO,KAAP,EAAc;AACZC,IAAAA,OAAO,CAACD,KAAR,CAAcA,KAAd;AACAE,IAAAA,OAAO,CAACC,IAAR,CAAa,CAAb;AACH;AACJ;;AAEDC,MAAM,CAACC,OAAP,GAAiBlB,WAAjB","sourcesContent":["/**\n * Start a worker app\n * @param {Function} worker \n * @param {object} [workerOptions] \n * @property {string} [workerOptions.workerName]\n * @property {boolean} [workerOptions.dontStop] - Don't stop after worker done \n * @property {Function} [workerOptions.initializer] \n */\nasync function startWorker(worker, options) {\n    const { workerName, dontStop, initializer, uninitializer, ...appOptions } = (options || {});\n\n    const App = require('..');\n\n    // create an app instance with custom configuration\n    let app = new App(workerName || 'worker', appOptions);\n\n    try {\n        await app.start_();\n    \n        if (initializer) {\n            await initializer(app);\n        }    \n        \n        await worker(app);\n        \n        if (!dontStop) {\n            await app.stop_();\n        }\n\n        if (uninitializer) {\n            await uninitializer();\n        }\n    } catch (error) {\n        console.error(error);\n        process.exit(1);\n    } \n}\n\nmodule.exports = startWorker;"],"file":"worker.js"}