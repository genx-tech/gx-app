{"version":3,"file":"worker.js","names":["startWorker","worker","options","workerName","dontStop","initializer","uninitializer","throwOnError","appOptions","App","require","app","start_","result","stop_","error","console","message","process","exit","module","exports"],"sources":["../../src/starters/worker.js"],"sourcesContent":["/**\n * Start a worker app\n * @param {Function} worker \n * @param {object} [workerOptions] \n * @property {string} [workerOptions.workerName]\n * @property {boolean} [workerOptions.dontStop] - Don't stop after worker done \n * @property {Function} [workerOptions.initializer] \n */\nasync function startWorker(worker, options) {\n    const { workerName, dontStop, initializer, uninitializer, throwOnError, ...appOptions } = (options || {});\n\n    const App = require('..');\n\n    // create an app instance with custom configuration\n    let app = new App(workerName || 'worker', appOptions);\n\n    try {\n        await app.start_();\n    \n        if (initializer) {\n            await initializer(app);\n        }    \n        \n        const result = await worker(app);\n        \n        if (!dontStop) {\n            await app.stop_();\n        }\n\n        if (uninitializer) {\n            await uninitializer();\n        }\n\n        return result;\n    } catch (error) {\n        if (throwOnError) {\n            throw error;\n        }\n        \n        console.error(error.message || error);\n        process.exit(1);\n    } \n}\n\nmodule.exports = startWorker;"],"mappings":"oDAQA,cAAe,CAAAA,WAAWA,CAACC,MAAM,CAAEC,OAAO,CAAE,CACxC,KAAM,CAAEC,UAAU,CAAEC,QAAQ,CAAEC,WAAW,CAAEC,aAAa,CAAEC,YAAY,CAAE,GAAGC,UAAW,CAAC,CAAIN,OAAO,EAAI,CAAC,CAAE,CAEzG,KAAM,CAAAO,GAAG,CAAGC,OAAO,CAAC,IAAI,CAAC,CAGzB,GAAI,CAAAC,GAAG,CAAG,GAAI,CAAAF,GAAG,CAACN,UAAU,EAAI,QAAQ,CAAEK,UAAU,CAAC,CAErD,GAAI,CACA,KAAM,CAAAG,GAAG,CAACC,MAAM,EAAE,CAElB,GAAIP,WAAW,CAAE,CACb,KAAM,CAAAA,WAAW,CAACM,GAAG,CACzB,CAEA,KAAM,CAAAE,MAAM,CAAG,KAAM,CAAAZ,MAAM,CAACU,GAAG,CAAC,CAEhC,GAAI,CAACP,QAAQ,CAAE,CACX,KAAM,CAAAO,GAAG,CAACG,KAAK,EACnB,CAEA,GAAIR,aAAa,CAAE,CACf,KAAM,CAAAA,aAAa,EACvB,CAEA,MAAO,CAAAO,MACX,CAAE,MAAOE,KAAK,CAAE,CACZ,GAAIR,YAAY,CAAE,CACd,KAAM,CAAAQ,KACV,CAEAC,OAAO,CAACD,KAAK,CAACA,KAAK,CAACE,OAAO,EAAIF,KAAK,CAAC,CACrCG,OAAO,CAACC,IAAI,CAAC,CAAC,CAClB,CACJ,CAEAC,MAAM,CAACC,OAAO,CAAGrB,WAAW"}