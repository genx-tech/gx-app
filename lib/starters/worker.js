"use strict";

require("source-map-support/register");

async function startWorker(worker, options) {
  const {
    workerName,
    dontStop,
    initializer,
    ...appOptions
  } = options || {};

  const App = require('..');

  let app = new App(workerName || 'worker', appOptions);

  try {
    await app.start_();

    if (initializer) {
      await initializer(app);
    }

    await worker(app);

    if (!dontStop) {
      await app.stop_();
    }
  } catch (error) {
    console.error(error);
    process.exit(1);
  }
}

module.exports = startWorker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGFydGVycy93b3JrZXIuanMiXSwibmFtZXMiOlsic3RhcnRXb3JrZXIiLCJ3b3JrZXIiLCJvcHRpb25zIiwid29ya2VyTmFtZSIsImRvbnRTdG9wIiwiaW5pdGlhbGl6ZXIiLCJhcHBPcHRpb25zIiwiQXBwIiwicmVxdWlyZSIsImFwcCIsInN0YXJ0XyIsInN0b3BfIiwiZXJyb3IiLCJjb25zb2xlIiwicHJvY2VzcyIsImV4aXQiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7O0FBUUEsZUFBZUEsV0FBZixDQUEyQkMsTUFBM0IsRUFBbUNDLE9BQW5DLEVBQTRDO0FBQ3hDLFFBQU07QUFBRUMsSUFBQUEsVUFBRjtBQUFjQyxJQUFBQSxRQUFkO0FBQXdCQyxJQUFBQSxXQUF4QjtBQUFxQyxPQUFHQztBQUF4QyxNQUF3REosT0FBTyxJQUFJLEVBQXpFOztBQUVBLFFBQU1LLEdBQUcsR0FBR0MsT0FBTyxDQUFDLElBQUQsQ0FBbkI7O0FBR0EsTUFBSUMsR0FBRyxHQUFHLElBQUlGLEdBQUosQ0FBUUosVUFBVSxJQUFJLFFBQXRCLEVBQWdDRyxVQUFoQyxDQUFWOztBQUVBLE1BQUk7QUFDQSxVQUFNRyxHQUFHLENBQUNDLE1BQUosRUFBTjs7QUFFQSxRQUFJTCxXQUFKLEVBQWlCO0FBQ2IsWUFBTUEsV0FBVyxDQUFDSSxHQUFELENBQWpCO0FBQ0g7O0FBRUQsVUFBTVIsTUFBTSxDQUFDUSxHQUFELENBQVo7O0FBRUEsUUFBSSxDQUFDTCxRQUFMLEVBQWU7QUFDWCxZQUFNSyxHQUFHLENBQUNFLEtBQUosRUFBTjtBQUNIO0FBQ0osR0FaRCxDQVlFLE9BQU9DLEtBQVAsRUFBYztBQUNaQyxJQUFBQSxPQUFPLENBQUNELEtBQVIsQ0FBY0EsS0FBZDtBQUNBRSxJQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiO0FBQ0g7QUFDSjs7QUFFREMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCakIsV0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN0YXJ0IGEgd29ya2VyIGFwcFxuICogQHBhcmFtIHtGdW5jdGlvbn0gd29ya2VyIFxuICogQHBhcmFtIHtvYmplY3R9IFt3b3JrZXJPcHRpb25zXSBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbd29ya2VyT3B0aW9ucy53b3JrZXJOYW1lXVxuICogQHByb3BlcnR5IHtib29sZWFufSBbd29ya2VyT3B0aW9ucy5kb250U3RvcF0gLSBEb24ndCBzdG9wIGFmdGVyIHdvcmtlciBkb25lIFxuICogQHByb3BlcnR5IHtGdW5jdGlvbn0gW3dvcmtlck9wdGlvbnMuaW5pdGlhbGl6ZXJdIFxuICovXG5hc3luYyBmdW5jdGlvbiBzdGFydFdvcmtlcih3b3JrZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IHdvcmtlck5hbWUsIGRvbnRTdG9wLCBpbml0aWFsaXplciwgLi4uYXBwT3B0aW9ucyB9ID0gKG9wdGlvbnMgfHwge30pO1xuXG4gICAgY29uc3QgQXBwID0gcmVxdWlyZSgnLi4nKTtcblxuICAgIC8vIGNyZWF0ZSBhbiBhcHAgaW5zdGFuY2Ugd2l0aCBjdXN0b20gY29uZmlndXJhdGlvblxuICAgIGxldCBhcHAgPSBuZXcgQXBwKHdvcmtlck5hbWUgfHwgJ3dvcmtlcicsIGFwcE9wdGlvbnMpO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgYXBwLnN0YXJ0XygpO1xuICAgIFxuICAgICAgICBpZiAoaW5pdGlhbGl6ZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IGluaXRpYWxpemVyKGFwcCk7XG4gICAgICAgIH0gICAgXG4gICAgICAgIFxuICAgICAgICBhd2FpdCB3b3JrZXIoYXBwKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghZG9udFN0b3ApIHtcbiAgICAgICAgICAgIGF3YWl0IGFwcC5zdG9wXygpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHByb2Nlc3MuZXhpdCgxKTtcbiAgICB9IFxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHN0YXJ0V29ya2VyOyJdfQ==