"use strict";

require("source-map-support/register");

async function startWorker(worker, options) {
  const {
    workerName,
    dontStop,
    initializer,
    uninitializer,
    ...appOptions
  } = options || {};

  const App = require('..');

  let app = new App(workerName || 'worker', appOptions);

  try {
    await app.start_();

    if (initializer) {
      await initializer(app);
    }

    await worker(app);

    if (!dontStop) {
      await app.stop_();
    }

    if (uninitializer) {
      await uninitializer();
    }
  } catch (error) {
    console.error(error);
    process.exit(1);
  }
}

module.exports = startWorker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zdGFydGVycy93b3JrZXIuanMiXSwibmFtZXMiOlsic3RhcnRXb3JrZXIiLCJ3b3JrZXIiLCJvcHRpb25zIiwid29ya2VyTmFtZSIsImRvbnRTdG9wIiwiaW5pdGlhbGl6ZXIiLCJ1bmluaXRpYWxpemVyIiwiYXBwT3B0aW9ucyIsIkFwcCIsInJlcXVpcmUiLCJhcHAiLCJzdGFydF8iLCJzdG9wXyIsImVycm9yIiwiY29uc29sZSIsInByb2Nlc3MiLCJleGl0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7OztBQVFBLGVBQWVBLFdBQWYsQ0FBMkJDLE1BQTNCLEVBQW1DQyxPQUFuQyxFQUE0QztBQUN4QyxRQUFNO0FBQUVDLElBQUFBLFVBQUY7QUFBY0MsSUFBQUEsUUFBZDtBQUF3QkMsSUFBQUEsV0FBeEI7QUFBcUNDLElBQUFBLGFBQXJDO0FBQW9ELE9BQUdDO0FBQXZELE1BQXVFTCxPQUFPLElBQUksRUFBeEY7O0FBRUEsUUFBTU0sR0FBRyxHQUFHQyxPQUFPLENBQUMsSUFBRCxDQUFuQjs7QUFHQSxNQUFJQyxHQUFHLEdBQUcsSUFBSUYsR0FBSixDQUFRTCxVQUFVLElBQUksUUFBdEIsRUFBZ0NJLFVBQWhDLENBQVY7O0FBRUEsTUFBSTtBQUNBLFVBQU1HLEdBQUcsQ0FBQ0MsTUFBSixFQUFOOztBQUVBLFFBQUlOLFdBQUosRUFBaUI7QUFDYixZQUFNQSxXQUFXLENBQUNLLEdBQUQsQ0FBakI7QUFDSDs7QUFFRCxVQUFNVCxNQUFNLENBQUNTLEdBQUQsQ0FBWjs7QUFFQSxRQUFJLENBQUNOLFFBQUwsRUFBZTtBQUNYLFlBQU1NLEdBQUcsQ0FBQ0UsS0FBSixFQUFOO0FBQ0g7O0FBRUQsUUFBSU4sYUFBSixFQUFtQjtBQUNmLFlBQU1BLGFBQWEsRUFBbkI7QUFDSDtBQUNKLEdBaEJELENBZ0JFLE9BQU9PLEtBQVAsRUFBYztBQUNaQyxJQUFBQSxPQUFPLENBQUNELEtBQVIsQ0FBY0EsS0FBZDtBQUNBRSxJQUFBQSxPQUFPLENBQUNDLElBQVIsQ0FBYSxDQUFiO0FBQ0g7QUFDSjs7QUFFREMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCbEIsV0FBakIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN0YXJ0IGEgd29ya2VyIGFwcFxuICogQHBhcmFtIHtGdW5jdGlvbn0gd29ya2VyIFxuICogQHBhcmFtIHtvYmplY3R9IFt3b3JrZXJPcHRpb25zXSBcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBbd29ya2VyT3B0aW9ucy53b3JrZXJOYW1lXVxuICogQHByb3BlcnR5IHtib29sZWFufSBbd29ya2VyT3B0aW9ucy5kb250U3RvcF0gLSBEb24ndCBzdG9wIGFmdGVyIHdvcmtlciBkb25lIFxuICogQHByb3BlcnR5IHtGdW5jdGlvbn0gW3dvcmtlck9wdGlvbnMuaW5pdGlhbGl6ZXJdIFxuICovXG5hc3luYyBmdW5jdGlvbiBzdGFydFdvcmtlcih3b3JrZXIsIG9wdGlvbnMpIHtcbiAgICBjb25zdCB7IHdvcmtlck5hbWUsIGRvbnRTdG9wLCBpbml0aWFsaXplciwgdW5pbml0aWFsaXplciwgLi4uYXBwT3B0aW9ucyB9ID0gKG9wdGlvbnMgfHwge30pO1xuXG4gICAgY29uc3QgQXBwID0gcmVxdWlyZSgnLi4nKTtcblxuICAgIC8vIGNyZWF0ZSBhbiBhcHAgaW5zdGFuY2Ugd2l0aCBjdXN0b20gY29uZmlndXJhdGlvblxuICAgIGxldCBhcHAgPSBuZXcgQXBwKHdvcmtlck5hbWUgfHwgJ3dvcmtlcicsIGFwcE9wdGlvbnMpO1xuXG4gICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgYXBwLnN0YXJ0XygpO1xuICAgIFxuICAgICAgICBpZiAoaW5pdGlhbGl6ZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IGluaXRpYWxpemVyKGFwcCk7XG4gICAgICAgIH0gICAgXG4gICAgICAgIFxuICAgICAgICBhd2FpdCB3b3JrZXIoYXBwKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghZG9udFN0b3ApIHtcbiAgICAgICAgICAgIGF3YWl0IGFwcC5zdG9wXygpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVuaW5pdGlhbGl6ZXIpIHtcbiAgICAgICAgICAgIGF3YWl0IHVuaW5pdGlhbGl6ZXIoKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICBwcm9jZXNzLmV4aXQoMSk7XG4gICAgfSBcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBzdGFydFdvcmtlcjsiXX0=